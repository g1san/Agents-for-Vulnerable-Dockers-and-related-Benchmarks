from flask import Flask, request, send_from_directory, abort
import os
app = Flask(__name__)

# Vulnerable endpoint that mirrors CVE-2017-8386 (path traversal via unvalidated user input)
@app.route('/download')
def download_file():
    filename = request.args.get('file')
    if not filename:
        abort(400, 'file parameter required')
    # Intentionally insecure: no validation, allows "../" traversal
    directory = os.path.abspath('data')
    return send_from_directory(directory, filename)

# Simple route to list available test files
@app.route('/')
def index():
    files = os.listdir('data')
    return '<br>'.join(files)

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)