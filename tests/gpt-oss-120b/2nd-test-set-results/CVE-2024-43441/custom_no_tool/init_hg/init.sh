#!/bin/sh
set -e
HG_HOST=${HG_HOST:-hugegraph}
HG_PORT=${HG_PORT:-8182}
HG_URL="http://$HG_HOST:$HG_PORT"

# Wait for HugeGraph to be ready
echo "Waiting for HugeGraph to become ready..."
while ! curl -s "$HG_URL/gremlin" > /dev/null; do
  sleep 2
done

echo "HugeGraph is ready, inserting test data..."
# Create sample vertices with label 'person' and property 'name'
python3 - <<PY
import requests, os
hg_url = os.getenv('HG_URL', f'http://{HG_HOST}:{HG_PORT}')

def add_vertex(name):
    gremlin = f"g.addV('person').property('name', '{name}')"
    resp = requests.post(f'{hg_url}/gremlin', json={'gremlin': gremlin})
    resp.raise_for_status()
    print(f'Added vertex {name}')

for n in ['alice', 'bob']:
    add_vertex(n)
PY

echo "Test data inserted. Exiting init container."