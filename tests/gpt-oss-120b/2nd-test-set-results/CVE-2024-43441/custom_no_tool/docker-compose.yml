services:
  webapp:
    build:
      context: ./webapp
    ports:
      - "8080:80"
    depends_on:
      - hugegraph
      - init_hg
    environment:
      - HG_HOST=hugegraph
      - HG_PORT=8182
  hugegraph:
    build:
      context: ./hugegraph
    container_name: hugegraph
    ports:
      - "8182:8182"
    environment:
      - HUGRAPH_GREMLIN_SERVER_HOST=0.0.0.0
      - HUGRAPH_GREMLIN_SERVER_PORT=8182
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8182/gremlin"]
      interval: 10s
      timeout: 5s
      retries: 5
  init_hg:
    build:
      context: ./init_hg
    depends_on:
      hugegraph:
        condition: service_healthy
    environment:
      - HG_HOST=hugegraph
      - HG_PORT=8182
    command: ["/init.sh"]