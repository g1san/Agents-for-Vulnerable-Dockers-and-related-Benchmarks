from django.http import JsonResponse, HttpResponse
from django.db import connection

def index(request):
    return HttpResponse('CVE-2020-9402 vulnerable Django app running.')

def search(request):
    # Vulnerable parameter concatenated directly into raw SQL (demonstrates CVE-2020-9402)
    tolerance = request.GET.get('tolerance', '')
    with connection.cursor() as cursor:
        sql = f"SELECT * FROM users WHERE name LIKE '%{tolerance}%'"
        cursor.execute(sql)
        columns = [col[0] for col in cursor.description]
        rows = [dict(zip(columns, row)) for row in cursor.fetchall()]
    return JsonResponse(rows, safe=False)