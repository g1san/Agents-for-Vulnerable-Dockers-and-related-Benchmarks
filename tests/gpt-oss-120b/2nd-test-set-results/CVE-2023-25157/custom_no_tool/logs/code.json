{
    "files": [
        {
            "location": "./../../dockers/CVE-2023-25157/custom_no_tool/docker-compose.yml",
            "content": "version: '3.8'\n\nservices:\n  web:\n    build: ./web\n    ports:\n      - \"8080:80\"\n    depends_on:\n      - db\n      - geoserver\n    environment:\n      DB_HOST: db\n      DB_USER: postgres\n      DB_PASSWORD: postgrespass\n      DB_NAME: geodb\n\n  db:\n    image: postgis/postgis:13-3.3\n    environment:\n      POSTGRES_USER: postgres\n      POSTGRES_PASSWORD: postgrespass\n      POSTGRES_DB: geodb\n    ports:\n      - \"5432:5432\"\n    volumes:\n      - db_data:/var/lib/postgresql/data\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql\n\n  geoserver:\n    image: geoserver/geoserver:2.21.3\n    ports:\n      - \"8081:8080\"\n    depends_on:\n      - db\n    environment:\n      - SKIP_DEMO_DATA=true\n\nvolumes:\n  db_data:\n"
        },
        {
            "location": "./../../dockers/CVE-2023-25157/custom_no_tool/web/Dockerfile",
            "content": "FROM php:8.2-apache\n\nENV DEBIAN_FRONTEND=noninteractive\n\nCOPY index.php /var/www/html/\n\nRUN apt-get update && \\\n    apt-get install -y --no-install-recommends \\\n        build-essential \\\n        libpq-dev \\\n        postgresql-client && \\\n    docker-php-ext-install -j$(nproc) pgsql pdo_pgsql && \\\n    docker-php-ext-enable pgsql pdo_pgsql && \\\n    apt-get clean && rm -rf /var/lib/apt/lists/*\n"
        },
        {
            "location": "./../../dockers/CVE-2023-25157/custom_no_tool/web/index.php",
            "content": "<?php\n$host = getenv('DB_HOST');\n$user = getenv('DB_USER');\n$pass = getenv('DB_PASSWORD');\n$db   = getenv('DB_NAME');\n\n$connStr = \"host=$host dbname=$db user=$user password=$pass\";\n$conn = pg_connect($connStr);\nif (!$conn) {\n    die('Connection failed: ' . pg_last_error());\n}\n\n// Vulnerable query - the target of CVE-2023-25157 (SQL injection)\n$id = $_GET['id'];\n$sql = \"SELECT * FROM users WHERE id = $id\"; // No sanitisation\n$result = pg_query($conn, $sql);\nif (!$result) {\n    die('Query failed: ' . pg_last_error());\n}\n\nif (pg_num_rows($result) > 0) {\n    while ($row = pg_fetch_assoc($result)) {\n        echo 'User: ' . htmlspecialchars($row['username']) . '<br>';\n        echo 'Email: ' . htmlspecialchars($row['email']) . '<br>';\n    }\n} else {\n    echo 'No user found';\n}\n\npg_free_result($result);\npg_close($conn);\n?>"
        },
        {
            "location": "./../../dockers/CVE-2023-25157/custom_no_tool/db/init.sql",
            "content": "CREATE TABLE users (\n    id SERIAL PRIMARY KEY,\n    username VARCHAR(50) NOT NULL,\n    email VARCHAR(100) NOT NULL\n);\nINSERT INTO users (username, email) VALUES\n('alice', 'alice@example.com'),\n('bob', 'bob@example.com'),\n('carol', 'carol@example.com');\n"
        }
    ],
    "directory_tree": "CVE-2023-25157/custom_no_tool"
}