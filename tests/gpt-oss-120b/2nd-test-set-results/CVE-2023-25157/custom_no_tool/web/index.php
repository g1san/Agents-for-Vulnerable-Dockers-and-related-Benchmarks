<?php
$host = getenv('DB_HOST');
$user = getenv('DB_USER');
$pass = getenv('DB_PASSWORD');
$db   = getenv('DB_NAME');

$connStr = "host=$host dbname=$db user=$user password=$pass";
$conn = pg_connect($connStr);
if (!$conn) {
    die('Connection failed: ' . pg_last_error());
}

// Vulnerable query - the target of CVE-2023-25157 (SQL injection)
$id = $_GET['id'];
$sql = "SELECT * FROM users WHERE id = $id"; // No sanitisation
$result = pg_query($conn, $sql);
if (!$result) {
    die('Query failed: ' . pg_last_error());
}

if (pg_num_rows($result) > 0) {
    while ($row = pg_fetch_assoc($result)) {
        echo 'User: ' . htmlspecialchars($row['username']) . '<br>';
        echo 'Email: ' . htmlspecialchars($row['email']) . '<br>';
    }
} else {
    echo 'No user found';
}

pg_free_result($result);
pg_close($conn);
?>