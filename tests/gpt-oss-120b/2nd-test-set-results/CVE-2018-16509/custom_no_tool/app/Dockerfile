FROM python:3.9-slim

# Upgrade pip to a specific version
RUN python -m pip install --upgrade "pip==20.3.4"

# Install required Python packages (Flask, MySQL connector, Pillow)
RUN pip install Flask==2.2.5 mysql-connector-python==8.0.33 Pillow==9.5.0

# Install vulnerable Ghostscript 9.23 from a Debian stretch snapshot
RUN echo "deb [trusted=yes] http://snapshot.debian.org/archive/debian/20210201T000000Z stretch main" > /etc/apt/sources.list.d/snapshot.list && \
    apt-get update -o Acquire::Check-Valid-Until=false && \
    apt-get install -y --no-install-recommends ghostscript && \
    rm -rf /var/lib/apt/lists/* /etc/apt/sources.list.d/snapshot.list

WORKDIR /app
COPY app.py .

EXPOSE 5000
CMD ["python", "app.py"]