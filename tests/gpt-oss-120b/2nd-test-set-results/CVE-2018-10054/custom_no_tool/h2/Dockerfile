FROM h2database/h2:1.4.200

# Create a directory for the database files
RUN mkdir -p /data

# Copy the initialization script into the image
COPY init.sql /init.sql

# Run the init script using the exact H2 jar name (expanded via shell globbing)
RUN set -eux; \
    jar=$(ls /opt/h2*.jar); \
    java -cp "$jar" org.h2.tools.RunScript \
        -url jdbc:h2:/data/test \
        -script /init.sql \
        -user sa \
        -password '' && \
    rm /init.sql

# Expose the TCP port internally (no host mapping)
EXPOSE 9092

# Start the H2 TCP server bound to localhost only (web console disabled)
CMD ["sh", "-c", "java -cp /opt/h2*.jar org.h2.tools.Server -tcp -tcpPort 9092 -tcpAllowOthers false -baseDir /data"]