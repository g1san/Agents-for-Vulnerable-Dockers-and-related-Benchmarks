from django.http import JsonResponse
from .models import User

def health(request):
    return JsonResponse({'status': 'ok'})

def search(request):
    # Vulnerable usage of order_by with user‑controlled input (CVE‑2021‑35042)
    order_param = request.GET.get('order', 'id')
    users = User.objects.all().order_by(order_param)
    data = list(users.values('id', 'name', 'email'))
    return JsonResponse(data, safe=False)