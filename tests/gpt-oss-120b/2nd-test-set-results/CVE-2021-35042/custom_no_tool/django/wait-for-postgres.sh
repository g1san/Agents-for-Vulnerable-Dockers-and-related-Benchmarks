#!/bin/sh
set -e

host="${DB_HOST:-postgres}"
port=5432

echo "Waiting for PostgreSQL at $host:$port..."
# Loop until pg_isready reports that the server is ready
while ! pg_isready -h "$host" -p "$port" > /dev/null 2>&1; do
  sleep 1
  echo "still waiting..."
done

echo "PostgreSQL is up - running migrations"
python manage.py migrate --noinput
exec python manage.py runserver 0.0.0.0:8000