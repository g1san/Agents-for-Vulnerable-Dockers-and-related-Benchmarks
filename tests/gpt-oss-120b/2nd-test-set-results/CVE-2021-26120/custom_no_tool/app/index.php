<?php
require __DIR__ . '/vendor/autoload.php';

use Smarty;

$func = isset($_GET['func']) ? $_GET['func'] : 'demo_function';

$smarty = new Smarty();
$smarty->setTemplateDir(__DIR__.'/templates/');
$smarty->setCompileDir(__DIR__.'/templates_c/');

// Build a template string that uses the supplied function name.
// If the function name contains malicious PHP code, the vulnerability is triggered.
$templateString = "{function $func}Hello from vulnerable Smarty!{/function}";

// Render the template from the string.
$output = $smarty->fetch('string:' . $templateString);

echo $output;
?>