FROM alpine:3.12

# Install build dependencies
RUN apk add --no-cache \
    build-base \
    yasm \
    pkgconfig \
    wget \
    libass-dev \
    libvpx-dev \
    libvorbis-dev \
    libwebp-dev \
    opus-dev \
    freetype-dev \
    libpng-dev \
    zlib-dev

ENV FFMPEG_VERSION=2.8.12
WORKDIR /tmp

# Download, compile and install specific vulnerable ffmpeg version
RUN wget https://ffmpeg.org/releases/ffmpeg-${FFMPEG_VERSION}.tar.gz && \
    tar xzf ffmpeg-${FFMPEG_VERSION}.tar.gz && \
    cd ffmpeg-${FFMPEG_VERSION} && \
    ./configure \
        --disable-doc \
        --enable-gpl \
        --enable-libass \
        --enable-libvpx \
        --enable-libvorbis \
        --enable-libwebp \
        --enable-libopus \
        --enable-libfreetype \
        --enable-static \
        --disable-shared && \
    make -j$(nproc) && \
    make install && \
    cd / && rm -rf /tmp/ffmpeg-${FFMPEG_VERSION} /tmp/ffmpeg-${FFMPEG_VERSION}.tar.gz

# Keep the container running
CMD ["sleep", "infinity"]
