{
    "files": [
        {
            "location": "./../../dockers/CVE-2019-17564/custom_no_tool/docker-compose.yml",
            "content": "services:\n  webapp:\n    build: ./app\n    ports:\n      - \"8080:8080\"\n    environment:\n      - DB_HOST=db\n      - DB_USER=cve_user\n      - DB_PASSWORD=secret\n      - DB_NAME=cve_db\n    depends_on:\n      db:\n        condition: service_healthy\n      ldap:\n        condition: service_started\n    restart: unless-stopped\n  db:\n    image: mysql:5.7\n    restart: always\n    environment:\n      MYSQL_DATABASE: cve_db\n      MYSQL_USER: cve_user\n      MYSQL_PASSWORD: secret\n      MYSQL_ROOT_PASSWORD: rootsecret\n    volumes:\n      - db_data:/var/lib/mysql\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql\n    healthcheck:\n      test: [\"CMD\", \"mysqladmin\", \"ping\", \"-h\", \"localhost\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n  ldap:\n    image: bitnami/openldap:2.6.0\n    environment:\n      - LDAP_ADMIN_USERNAME=admin\n      - LDAP_ADMIN_PASSWORD=adminpassword\n      - LDAP_USERS=example\n      - LDAP_PASSWORDS=example\n    ports:\n      - \"1389:1389\"\n    healthcheck:\n      test: [\"CMD\", \"ldapsearch\", \"-x\", \"-H\", \"ldap://localhost:1389\", \"-b\", \"dc=example,dc=com\", \"-D\", \"cn=admin,dc=example,dc=com\", \"-w\", \"adminpassword\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\nvolumes:\n  db_data:"
        },
        {
            "location": "./../../dockers/CVE-2019-17564/custom_no_tool/app/Dockerfile",
            "content": "FROM node:18-slim\nWORKDIR /usr/src/app\n# Install build tools, Python 2 interpreter, and libraries required for native modules (ldapjs, mysql)\nRUN apt-get update && \\\n    apt-get install -y --no-install-recommends \\\n        git python2 make g++ libssl-dev libldap2-dev libsasl2-dev && \\\n    ln -sf /usr/bin/python2 /usr/bin/python && \\\n    rm -rf /var/lib/apt/lists/*\nCOPY package*.json ./\nRUN npm install --unsafe-perm\nCOPY . .\nEXPOSE 8080\nCMD [\"node\", \"server.js\"]"
        },
        {
            "location": "./../../dockers/CVE-2019-17564/custom_no_tool/app/package.json",
            "content": "{\n  \"name\": \"vulnerable-app\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Demo app vulnerable to CVE-2019-17564\",\n  \"main\": \"server.js\",\n  \"scripts\": {\n    \"start\": \"node server.js\"\n  },\n  \"dependencies\": {\n    \"express\": \"4.16.0\",\n    \"ldapjs\": \"^2.3.2\",\n    \"mysql\": \"^2.18.1\"\n  }\n}"
        },
        {
            "location": "./../../dockers/CVE-2019-17564/custom_no_tool/app/server.js",
            "content": "const express = require('express');\nconst ldap = require('ldapjs');\nconst mysql = require('mysql');\n\nconst app = express();\napp.use(express.json());\n\n// Database connection (used only to demonstrate a normal backend)\nconst db = mysql.createConnection({\n  host: process.env.DB_HOST || 'db',\n  user: process.env.DB_USER || 'cve_user',\n  password: process.env.DB_PASSWORD || 'secret',\n  database: process.env.DB_NAME || 'cve_db'\n});\n\ndb.connect(err => {\n  if (err) console.error('DB connection error:', err);\n  else console.log('Connected to DB');\n});\n\n// Vulnerable endpoint \u2013 CVE-2019-17564 (LDAP injection leading to command execution)\napp.get('/search', (req, res) => {\n  const filter = req.query.filter; // user supplied LDAP filter\n  // No sanitization \u2013 directly used in LDAP search\n  const client = ldap.createClient({ url: 'ldap://ldap:1389' });\n  const opts = {\n    filter: filter,\n    scope: 'sub'\n  };\n  client.search('dc=example,dc=com', opts, (err, search) => {\n    if (err) {\n      res.status(500).send('LDAP search error');\n      return;\n    }\n    const entries = [];\n    search.on('searchEntry', entry => {\n      entries.push(entry.object);\n    });\n    search.on('end', () => {\n      res.json(entries);\n    });\n  });\n});\n\napp.get('/', (req, res) => {\n  res.send('Vulnerable app ready');\n});\n\napp.listen(8080, () => {\n  console.log('App listening on port 8080');\n});"
        },
        {
            "location": "./../../dockers/CVE-2019-17564/custom_no_tool/db/init.sql",
            "content": "CREATE TABLE users (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(50) NOT NULL,\n  password VARCHAR(255) NOT NULL\n);\nINSERT INTO users (username, password) VALUES ('admin', 'adminpass');"
        }
    ],
    "directory_tree": "CVE-2019-17564/custom_no_tool"
}