FROM node:18-slim
WORKDIR /usr/src/app
# Install build tools, Python 2 interpreter, and libraries required for native modules (ldapjs, mysql)
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        git python2 make g++ libssl-dev libldap2-dev libsasl2-dev && \
    ln -sf /usr/bin/python2 /usr/bin/python && \
    rm -rf /var/lib/apt/lists/*
COPY package*.json ./
RUN npm install --unsafe-perm
COPY . .
EXPOSE 8080
CMD ["node", "server.js"]