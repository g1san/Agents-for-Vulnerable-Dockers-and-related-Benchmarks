<?php
// Simple endpoint that uses ImageMagick to convert a PNG to a JPEG
// This demonstrates the presence of the vulnerable ImageMagick binary.
if (isset($_GET['src'])) {
    $src = escapeshellarg($_GET['src']);
    $dest = '/tmp/output.jpg';
    // Run ImageMagick convert (or magick) command
    $cmd = "convert $src $dest 2>&1";
    $output = shell_exec($cmd);
    if (file_exists($dest)) {
        header('Content-Type: image/jpeg');
        readfile($dest);
        unlink($dest);
    } else {
        echo "Conversion failed: " . htmlspecialchars($output);
    }
} else {
    echo 'Provide a src query parameter pointing to an image URL or path on the server.';
}
?>