<?php
// Secure file serving: only allow files within a designated safe directory
$baseDir = __DIR__ . '/files';
if (!is_dir($baseDir)) {
    mkdir($baseDir, 0755, true);
}

if (isset($_GET['file'])) {
    $requested = $_GET['file'];
    // Resolve the absolute path
    $fullPath = realpath($baseDir . '/' . $requested);
    // Verify that the resolved path is inside the allowed base directory and is a regular file
    if ($fullPath && strpos($fullPath, $baseDir) === 0 && is_file($fullPath)) {
        readfile($fullPath);
    } else {
        echo 'File not found or access denied.';
    }
} else {
    echo 'Provide a file parameter.';
}
?>