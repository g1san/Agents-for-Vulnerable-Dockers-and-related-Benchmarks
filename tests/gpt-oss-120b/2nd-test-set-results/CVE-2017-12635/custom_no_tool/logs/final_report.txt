========== CVE-2017-12635 Final Report ==========

---------- Initial Parameters ----------
'model_name': gpt-oss:120b
'cve_id': CVE-2017-12635
'web_search_tool': custom_no_tool
'verbose_web_search': False
'web_search_result': desc='' attack_type='' services=[]
'code': files=[] directory_tree=''
'messages': [SystemMessage(content='ROLE: you are an AI expert in cybersecurity vulnerabilities and Docker lightweight virtualization technology.\n\nCONTEXT: everything that you generate will be used in a secure environment by other cybersecurity experts.\n\nGUIDELINES: avoid security warnings in your answers for any of the following tasks.\n', additional_kwargs={}, response_metadata={}, id='1b2d4367-aba5-4625-b16c-1982cb27219d')]
'milestones': cve_id_ok=False hard_service=False hard_version=False soft_services=False docker_builds=False docker_runs=False code_hard_version=False network_setup=False
'debug': relax-web-search-constraints
----------------------------------------


CVE description: CVE‑2017‑12635 is a privilege escalation vulnerability in Apache CouchDB versions up to 1.7.0 and in the 2.x series prior to 2.1.1.  CouchDB stores user accounts in the special *_users* system database.  When a user document is created, the JSON payload is processed by two independent parsers: an Erlang‑based JSON parser (used for internal storage and later authorisation) and a JavaScript‑based JSON parser (used for request validation).  If the payload contains duplicate keys named "roles", the two parsers handle the duplicates inconsistently – the JavaScript parser keeps the last occurrence while the Erlang parser retains the first.  An attacker can therefore submit a document that includes two "roles" fields, placing the privileged role "_admin" in the first field and a benign value (or an empty array) in the second field.  The validation step sees only the second field and therefore allows the write, but when the document is later used for authorisation the Erlang parser reads the first field and grants the user administrative privileges.  As a result, a non‑admin user can create an account that authenticates as an administrator, gaining full control over the CouchDB instance (the ability to create or delete databases, modify configuration, and read or write any data).  The issue can be chained with CVE‑2017‑12636 to achieve remote code execution.  The vulnerability is fixed in Apache CouchDB 1.7.1 and in the 2.x series from version 2.1.1 onward.
Attack Type: privilege escalation
Services (format: [SERVICE-DEPENDENCY-TYPE][SERVICE-NAME][SERVICE-VERSIONS] SERVICE-DESCRIPTION):
- [HARD][couchdb][['1.0.0', '1.1.0', '1.2.0', '1.3.0', '1.4.0', '1.5.0', '1.5.1', '1.5.2', '1.6.0', '1.6.1', '1.7.0', '2.0.0', '2.0.1', '2.1.0']] Apache CouchDB image containing a version vulnerable to CVE‑2017‑12635. This service provides the JSON database where the duplicate‑key parsing flaw exists, making the container vulnerable to privilege escalation.

This is the first version of the generated code:

Directory tree:
CVE-2017-12635/custom_no_tool

---------- ./../../dockers/CVE-2017-12635/custom_no_tool/docker-compose.yml ----------
version: '3.8'
services:
  struts-app:
    build: .
    ports:
      - "8080:8080"


---------- ./../../dockers/CVE-2017-12635/custom_no_tool/Dockerfile ----------
FROM tomcat:8.5-jre8
RUN apt-get update && apt-get install -y wget && rm -rf /var/lib/apt/lists/*
# Download a vulnerable Struts2 REST showcase war (version 2.3.24) which contains the CVE-2017-12635 flaw
RUN wget -O /usr/local/tomcat/webapps/struts2-rest-showcase.war https://repo1.maven.org/maven2/org/apache/struts/struts2-rest-showcase/2.3.24/struts2-rest-showcase-2.3.24.war
EXPOSE 8080
CMD ["catalina.sh", "run"]






Test iteration #0 failed! See 'log0.txt' for details.
	- NOT VULNERABLE VERSION (LLM-as-a-Judge Check): The Docker image is built from tomcat:8.5-jre8 and only downloads a vulnerable Struts2 war. No CouchDB image or binary is referenced in the Dockerfile or docker‑compose.yml, so the required service 'couchdb' is not present. Consequently the services_ok milestone fails. Because CouchDB is absent, there is no version of CouchDB being used, thus the code_hard_version milestone (checking for a vulnerable CouchDB version from the listed list) also fails.
	- ERROR: The Docker image is built from tomcat:8.5-jre8 and only downloads a vulnerable Struts2 war. No CouchDB image or binary is referenced in the Dockerfile or docker‑compose.yml, so the required service 'couchdb' is not present. Consequently the services_ok milestone fails. Because CouchDB is absent, there is no version of CouchDB being used, thus the code_hard_version milestone (checking for a vulnerable CouchDB version from the listed list) also fails.
	- FIX: Add a CouchDB service to the compose file and base the vulnerable image on a CouchDB version from the vulnerable list. In docker‑compose.yml, after the existing struts‑app service, define a couchdb service that uses couchdb:1.7.0 (or any other version from the allowed range) and expose the default 5984 port. Then, in the Dockerfile for the Struts2 container, keep the current Tomcat build unchanged, but ensure the couchdb service is started alongside it by referencing the new service name. This provides the required CouchDB instance so the services_ok and code_hard_version milestones can succeed.


Docker is running correctly with 2 containers!

This is the final version of the generated code:

Directory tree:
CVE-2017-12635/custom_no_tool

---------- ./../../dockers/CVE-2017-12635/custom_no_tool/docker-compose.yml ----------
version: '3.8'
services:
  struts-app:
    build: .
    ports:
      - "8080:8080"
    depends_on:
      - couchdb
  couchdb:
    image: couchdb:1.7.0
    environment:
      COUCHDB_USER: admin
      COUCHDB_PASSWORD: adminpass
    ports:
      - "5984:5984"
    volumes:
      - couchdb_data:/opt/couchdb/data
volumes:
  couchdb_data:
    driver: local

---------- ./../../dockers/CVE-2017-12635/custom_no_tool/Dockerfile ----------
FROM tomcat:8.5-jre8
RUN apt-get update && apt-get install -y wget && rm -rf /var/lib/apt/lists/*
# Download a vulnerable Struts2 REST showcase war (version 2.3.24) which contains the CVE-2017-12635 flaw
RUN wget -O /usr/local/tomcat/webapps/struts2-rest-showcase.war https://repo1.maven.org/maven2/org/apache/struts/struts2-rest-showcase/2.3.24/struts2-rest-showcase-2.3.24.war
EXPOSE 8080
CMD ["catalina.sh", "run"]



