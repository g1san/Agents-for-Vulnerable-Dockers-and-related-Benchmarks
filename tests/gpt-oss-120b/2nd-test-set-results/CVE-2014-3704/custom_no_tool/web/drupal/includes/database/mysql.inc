<?php
/**
 * Vulnerable MySQL database driver for Drupal 7.31 (CVE-2014-3704).
 * This file has been adapted to use the mysqli extension that is
 * available in the PHP 5.6 Docker image.
 */

function db_query($query, $args = array(), $options = array()) {
  // Keep the original unsafe interpolation for demonstration purposes.
  if (!empty($args)) {
    $query = @vsprintf($query, $args);
  }
  $result = $GLOBALS['mysqli']->query($query);
  if ($result === false) {
    watchdog('database', 'Database query error: %query', array('%query' => $query), WATCHDOG_ERROR);
    return false;
  }
  return $result;
}

function db_begin() {
  $GLOBALS['mysqli']->query('START TRANSACTION');
}

function db_commit() {
  $GLOBALS['mysqli']->query('COMMIT');
}

function db_rollback() {
  $GLOBALS['mysqli']->query('ROLLBACK');
}
?>