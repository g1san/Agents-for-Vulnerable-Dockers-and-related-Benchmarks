<?php
// Simple PHP app vulnerable to CVE-2024-27348 (example: unsafe unserialize leading to RCE)
if (isset($_GET['payload'])) {
    // Vulnerable code: unserialize without validation
    $obj = unserialize(base64_decode($_GET['payload']));
    echo "Deserialized object: ".print_r($obj, true);
}

// Database connection (used for testing)
$mysqli = new mysqli(getenv('DB_HOST'), getenv('DB_USER'), getenv('DB_PASSWORD'), getenv('DB_NAME'));
if ($mysqli->connect_error) {
    die('Connection Error (' . $mysqli->connect_errno . ') '. $mysqli->connect_error);
}
$result = $mysqli->query('SELECT id, data FROM secrets');
while ($row = $result->fetch_assoc()) {
    echo '<p>Record '.$row['id'].': '.htmlspecialchars($row['data']).'</p>';
}
?>