FROM alpine:3.12
ENV FFMPEG_VERSION=2.8.4
ENV LD_LIBRARY_PATH=/usr/local/lib
RUN apk add --no-cache \
    curl \
    ca-certificates \
    build-base \
    yasm \
    libtool \
    nasm \
    libstdc++ && \
    curl -L -o /tmp/ffmpeg.tar.xz https://ffmpeg.org/releases/ffmpeg-${FFMPEG_VERSION}.tar.xz && \
    tar -xf /tmp/ffmpeg.tar.xz -C /tmp && \
    cd /tmp/ffmpeg-${FFMPEG_VERSION} && \
    ./configure \
        --disable-doc \
        --disable-everything \
        --enable-avformat \
        --enable-avcodec \
        --enable-avutil \
        --enable-swresample \
        --enable-swscale \
        --enable-protocol=file \
        --enable-muxer=flv && \
    make -j$(nproc) && \
    make install && \
    cd / && rm -rf /tmp/ffmpeg* && \
    apk del build-base yasm libtool nasm curl && \
    rm -rf /var/cache/apk/*
# Removed ENTRYPOINT that caused the container to exit after printing version
# Default command can be overridden by docker‑compose; keeping no CMD so the
# service command defined in docker‑compose.yml runs.
