#!/bin/sh
# Simple script to wait for MySQL to be reachable before starting the Node app.
HOST="${DB_HOST:-db}"
PORT=3306
MAX_RETRIES=30
INTERVAL=2
count=0
while ! nc -z "$HOST" "$PORT"; do
  count=$((count+1))
  if [ "$count" -ge "$MAX_RETRIES" ]; then
    echo "MySQL not reachable after $MAX_RETRIES attempts, exiting."
    exit 1
  fi
  echo "Waiting for MySQL at $HOST:$PORT... ($count)"
  sleep $INTERVAL
done
echo "MySQL is up, starting the application."
exec node app.js
