services:
  vulnerable-redis:
    image: redis:6.2.5
    ports:
      - "6379:6379"
    command: ["redis-server", "--requirepass", "weakpass"]

  hardened-geoserver:
    build: ./geoserver
    ports:
      - "8081:8080"
    environment:
      - GEOSERVER_ADMIN_PASSWORD=admin
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/geoserver/web"]
      interval: 30s
      timeout: 10s
      retries: 5

  vulnerable-app:
    build: ./app
    depends_on:
      - vulnerable-redis
      - hardened-geoserver
    ports:
      - "8080:8080"
    environment:
      - REDIS_HOST=vulnerable-redis
      - REDIS_PORT=6379
      - REDIS_PASS=weakpass
      - GEOSERVER_HOST=hardened-geoserver
      - GEOSERVER_PORT=8080
      - GEOSERVER_USER=admin
      - GEOSERVER_PASS=admin