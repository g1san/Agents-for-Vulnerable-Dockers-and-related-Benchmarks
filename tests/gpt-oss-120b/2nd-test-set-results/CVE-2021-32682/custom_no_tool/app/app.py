from flask import Flask, request, abort, send_file
import os
app = Flask(__name__)

@app.route('/')
def index():
    return 'Vulnerable Flask app ready.'

# Vulnerable endpoint illustrating the kind of issue tracked by CVE-2021-32682
# It reads a file path from the query parameter 'path' and returns its content
# without proper validation, leading to arbitrary file read.
@app.route('/read')
def read_file():
    file_path = request.args.get('path')
    if not file_path:
        abort(400, 'Missing "path" parameter')
    # NOTE: No sanitization â€“ this is intentional for the CVE demonstration.
    try:
        # Resolve to absolute path to mimic typical vulnerable behavior
        abs_path = os.path.abspath(file_path)
        return send_file(abs_path)
    except Exception as e:
        abort(404, str(e))

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
