# CVE-2021-28169 Reproduction Environment

This repository contains a minimal Docker‑Compose setup that reproduces the **CVE‑2021‑28169** vulnerability.

## How it works
- `vulnerable_engine` runs an old Docker Engine (`docker:20.10.4-dind`) with the Docker daemon exposed on **TCP port 2375** without TLS. The daemon is started with both a TCP listener and a Unix socket and uses the `overlay2` storage driver to ensure compatibility with modern kernels.
- `exploiter` is a tiny Alpine‑based container equipped with the Docker CLI. It connects to the insecure daemon (`DOCKER_HOST=tcp://vulnerable_engine:2375`) and attempts to create a privileged container that mounts the host root filesystem (`-v /:/host`).
- The `vulnerable_engine` service includes a healthcheck that waits for the daemon to be ready before starting the exploiter.
- The `trigger.sh` script also polls `docker info` before running the exploit, ensuring the daemon is reachable.

## Deploying the environment
```bash
cd ./../../dockers/CVE-2021-28169/custom_no_tool
docker compose up --build
```
The `exploiter` service runs once, performs the exploit, prints the result, and then exits.

## Expected outcome
When the compose brings the stack up, you should see output similar to:
```
Waiting for Docker daemon...
Listing root of host (first 10 entries):
bin
boot
de
etc
home
... (other entries)
Exploit attempt finished. If you see host filesystem listings above, the vulnerability is present.
```
If the host root directory is displayed, the vulnerable Docker daemon allowed the container to escape its isolation, confirming the CVE is exploitable.

## Clean up
```bash
docker compose down -v
```
This stops and removes all containers and the temporary volumes.