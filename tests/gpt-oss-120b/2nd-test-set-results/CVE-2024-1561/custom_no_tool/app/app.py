from flask import Flask, request, abort, send_file
from werkzeug.utils import safe_join
import os

app = Flask(__name__)

# Define a safe directory from which files can be served
SAFE_DIR = os.path.abspath(os.path.join(os.path.dirname(__file__), "static"))

@app.route('/')
def index():
    # Simple welcome message
    return "Flask app is running. Use /file?name=yourfile.txt to download files from the safe directory.", 200

@app.route('/file')
def get_file():
    filename = request.args.get('name')
    if not filename:
        return 'Specify name parameter', 400
    # Ensure the filename does not contain path traversal characters
    if '/' in filename or '\\' in filename:
        return 'Invalid filename', 400
    # Build safe absolute path within SAFE_DIR
    file_path = safe_join(SAFE_DIR, filename)
    if not file_path:
        return 'Invalid path', 400
    if not os.path.isfile(file_path):
        return 'File not found', 404
    return send_file(file_path, as_attachment=True)

if __name__ == '__main__':
    # Listen on all interfaces for easy testing
    app.run(host='0.0.0.0', port=5000)