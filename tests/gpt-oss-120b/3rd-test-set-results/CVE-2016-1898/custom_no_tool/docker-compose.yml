version: '3.8'
services:
  vulnerable-docker:
    image: docker:20.10-dind
    privileged: true
    environment:
      - DOCKER_TLS_CERTDIR=
    ports:
      - "2375:2375"
    volumes:
      - dockerd-data:/var/lib/docker

  exploit:
    image: alpine:3.18
    depends_on:
      - vulnerable-docker
    volumes:
      - ./exploit.sh:/exploit.sh
    entrypoint: "sh -c 'apk add --no-cache curl jq && chmod +x /exploit.sh && sh /exploit.sh'"

volumes:
  dockerd-data: {}