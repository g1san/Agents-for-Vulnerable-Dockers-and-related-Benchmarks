{
    "files": [
        {
            "location": "./../../dockers/CVE-2021-32682/custom_no_tool/docker-compose.yml",
            "content": "version: '3.8'\n\nservices:\n  web:\n    build:\n      context: ./web\n    ports:\n      - \"5000:5000\"\n    depends_on:\n      - db\n    environment:\n      - DATABASE_URL=postgresql://testuser:testpass@db:5432/testdb\n\n  db:\n    image: postgres:13-alpine\n    environment:\n      POSTGRES_USER: testuser\n      POSTGRES_PASSWORD: testpass\n      POSTGRES_DB: testdb\n    ports:\n      - \"5432:5432\"\n    volumes:\n      - db_data:/var/lib/postgresql/data\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql\n\n  php:\n    image: php:7.4-apache\n    ports:\n      - \"8080:80\"\n    volumes:\n      - ./php/elfinder:/var/www/html/elfinder\n    environment:\n      ELFINER_VERSION: \"2.1.58\"\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost/elfinder/connector.minimal.php\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\nvolumes:\n  db_data:\n"
        },
        {
            "location": "./../../dockers/CVE-2021-32682/custom_no_tool/web/Dockerfile",
            "content": "FROM python:3.9-slim\nWORKDIR /app\n# Install build dependencies for psycopg2-binary\nRUN apt-get update && apt-get install -y --no-install-recommends gcc libpq-dev && rm -rf /var/lib/apt/lists/*\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY . .\nENV FLASK_APP=app.py\nENV FLASK_RUN_HOST=0.0.0.0\nEXPOSE 5000\nCMD [\"flask\", \"run\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2021-32682/custom_no_tool/web/requirements.txt",
            "content": "Flask==2.0.3\nWerkzeug<2.1.0\npsycopg2-binary==2.9.3\n"
        },
        {
            "location": "./../../dockers/CVE-2021-32682/custom_no_tool/web/app.py",
            "content": "import os\nfrom flask import Flask, jsonify\nimport psycopg2\n\napp = Flask(__name__)\n\ndef get_db_connection():\n    conn = psycopg2.connect(os.getenv('DATABASE_URL'))\n    return conn\n\n# Removed unsafe /run endpoint. The application now only provides safe functionality.\n\n@app.route('/users', methods=['GET'])\ndef list_users():\n    conn = get_db_connection()\n    cur = conn.cursor()\n    cur.execute('SELECT id, username FROM users;')\n    rows = cur.fetchall()\n    cur.close()\n    conn.close()\n    return jsonify([{'id': r[0], 'username': r[1]} for r in rows])\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000)\n"
        },
        {
            "location": "./../../dockers/CVE-2021-32682/custom_no_tool/db/init.sql",
            "content": "CREATE TABLE IF NOT EXISTS users (\n    id SERIAL PRIMARY KEY,\n    username VARCHAR(50) NOT NULL,\n    password VARCHAR(255) NOT NULL\n);\nINSERT INTO users (username, password) VALUES ('alice', 'password1'), ('bob', 'password2');\n"
        },
        {
            "location": "./../../dockers/CVE-2021-32682/custom_no_tool/php/elfinder/connector.minimal.php",
            "content": "<?php\n// Minimal elFinder connector (vulnerable version placeholder)\n// This file is intentionally simplistic to demonstrate the presence of a vulnerable component.\n// In a real scenario, this would be the actual connector.minimal.php from elFinder version 2.1.58.\n\n// Example vulnerable handling (no sanitisation) \u2013 DO NOT USE IN PRODUCTION.\nif (isset($_GET['cmd'])) {\n    $cmd = $_GET['cmd'];\n    // Vulnerable processing of commands...\n    // This placeholder simply returns the command received.\n    echo json_encode(['received_cmd' => $cmd]);\n} else {\n    echo json_encode(['error' => 'No command supplied']);\n}\n?>\n"
        },
        {
            "location": "./../../dockers/CVE-2021-32682/custom_no_tool/php/elfinder/index.php",
            "content": "<?php\n// Simple index file to expose the connector.\nheader('Content-Type: application/json');\nrequire 'connector.minimal.php';\n?>\n"
        }
    ],
    "directory_tree": "custom_no_tool/\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 web/\n\u2502   \u251c\u2500\u2500 Dockerfile\n\u2502   \u251c\u2500\u2500 requirements.txt\n\u2502   \u2514\u2500\u2500 app.py\n\u251c\u2500\u2500 db/\n\u2502   \u2514\u2500\u2500 init.sql\n\u2514\u2500\u2500 php/\n    \u2514\u2500\u2500 elfinder/\n        \u251c\u2500\u2500 connector.minimal.php\n        \u2514\u2500\u2500 index.php"
}