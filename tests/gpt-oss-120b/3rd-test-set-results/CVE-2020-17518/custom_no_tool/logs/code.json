{
    "files": [
        {
            "location": "./../../dockers/CVE-2020-17518/custom_no_tool/docker-compose.yml",
            "content": "version: \"3.8\"\nservices:\n  web:\n    build: ./app\n    ports:\n      - \"8080:8080\"\n    environment:\n      - DB_HOST=db\n      - DB_USER=test\n      - DB_PASSWORD=test123\n      - DB_NAME=vuln_db\n    depends_on:\n      db:\n        condition: service_healthy\n  db:\n    image: mysql:5.6\n    command: --default-authentication-plugin=mysql_native_password\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpass\n      MYSQL_DATABASE: vuln_db\n      MYSQL_USER: test\n      MYSQL_PASSWORD: test123\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - db_data:/var/lib/mysql\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql\n    healthcheck:\n      test: [\"CMD\", \"mysqladmin\", \"ping\", \"-h\", \"localhost\"]\n      interval: 2s\n      timeout: 5s\n      retries: 10\n  flink:\n    image: apache/flink:1.11.3\n    ports:\n      - \"8081:8081\"\n    environment:\n      - FLINK_PROPERTIES=jobmanager.rpc.address=flink\n    command: jobmanager\nvolumes:\n  db_data:"
        },
        {
            "location": "./../../dockers/CVE-2020-17518/custom_no_tool/app/Dockerfile",
            "content": "FROM node:14-alpine\nWORKDIR /usr/src/app\n# Install required Alpine packages (MariaDB client, build tools, Python)\nRUN apk add --no-cache mariadb-client build-base python3\n# Copy package definition files and install Node dependencies\nCOPY package*.json ./\nRUN npm install\n# Copy application source code (including wait-for-db.sh)\nCOPY . ./\n# Ensure the startup script is executable\nRUN chmod +x wait-for-db.sh\nEXPOSE 8080\nENTRYPOINT [\"sh\", \"/usr/src/app/wait-for-db.sh\"]"
        },
        {
            "location": "./../../dockers/CVE-2020-17518/custom_no_tool/app/package.json",
            "content": "{\n  \"name\": \"vuln-app\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Demonstration app for CVE-2020-17518\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"node index.js\"\n  },\n  \"dependencies\": {\n    \"express\": \"4.16.0\",\n    \"mysql\": \"2.18.1\"\n  }\n}"
        },
        {
            "location": "./../../dockers/CVE-2020-17518/custom_no_tool/app/index.js",
            "content": "const express = require('express');\nconst mysql = require('mysql');\nconst bodyParser = require('body-parser');\n\nconst app = express();\napp.use(bodyParser.json());\n\n// Vulnerable endpoint \u2013 executes JavaScript received in the \"code\" field\napp.post('/exec', (req, res) => {\n  try {\n    const userCode = req.body.code;\n    // NOTE: This is intentionally insecure for CVE demonstration purposes\n    const result = eval(userCode);\n    res.json({ result });\n  } catch (e) {\n    res.status(500).json({ error: e.message });\n  }\n});\n\n// MySQL connection configuration using the exact env variables from compose\nconst dbConfig = {\n  host: process.env.DB_HOST || 'db',\n  user: process.env.DB_USER || 'test',\n  password: process.env.DB_PASSWORD || 'test123',\n  database: process.env.DB_NAME || 'vuln_db'\n};\n\nlet db;\n\nfunction connectWithRetry(attempt = 1) {\n  return new Promise((resolve) => {\n    const connection = mysql.createConnection(dbConfig);\n    connection.connect(err => {\n      if (err) {\n        console.error(`MySQL connection attempt ${attempt} failed (${err.code}). Retrying in 1s...`);\n        setTimeout(() => {\n          resolve(connectWithRetry(attempt + 1));\n        }, 1000);\n      } else {\n        console.log('Connected to MySQL');\n        resolve(connection);\n      }\n    });\n  });\n}\n\n// Initialize DB connection and start the server only after successful connect\n(async () => {\n  db = await connectWithRetry();\n\n  app.get('/users', (req, res) => {\n    db.query('SELECT * FROM users', (err, rows) => {\n      if (err) return res.status(500).json({ error: err.message });\n      res.json(rows);\n    });\n  });\n\n  app.listen(8080, () => console.log('App listening on port 8080'));\n})();"
        },
        {
            "location": "./../../dockers/CVE-2020-17518/custom_no_tool/app/wait-for-db.sh",
            "content": "#!/bin/sh\nset -e\n\n# Wait for MySQL to become reachable\nuntil mysqladmin ping -h\"${DB_HOST:-db}\" -P3306 --silent; do\n  echo \"Waiting for MySQL at ${DB_HOST:-db}:3306...\"\n  sleep 1\ndone\n\n# Start the Node application\nexec node index.js"
        },
        {
            "location": "./../../dockers/CVE-2020-17518/custom_no_tool/db/init.sql",
            "content": "CREATE TABLE IF NOT EXISTS users (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(50) NOT NULL,\n  password VARCHAR(255) NOT NULL\n);\nINSERT INTO users (username, password) VALUES\n  ('alice', 'password1'),\n  ('bob', 'password2');"
        }
    ],
    "directory_tree": "CVE-2020-17518/custom_no_tool"
}