#!/bin/bash
set -e
# Wait for Oracle DB to become reachable using Python oracle driver
until python -c "import oracledb, sys;\
try:\
    conn = oracledb.connect(user='system', password='oracle', dsn='db:1521/XE');\
    conn.close();\
    sys.exit(0)\
except Exception:\
    sys.exit(1)"; do
  echo "Waiting for Oracle DB..."
  sleep 5
done
# Run migrations and load initial data
python manage.py migrate --noinput
python manage.py loaddata initial_data.json || true
# Start the Django development server
exec python manage.py runserver 0.0.0.0:8000