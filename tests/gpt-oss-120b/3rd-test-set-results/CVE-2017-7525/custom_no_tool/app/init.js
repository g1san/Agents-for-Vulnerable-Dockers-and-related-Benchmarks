const cassandra = require('cassandra-driver');
const client = new cassandra.Client({
  contactPoints: [process.env.CASSANDRA_HOST || 'cassandra'],
  localDataCenter: 'datacenter1'
});

(async () => {
  try {
    await client.connect();
    // Create keyspace if not exists
    await client.execute(`CREATE KEYSPACE IF NOT EXISTS test WITH replication = {'class': 'SimpleStrategy', 'replication_factor' : 1}`);
    // Use the keyspace
    await client.execute('USE test');
    // Create a sample table
    await client.execute(`CREATE TABLE IF NOT EXISTS kv (id text PRIMARY KEY, value text)`);
    // Insert sample data
    await client.execute(`INSERT INTO kv (id, value) VALUES ('sample', 'hello world')`);
    console.log('Cassandra test keyspace/table populated');
  } catch (err) {
    console.error('Error during Cassandra init:', err);
    process.exit(1);
  } finally {
    await client.shutdown();
  }
})();