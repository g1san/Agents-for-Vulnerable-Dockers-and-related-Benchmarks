{
    "files": [
        {
            "location": "./../../dockers/CVE-2022-44268/custom_no_tool/docker-compose.yml",
            "content": "version: \"3.9\"\n\nservices:\n  app:\n    build: ./app\n    ports:\n      - \"8080:8080\"\n    environment:\n      - DB_HOST=db\n      - DB_USER=root\n      - DB_PASSWORD=example\n      - DB_NAME=vuln\n    depends_on:\n      - db\n\n  db:\n    image: mysql:5.7\n    environment:\n      MYSQL_ROOT_PASSWORD: example\n      MYSQL_DATABASE: vuln\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - db_data:/var/lib/mysql\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql\n    healthcheck:\n      test: [\"CMD\", \"mysqladmin\", \"-uroot\", \"-pexample\", \"ping\", \"--silent\"]\n      interval: 5s\n      timeout: 2s\n      retries: 10\n\n  imagemagick:\n    image: dpokidov/imagemagick:7.1.0-50\n    restart: unless-stopped\n    # Override the default entrypoint/command to keep the container alive without invoking ImageMagick utilities\n    entrypoint: [\"sh\", \"-c\", \"while true; do sleep 3600; done\"]\n\nvolumes:\n  db_data:\n"
        },
        {
            "location": "./../../dockers/CVE-2022-44268/custom_no_tool/app/Dockerfile",
            "content": "FROM node:14\nWORKDIR /usr/src/app\nCOPY package.json ./\nRUN npm install\nCOPY . .\nEXPOSE 8080\nCMD [\"node\", \"app.js\"]"
        },
        {
            "location": "./../../dockers/CVE-2022-44268/custom_no_tool/app/package.json",
            "content": "{\n  \"name\": \"vulnerable-app\",\n  \"version\": \"1.0.0\",\n  \"main\": \"app.js\",\n  \"dependencies\": {\n    \"express\": \"^4.17.1\",\n    \"mysql\": \"^2.18.1\"\n  }\n}"
        },
        {
            "location": "./../../dockers/CVE-2022-44268/custom_no_tool/app/app.js",
            "content": "const express = require('express');\nconst mysql = require('mysql');\nconst fs = require('fs');\nconst app = express();\nconst port = 8080;\n\nconst db = mysql.createConnection({\n  host: process.env.DB_HOST || 'db',\n  user: process.env.DB_USER || 'root',\n  password: process.env.DB_PASSWORD || '',\n  database: process.env.DB_NAME || 'vuln'\n});\n\nconst MAX_RETRIES = 10;\nconst RETRY_DELAY_MS = 1000;\n\nfunction connectWithRetry(attempt) {\n  db.connect(err => {\n    if (err) {\n      console.error(`DB connection error (attempt ${attempt}):`, err);\n      if (attempt < MAX_RETRIES) {\n        setTimeout(() => connectWithRetry(attempt + 1), RETRY_DELAY_MS);\n      } else {\n        console.error('Maximum DB connection attempts reached. Exiting.');\n        process.exit(1);\n      }\n    } else {\n      console.log('Connected to DB');\n    }\n  });\n}\n\nconnectWithRetry(1);\n\napp.get('/read', (req, res) => {\n  const file = req.query.file;\n  // Vulnerable: no validation, path traversal possible\n  fs.readFile(file, 'utf8', (err, data) => {\n    if (err) {\n      return res.status(500).send('Error reading file');\n    }\n    res.send(data);\n  });\n});\n\napp.get('/users', (req, res) => {\n  db.query('SELECT * FROM users', (err, results) => {\n    if (err) {\n      return res.status(500).send('DB error');\n    }\n    res.json(results);\n  });\n});\n\napp.listen(port, () => {\n  console.log(`App listening on port ${port}`);\n});"
        },
        {
            "location": "./../../dockers/CVE-2022-44268/custom_no_tool/db/init.sql",
            "content": "CREATE TABLE users (id INT AUTO_INCREMENT PRIMARY KEY, username VARCHAR(50), password VARCHAR(50));\nINSERT INTO users (username, password) VALUES ('admin', 'admin123'), ('user', 'user123');"
        }
    ],
    "directory_tree": "CVE-2022-44268/custom_no_tool"
}