FROM python:3.9-slim
WORKDIR /app
COPY ./app /app
# Install minimal runtime certificates and netcat-openbsd for health‑check script
RUN apt-get update && \
    apt-get install -y --no-install-recommends ca-certificates netcat-openbsd && \
    rm -rf /var/lib/apt/lists/*
RUN pip install --no-cache-dir -r requirements.txt
# Copy the wait‑for‑db entrypoint script and make it executable
COPY ./app/wait_for_db.sh /app/wait_for_db.sh
RUN chmod +x /app/wait_for_db.sh
EXPOSE 80
ENV VULN_MODE=none
ENTRYPOINT ["/app/wait_for_db.sh"]
CMD ["python", "app.py"]