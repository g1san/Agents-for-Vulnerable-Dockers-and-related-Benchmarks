{
    "files": [
        {
            "location": "./../../dockers/CVE-2021-40438/custom_no_tool/docker-compose.yml",
            "content": "version: \"3.8\"\nservices:\n  app:\n    build: ./app\n    depends_on:\n      db:\n        condition: service_healthy\n    command: [\"sh\",\"/usr/src/app/wait-for-db.sh\"]\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:3000/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 5\n    ports:\n      - \"3000:3000\"\n  db:\n    image: mysql:8.0\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpwd\n      MYSQL_DATABASE: testdb\n      MYSQL_USER: user\n      MYSQL_PASSWORD: userpwd\n    volumes:\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql\n    healthcheck:\n      test: [\"CMD\", \"mysqladmin\", \"ping\", \"-h\", \"localhost\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n    ports:\n      - \"3306:3306\"\n  httpd:\n    build: ./httpd\n    depends_on:\n      app:\n        condition: service_healthy\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://app:3000/\"]\n      interval: 30s\n      timeout: 10s\n      retries: 5\n    ports:\n      - \"80:80\"\nvolumes:\n  db_data:\n"
        },
        {
            "location": "./../../dockers/CVE-2021-40438/custom_no_tool/app/Dockerfile",
            "content": "FROM node:18-alpine\nRUN apk update && apk add --no-cache netcat-openbsd\nWORKDIR /usr/src/app\nCOPY package*.json ./\nRUN npm install\nCOPY . .\nEXPOSE 3000\nCMD [\"node\", \"index.js\"]"
        },
        {
            "location": "./../../dockers/CVE-2021-40438/custom_no_tool/app/package.json",
            "content": "{\n  \"name\": \"vulnerable-app\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Node app with command injection vulnerability\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"node index.js\"\n  },\n  \"author\": \"Security Researcher\",\n  \"license\": \"MIT\",\n  \"dependencies\": {\n    \"express\": \"^4.18.2\",\n    \"mysql2\": \"^3.2.0\"\n  }\n}"
        },
        {
            "location": "./../../dockers/CVE-2021-40438/custom_no_tool/app/package-lock.json",
            "content": "{\n  \"name\": \"vulnerable-app\",\n  \"version\": \"1.0.0\",\n  \"lockfileVersion\": 2,\n  \"requires\": true,\n  \"packages\": {\n    \"\": {\n      \"name\": \"vulnerable-app\",\n      \"version\": \"1.0.0\",\n      \"license\": \"MIT\",\n      \"dependencies\": {\n        \"express\": \"^4.18.2\",\n        \"mysql2\": \"^3.2.0\"\n      }\n    },\n    \"node_modules/express\": {\n      \"version\": \"4.18.2\",\n      \"resolved\": \"https://registry.npmjs.org/express/-/express-4.18.2.tgz\",\n      \"integrity\": \"sha512-xxxx\",\n      \"dependencies\": {\n        \"accepts\": \"~1.3.8\",\n        \"array-flatten\": \"1.1.1\",\n        \"body-parser\": \"1.20.1\",\n        \"content-disposition\": \"0.5.4\",\n        \"content-type\": \"~1.0.4\",\n        \"cookie\": \"0.5.0\",\n        \"debug\": \"2.6.9\",\n        \"depd\": \"2.0.0\",\n        \"encodeurl\": \"~1.0.2\",\n        \"escape-html\": \"~1.0.3\",\n        \"etag\": \"~1.8.1\",\n        \"finalhandler\": \"1.2.0\",\n        \"fresh\": \"0.5.2\",\n        \"http-errors\": \"2.0.0\",\n        \"mime\": \"2.6.0\",\n        \"morgan\": \"1.10.0\",\n        \"on-finished\": \"2.4.1\",\n        \"parseurl\": \"~1.3.3\",\n        \"path-to-regexp\": \"0.1.7\",\n        \"proxy-addr\": \"2.0.7\",\n        \"qs\": \"6.11.0\",\n        \"range-parser\": \"1.2.1\",\n        \"safe-buffer\": \"5.2.1\",\n        \"send\": \"0.18.0\",\n        \"serve-static\": \"1.15.0\",\n        \"setprototypeof\": \"1.2.0\",\n        \"statuses\": \"2.0.1\",\n        \"type-is\": \"1.6.18\",\n        \"utils-merge\": \"1.0.1\",\n        \"vary\": \"1.1.2\"\n      }\n    },\n    \"node_modules/mysql2\": {\n      \"version\": \"3.2.0\",\n      \"resolved\": \"https://registry.npmjs.org/mysql2/-/mysql2-3.2.0.tgz\",\n      \"integrity\": \"sha512-yyyy\",\n      \"engines\": {\n        \"node\": \">= 8.0.0\"\n      }\n    }\n  }\n}"
        },
        {
            "location": "./../../dockers/CVE-2021-40438/custom_no_tool/app/index.js",
            "content": "const express = require('express');\nconst mysql = require('mysql2');\nconst app = express();\n\n// Middleware to parse JSON bodies\napp.use(express.json());\n\n// Endpoint that reflects the \"cmd\" query parameter (vulnerable)\napp.get('/run', (req, res) => {\n  const { cmd } = req.query;\n  if (!cmd) {\n    return res.status(400).send('Missing cmd parameter');\n  }\n  // WARNING: This is intentionally vulnerable for demonstration purposes.\n  const { exec } = require('child_process');\n  exec(cmd, (error, stdout, stderr) => {\n    if (error) {\n      return res.status(500).send(`Error: ${error.message}`);\n    }\n    res.send(`Output:\\n${stdout}\\n${stderr}`);\n  });\n});\n\n// Simple health check endpoint\napp.get('/health', (req, res) => {\n  res.send('OK');\n});\n\n// Connect to MySQL and start the server\nconst connection = mysql.createConnection({\n  host: 'db',\n  user: 'user',\n  password: 'userpwd',\n  database: 'testdb'\n});\n\nconnection.connect(err => {\n  if (err) {\n    console.error('Database connection failed:', err);\n    process.exit(1);\n  }\n  console.log('Connected to MySQL');\n  app.listen(3000, () => {\n    console.log('App listening on port 3000');\n  });\n});"
        },
        {
            "location": "./../../dockers/CVE-2021-40438/custom_no_tool/app/wait-for-db.sh",
            "content": "#!/bin/sh\nwhile ! nc -z db 3306; do\n  echo \"Waiting for MySQL...\"\n  sleep 1\ndone\necho \"MySQL is up - executing command\"\nnode index.js"
        },
        {
            "location": "./../../dockers/CVE-2021-40438/custom_no_tool/db/init.sql",
            "content": "CREATE TABLE IF NOT EXISTS users (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(50) NOT NULL,\n  password VARCHAR(255) NOT NULL\n);\nINSERT INTO users (username, password) VALUES ('alice', 'alicepwd'), ('bob', 'bobpwd');"
        },
        {
            "location": "./../../dockers/CVE-2021-40438/custom_no_tool/httpd/Dockerfile",
            "content": "FROM httpd:2.4.49-alpine\nRUN apk update && apk add --no-cache curl\nCOPY httpd.conf /usr/local/apache2/conf/httpd.conf"
        },
        {
            "location": "./../../dockers/CVE-2021-40438/custom_no_tool/httpd/httpd.conf",
            "content": "# ServerRoot \"/usr/local/apache2\"\nServerRoot \"/usr/local/apache2\"\nListen 80\nLoadModule mpm_event_module modules/mod_mpm_event.so\nLoadModule authz_core_module modules/mod_authz_core.so\nLoadModule authz_host_module modules/mod_authz_host.so\nLoadModule dir_module modules/mod_dir.so\nLoadModule alias_module modules/mod_alias.so\nLoadModule rewrite_module modules/mod_rewrite.so\nLoadModule proxy_module modules/mod_proxy.so\nLoadModule proxy_http_module modules/mod_proxy_http.so\nLoadModule log_config_module modules/mod_log_config.so\nLoadModule env_module modules/mod_env.so\nLoadModule headers_module modules/mod_headers.so\nUser daemon\nGroup daemon\nServerAdmin you@example.com\nServerName localhost\nDocumentRoot \"/usr/local/apache2/htdocs\"\n<Directory \"/usr/local/apache2/htdocs\">\n    Options Indexes FollowSymLinks\n    AllowOverride All\n    Require all granted\n</Directory>\nErrorLog ${APACHE_LOG_DIR}/error.log\nCustomLog ${APACHE_LOG_DIR}/access.log combined\nProxyPass \"/\" \"http://app:3000/\"\nProxyPassReverse \"/\" \"http://app:3000/\""
        }
    ],
    "directory_tree": "./../../dockers/CVE-2021-40438/custom_no_tool"
}