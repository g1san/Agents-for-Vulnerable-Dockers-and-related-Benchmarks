{
    "files": [
        {
            "location": "./../../dockers/CVE-2021-35042/custom_no_tool/docker-compose.yml",
            "content": "version: \"3.8\"\nservices:\n  app:\n    build: ./app\n    ports:\n      - \"8080:8080\"\n    depends_on:\n      - db\n    environment:\n      - DB_HOST=db\n      - DB_PORT=5432\n      - DB_USER=user\n      - DB_PASSWORD=example\n      - DB_NAME=vulndb\n  db:\n    image: postgres:13-alpine\n    environment:\n      POSTGRES_USER: user\n      POSTGRES_PASSWORD: example\n      POSTGRES_DB: vulndb\n    volumes:\n      - db-data:/var/lib/postgresql/data\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql\n    ports:\n      - \"5432:5432\"\nvolumes:\n  db-data:"
        },
        {
            "location": "./../../dockers/CVE-2021-35042/custom_no_tool/app/Dockerfile",
            "content": "FROM node:14-alpine\nWORKDIR /usr/src/app\nCOPY package.json ./\nRUN npm install\nCOPY . .\nEXPOSE 8080\nCMD [ \"node\", \"app.js\" ]"
        },
        {
            "location": "./../../dockers/CVE-2021-35042/custom_no_tool/app/package.json",
            "content": "{\n  \"name\": \"vuln-app\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Demo app vulnerable to CVE-2021-35042\",\n  \"main\": \"app.js\",\n  \"scripts\": {\n    \"start\": \"node app.js\"\n  },\n  \"dependencies\": {\n    \"express\": \"4.16.0\",\n    \"pg\": \"8.5.1\",\n    \"tar\": \"4.4.13\"\n  }\n}"
        },
        {
            "location": "./../../dockers/CVE-2021-35042/custom_no_tool/app/app.js",
            "content": "const express = require('express');\nconst { Pool } = require('pg');\nconst tar = require('tar');\nconst path = require('path');\nconst fs = require('fs');\n\nconst app = express();\napp.use(express.json());\n\nconst pool = new Pool({\n  host: process.env.DB_HOST || 'db',\n  port: process.env.DB_PORT || 5432,\n  user: process.env.DB_USER || 'user',\n  password: process.env.DB_PASSWORD || 'example',\n  database: process.env.DB_NAME || 'vulndb'\n});\n\n// Ensure extraction directory exists\nconst extractDir = '/tmp/extract';\nfs.mkdirSync(extractDir, { recursive: true });\n\n// Vulnerable endpoint \u2013 extracts a tar archive without proper path sanitization (CVE-2021-35042)\napp.post('/upload', (req, res) => {\n  // In a real scenario, the tar file would be received in the request body.\n  // Here we simulate extraction of a pre\u2011stored malicious archive.\n  const maliciousArchive = path.join(__dirname, 'malicious.tar');\n  tar.x({\n    file: maliciousArchive,\n    C: extractDir // extraction directory\n    // The vulnerable version of tar does not enforce safe path checks.\n  })\n    .then(() => {\n      res.send('Archive extracted');\n    })\n    .catch(err => {\n      res.status(500).send('Extraction failed');\n    });\n});\n\napp.get('/users', async (req, res) => {\n  try {\n    const result = await pool.query('SELECT id, username FROM users');\n    res.json(result.rows);\n  } catch (e) {\n    res.status(500).send('DB error');\n  }\n});\n\napp.listen(8080, () => {\n  console.log('Vulnerable app listening on port 8080');\n});"
        },
        {
            "location": "./../../dockers/CVE-2021-35042/custom_no_tool/db/init.sql",
            "content": "CREATE TABLE users (\n  id SERIAL PRIMARY KEY,\n  username VARCHAR(50) NOT NULL,\n  password VARCHAR(60) NOT NULL\n);\n\nINSERT INTO users (username, password) VALUES\n('alice', 'password1'),\n('bob', 'password2');"
        },
        {
            "location": "./../../dockers/CVE-2021-35042/custom_no_tool/app/malicious.tar",
            "content": "UEsDBBQAAAAIAGV9bU0AAAAAAAAAAAAAAAALABwAbWFjaGluZV9maWxlLnR4dFVUCQADyQbYQ8kG2EF1eAsAAQT1AQAABNUEAAAA"
        }
    ],
    "directory_tree": "custom_no_tool/"
}