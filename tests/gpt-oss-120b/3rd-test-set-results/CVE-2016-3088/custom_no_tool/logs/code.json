{
    "files": [
        {
            "location": "./../../dockers/CVE-2016-3088/custom_no_tool/docker-compose.yml",
            "content": "services:\n  vulnerable_app:\n    build: ./vulnerable_app\n    ports:\n      - \"5000:5000\"\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    environment:\n      - DOCKER_HOST=unix:///var/run/docker.sock\n    restart: unless-stopped\n    networks:\n      - appnet\n  activemq:\n    image: rmohr/activemq:5.13.0\n    ports:\n      - \"61616:61616\"\n      - \"8161:8161\"\n    restart: unless-stopped\n    networks:\n      - appnet\nnetworks:\n  appnet:"
        },
        {
            "location": "./../../dockers/CVE-2016-3088/custom_no_tool/vulnerable_app/Dockerfile",
            "content": "FROM python:3-slim\n\n# Install system packages needed for user/group creation\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n    passwd \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Create the docker group required for socket access\nRUN groupadd -r docker\n\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\n# Create a non\u2011root system user and group for running the app, add to docker group\nRUN groupadd -r appgroup && \\\n    useradd -r -g appgroup appuser && \\\n    usermod -aG docker appuser\n\nCOPY app.py .\nEXPOSE 5000\n\n# Switch to the non\u2011root user\nUSER appuser\n\nCMD [\"python\", \"app.py\"]"
        },
        {
            "location": "./../../dockers/CVE-2016-3088/custom_no_tool/vulnerable_app/requirements.txt",
            "content": "Flask==2.3.3\ndocker==6.1.3\nJinja2==3.1.2"
        },
        {
            "location": "./../../dockers/CVE-2016-3088/custom_no_tool/vulnerable_app/app.py",
            "content": "# -*- coding: utf-8 -*-\nimport time\nimport sys\nfrom flask import Flask, request, jsonify\nimport docker\nfrom docker.errors import DockerException\n\napp = Flask(__name__)\n\n# -----------------------------------------------\n# Docker client initialization with retry logic\n# -----------------------------------------------\n\ndef get_docker_client(retries=3, delay=2):\n    for attempt in range(1, retries + 1):\n        try:\n            # Use environment variables (DOCKER_HOST) \u2013 fallback to default socket\n            client = docker.from_env()\n            # Trigger a cheap API call to verify connectivity\n            client.ping()\n            return client\n        except DockerException as e:\n            if attempt == retries:\n                raise\n            time.sleep(delay)\n    # Should never reach here\n    raise DockerException(\"Unable to establish Docker client connection after retries\")\n\n# Initialise client lazily \u2013 the first request will attempt connection\nclient = None\n\n@app.route('/')\ndef index():\n    return 'Vulnerable Docker API Demo - CVE-2016-3088'\n\n@app.route('/run', methods=['POST'])\ndef run_container():\n    global client\n    if client is None:\n        try:\n            client = get_docker_client()\n        except DockerException as e:\n            return jsonify({'error': f'Docker client init failed: {e}'}), 500\n\n    data = request.get_json()\n    if not data or 'image' not in data:\n        return jsonify({'error': 'Missing \"image\" field'}), 400\n    image = data['image']\n    try:\n        # Pull the requested image without validation (demonstration purposes)\n        client.images.pull(image)\n        # Run container with safe defaults \u2013 no privileged flag, default bridge network\n        container = client.containers.run(\n            image,\n            detach=True,\n            tty=True,\n        )\n        return jsonify({\n            'status': 'container started',\n            'id': container.id[:12]\n        })\n    except DockerException as e:\n        return jsonify({'error': str(e)}), 500\n    except Exception as e:\n        # Catch any unexpected errors\n        return jsonify({'error': str(e)}), 500\n\nif __name__ == '__main__':\n    # Bind to all interfaces so it is reachable from host\n    app.run(host='0.0.0.0', port=5000)\n"
        }
    ],
    "directory_tree": "CVE-2016-3088/custom_no_tool"
}