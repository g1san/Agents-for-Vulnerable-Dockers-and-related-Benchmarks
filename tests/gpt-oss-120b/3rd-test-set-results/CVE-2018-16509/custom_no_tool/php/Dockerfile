FROM php:7.4-fpm-alpine3.13

# Install build dependencies, runtime libraries, vulnerable Ghostscript, and Python stack
RUN apk add --no-cache \
        $PHPIZE_DEPS \
        build-base \
        zlib-dev \
        libpng-dev \
        libjpeg-turbo-dev \
        freetype-dev \
        ghostscript=9.23-r0 \
        python3 \
        py3-pip \
        python3-dev \
    && docker-php-ext-configure gd --with-freetype --with-jpeg \
    && docker-php-ext-install mysqli pdo pdo_mysql gd \
    && python3 -m ensurepip \
    && pip3 install --no-cache-dir flask pillow \
    && apk del $PHPIZE_DEPS build-base python3-dev \
    && rm -rf /var/cache/apk/* /root/.cache