FROM ubuntu:22.04
ARG HADOOP_VERSION=3.3.4
ENV HADOOP_HOME=/opt/hadoop
# Install prerequisites and Hadoop native dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        wget gnupg openjdk-11-jdk \
        libssl3 libpam0g libprotobuf-lite23 ca-certificates && \
    rm -rf /var/lib/apt/lists/*
# Download Hadoop binary from Apache archive (mirrors may be unavailable)
RUN wget https://archive.apache.org/dist/hadoop/common/hadoop-${HADOOP_VERSION}/hadoop-${HADOOP_VERSION}.tar.gz -O /tmp/hadoop.tar.gz && \
    mkdir -p ${HADOOP_HOME} && \
    tar -xzf /tmp/hadoop.tar.gz -C ${HADOOP_HOME} --strip-components=1 && \
    rm /tmp/hadoop.tar.gz
# Adjust permissions for the vulnerable container-executor binary (setâ€‘uid root)
RUN if [ -f "${HADOOP_HOME}/bin/container-executor" ]; then \
        chown root:root ${HADOOP_HOME}/bin/container-executor && \
        chmod 4755 ${HADOOP_HOME}/bin/container-executor; \
    fi
WORKDIR ${HADOOP_HOME}
EXPOSE 8088 8042