{
    "files": [
        {
            "location": "./../../dockers/CVE-2023-25157/custom_no_tool/docker-compose.yml",
            "content": "services:\n  web:\n    build: ./web\n    ports:\n      - \"5000:5000\"\n    environment:\n      - REDIS_HOST=redis\n      - POSTGRES_HOST=db\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=example\n      - POSTGRES_DB=vulnapp\n    depends_on:\n      db:\n        condition: service_healthy\n      redis:\n        condition: service_started\n  redis:\n    image: redis:7.0.0\n    command: [\"redis-server\", \"--appendonly\", \"yes\"]\n    ports:\n      - \"6379:6379\"\n  db:\n    image: postgres:15\n    environment:\n      POSTGRES_USER: postgres\n      POSTGRES_PASSWORD: example\n      POSTGRES_DB: vulnapp\n    ports:\n      - \"5432:5432\"\n    volumes:\n      - db_data:/var/lib/postgresql/data\n      - type: bind\n        source: ./db/init.sql\n        target: /docker-entrypoint-initdb.d/init.sql\n    healthcheck:\n      test: [\"CMD\", \"pg_isready\", \"-U\", \"postgres\"]\n      interval: 5s\n      timeout: 2s\n      retries: 10\n  geoserver:\n    image: osgeo/geoserver:2.19.0\n    ports:\n      - \"8080:8080\"\n    environment:\n      - GEOSERVER_ADMIN_PASSWORD=geoserver\n    volumes:\n      - geoserver_data:/opt/geoserver/data_dir\nvolumes:\n  db_data:\n  geoserver_data:\n"
        },
        {
            "location": "./../../dockers/CVE-2023-25157/custom_no_tool/web/Dockerfile",
            "content": "FROM python:3.10-slim\nWORKDIR /app\n# Install system packages needed for PostgreSQL client and for compiling psycopg2\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n    postgresql-client gcc libpq-dev python3-dev && \\\n    rm -rf /var/lib/apt/lists/*\n# Install Python dependencies\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n# Remove build\u2011time packages to keep the image small (keep postgresql-client for pg_isready)\nRUN apt-get purge -y --auto-remove gcc libpq-dev python3-dev && \\\n    rm -rf /var/lib/apt/lists/*\n# Copy the start\u2011up script and make it executable\nCOPY start.sh /start.sh\nRUN chmod +x /start.sh\n# Copy the application code\nCOPY . .\nEXPOSE 5000\nENTRYPOINT [\"/start.sh\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2023-25157/custom_no_tool/web/start.sh",
            "content": "#!/bin/sh\n# Ensure POSTGRES_USER has a fallback value\nPOSTGRES_USER=${POSTGRES_USER:-postgres}\n# Wait for PostgreSQL to become reachable\nwhile ! pg_isready -h $POSTGRES_HOST -p 5432 -U $POSTGRES_USER > /dev/null 2>&1; do\n  echo \"Waiting for PostgreSQL at $POSTGRES_HOST:5432...\"\n  sleep 1\ndone\n# Start the Flask application\nexec python app.py\n"
        },
        {
            "location": "./../../dockers/CVE-2023-25157/custom_no_tool/web/requirements.txt",
            "content": "flask==2.2.5\nredis==5.0.0\npsycopg2-binary==2.9.9\n"
        },
        {
            "location": "./../../dockers/CVE-2023-25157/custom_no_tool/web/app.py",
            "content": "from flask import Flask, request, jsonify\nimport redis\nimport psycopg2\nimport os\n\napp = Flask(__name__)\n\n# Connect to Redis (vulnerable version)\nredis_client = redis.StrictRedis(host=os.getenv('REDIS_HOST', 'redis'), port=6379, decode_responses=True)\n\n# Connect to PostgreSQL (connection will be established after the wait script)\npg_conn = psycopg2.connect(\n    host=os.getenv('POSTGRES_HOST', 'db'),\n    user=os.getenv('POSTGRES_USER', 'postgres'),\n    password=os.getenv('POSTGRES_PASSWORD', 'example'),\n    dbname=os.getenv('POSTGRES_DB', 'vulnapp')\n)\n\n@app.route('/set', methods=['POST'])\ndef set_key():\n    key = request.form.get('key')\n    value = request.form.get('value')\n    redis_client.set(key, value)\n    return jsonify({'status': 'ok'})\n\n@app.route('/get', methods=['GET'])\ndef get_key():\n    key = request.args.get('key')\n    value = redis_client.get(key)\n    return jsonify({'key': key, 'value': value})\n\n@app.route('/users', methods=['GET'])\ndef list_users():\n    cursor = pg_conn.cursor()\n    cursor.execute('SELECT id, username FROM users')\n    rows = cursor.fetchall()\n    return jsonify([{'id': r[0], 'username': r[1]} for r in rows])\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000)\n"
        },
        {
            "location": "./../../dockers/CVE-2023-25157/custom_no_tool/db/init.sql",
            "content": "CREATE TABLE IF NOT EXISTS users (\n    id SERIAL PRIMARY KEY,\n    username VARCHAR(50) NOT NULL,\n    password VARCHAR(255) NOT NULL\n);\nINSERT INTO users (username, password) VALUES\n    ('alice', 'password1'),\n    ('bob', 'password2');\n"
        }
    ],
    "directory_tree": "CVE-2023-25157/custom_no_tool"
}