{
    "files": [
        {
            "location": "./../../dockers/CVE-2018-7602/custom_no_tool/Dockerfile",
            "content": "FROM php:7.4-apache\n\n# Install required packages, PHP extensions, Composer and Drush\nRUN apt-get update && \\\n    apt-get install -y --no-install-recommends \\\n        git \\\n        unzip \\\n        libpng-dev \\\n        libjpeg-dev \\\n        libfreetype6-dev \\\n        libzip-dev \\\n        libpq-dev \\\n        default-mysql-client \\\n        libonig-dev \\\n        libxml2-dev \\\n        curl \\\n        ca-certificates \\\n        libcurl4-openssl-dev && \\\n    docker-php-ext-configure gd --with-freetype --with-jpeg && \\\n    docker-php-ext-install pdo pdo_mysql gd mbstring xml json curl zip && \\\n    a2enmod rewrite && \\\n    # Prepare Composer home for www-data\n    mkdir -p /home/www-data/.composer && \\\n    chown -R www-data:www-data /home/www-data/.composer && \\\n    # Install Composer and Drush as www-data\n    su -s /bin/bash www-data -c \"curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer && \\\n    export COMPOSER_ALLOW_SUPERUSER=1 && \\\n    composer global require drush/drush:^8 --no-interaction && \\\n    ln -s /home/www-data/.composer/vendor/bin/drush /usr/local/bin/drush\" && \\\n    # Clean up apt caches\n    apt-get clean && rm -rf /var/lib/apt/lists/*\n\n# Set working directory and fetch Drupal 7.58\nWORKDIR /var/www/html\nRUN git clone --branch 7.58 --depth 1 https://github.com/drupal/drupal.git .\n\n# Add custom entrypoint and sample SQL, set permissions\nCOPY entrypoint.sh /usr/local/bin/docker-entrypoint-custom.sh\nCOPY init-db.sql /tmp/init-db.sql\nRUN chmod +x /usr/local/bin/docker-entrypoint-custom.sh && \\\n    chown -R www-data:www-data /var/www/html\n\n# Run as the web\u2011server user so Drush has proper permissions\nUSER www-data\n\n# Use the custom entrypoint that installs Drupal then loads sample data\nENTRYPOINT [\"/usr/local/bin/docker-entrypoint-custom.sh\"]\n\nEXPOSE 80"
        },
        {
            "location": "./../../dockers/CVE-2018-7602/custom_no_tool/docker-compose.yml",
            "content": "version: '3.8'\nservices:\n  drupal:\n    build: .\n    ports:\n      - \"8080:80\"\n    environment:\n      DRUPAL_DB_HOST: db\n      DRUPAL_DB_USER: drupal\n      DRUPAL_DB_PASSWORD: drupal_pass\n      DRUPAL_DB_NAME: drupaldb\n    depends_on:\n      - db\n  db:\n    image: mysql:5.7\n    environment:\n      MYSQL_ROOT_PASSWORD: root_pass\n      MYSQL_DATABASE: drupaldb\n      MYSQL_USER: drupal\n      MYSQL_PASSWORD: drupal_pass\n    volumes:\n      - db_data:/var/lib/mysql\n    healthcheck:\n      test: [\"CMD\", \"mysqladmin\", \"ping\", \"-h\", \"localhost\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\nvolumes:\n  db_data:"
        },
        {
            "location": "./../../dockers/CVE-2018-7602/custom_no_tool/entrypoint.sh",
            "content": "#!/bin/bash\nset -e\n\n# Wait for MySQL to become reachable\nwhile ! mysql -h\"${DRUPAL_DB_HOST}\" -u\"${DRUPAL_DB_USER}\" -p\"${DRUPAL_DB_PASSWORD}\" -e \"SELECT 1\" \"${DRUPAL_DB_NAME}\" >/dev/null 2>&1; do\n  echo \"Waiting for MySQL to be ready...\"\n  sleep 5\ndone\n\n# If Drupal is not yet installed, perform site installation using Drush\nif ! drush status bootstrap | grep -q \"Successful\"; then\n  echo \"Installing Drupal site...\"\n  drush site-install standard \\\n    --db-url=\"mysql://${DRUPAL_DB_USER}:${DRUPAL_DB_PASSWORD}@${DRUPAL_DB_HOST}/${DRUPAL_DB_NAME}\" \\\n    --site-name=\"Demo Site\" \\\n    --account-name=admin \\\n    --account-pass=admin \\\n    --yes\n  echo \"Loading sample data...\"\n  drush sql-cli < /tmp/init-db.sql\nfi\n\n# Finally launch the original Apache command\nexec apache2-foreground"
        },
        {
            "location": "./../../dockers/CVE-2018-7602/custom_no_tool/init-db.sql",
            "content": "-- Sample content for Drupal (will be loaded after site installation)\nINSERT INTO node (nid, vid, type, language, status, created, changed, promote, sticky, tnid, translate) VALUES (1, 1, 'page', 'en', 1, UNIX_TIMESTAMP(), UNIX_TIMESTAMP(), 1, 0, 0, 0);\nINSERT INTO node_revision (nid, vid, uid, title, log, timestamp, status) VALUES (1, 1, 1, 'Test Page', '', UNIX_TIMESTAMP(), 1);\nINSERT INTO node_field_data (nid, vid, type, langcode, status, created, changed, promote, sticky, default_langcode) VALUES (1, 1, 'page', 'en', 1, UNIX_TIMESTAMP(), UNIX_TIMESTAMP(), 1, 0, 1);"
        }
    ],
    "directory_tree": "CVE-2018-7602/custom_no_tool"
}