from django.http import JsonResponse
from django.db.models.functions import Extract
from .models import Event

def vulnerable_view(request):
    lookup = request.GET.get('lookup_name', 'year')
    # Directly passing user-controlled string to Extract leads to SQL injection
    try:
        qs = Event.objects.annotate(val=Extract('start_datetime', lookup)).values('val')
        result = list(qs)
        return JsonResponse({'result': result})
    except Exception as e:
        return JsonResponse({'error': str(e)})