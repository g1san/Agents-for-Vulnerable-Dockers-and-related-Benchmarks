{
    "files": [
        {
            "location": "./../../dockers/CVE-2018-7600/custom_no_tool/docker-compose.yml",
            "content": "version: \"3.8\"\n\nservices:\n  db:\n    image: mariadb:10.1\n    container_name: drupal_db\n    restart: always\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpass\n      MYSQL_DATABASE: drupal\n      MYSQL_USER: drupal\n      MYSQL_PASSWORD: drupal\n    volumes:\n      - db_data:/var/lib/mysql\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql\n\n  drupal:\n    build:\n      context: ./drupal\n    container_name: drupal_web\n    depends_on:\n      - db\n    ports:\n      - \"8080:80\"\n    environment:\n      DRUPAL_DB_HOST: db\n      DRUPAL_DB_USER: drupal\n      DRUPAL_DB_PASSWORD: drupal\n      DRUPAL_DB_NAME: drupal\n    volumes:\n      - drupal_data:/var/www/html\n\nvolumes:\n  db_data:\n  drupal_data:"
        },
        {
            "location": "./../../dockers/CVE-2018-7600/custom_no_tool/drupal/Dockerfile",
            "content": "FROM php:7.3-apache\n\n# Install required system packages and PHP extensions (including MariaDB client and PDO MySQL)\nRUN apt-get update && \\\n    apt-get install -y --no-install-recommends \\\n        ca-certificates \\\n        libzip-dev \\\n        libpng-dev libjpeg-dev libfreetype6-dev libpq-dev libxml2-dev \\\n        git unzip wget mariadb-client && \\\n    docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ && \\\n    docker-php-ext-install -j$(nproc) gd xml zip pdo_mysql && \\\n    rm -rf /var/lib/apt/lists/*\n\n# Install Composer\nRUN php -r \"copy('https://getcomposer.org/installer', 'composer-setup.php');\" && \\\n    php composer-setup.php --install-dir=/usr/local/bin --filename=composer && \\\n    php -r \"unlink('composer-setup.php');\"\n\n# Install Drush 8 globally\nRUN composer global require drush/drush:8.* && \\\n    ln -s /root/.composer/vendor/bin/drush /usr/local/bin/drush\n\n# Download vulnerable Drupal 7.58\nARG DRUPAL_VERSION=7.58\nENV DRUPAL_VERSION=${DRUPAL_VERSION}\nRUN wget https://ftp.drupal.org/files/projects/drupal-${DRUPAL_VERSION}.tar.gz && \\\n    tar -xzf drupal-${DRUPAL_VERSION}.tar.gz --strip-components=1 && \\\n    rm drupal-${DRUPAL_VERSION}.tar.gz && \\\n    chown -R www-data:www-data /var/www/html\n\n# Copy custom entrypoint and settings\nCOPY entrypoint.sh /entrypoint.sh\nCOPY settings.php /var/www/html/sites/default/settings.php\n\n# Ensure the MariaDB client is in PATH and start Apache\nENV PATH=\"/usr/bin:${PATH}\"\nENTRYPOINT [\"/entrypoint.sh\"]"
        },
        {
            "location": "./../../dockers/CVE-2018-7600/custom_no_tool/drupal/entrypoint.sh",
            "content": "#!/bin/bash\nset -e\n\n# Wait for MariaDB to become reachable\nwhile ! mysqladmin ping -h\"${DRUPAL_DB_HOST}\" -u\"${DRUPAL_DB_USER}\" -p\"${DRUPAL_DB_PASSWORD}\" --silent; do\n  echo \"Waiting for MariaDB at ${DRUPAL_DB_HOST}...\"\n  sleep 2\ndone\n\necho \"MariaDB is up - continuing with Drupal setup\"\n\n# Run drush site:install only if the site is not already installed\nif [ ! -f /var/www/html/sites/default/settings.php ] || ! grep -q \"\\$databases\" /var/www/html/sites/default/settings.php; then\n  drush site:install standard \\\n    --account-name=admin \\\n    --account-pass=admin \\\n    --db-url=\"mysqli://${DRUPAL_DB_USER}:${DRUPAL_DB_PASSWORD}@${DRUPAL_DB_HOST}/${MYSQL_DATABASE}\" \\\n    --yes\nfi\n\n# Start Apache in the foreground\nexec apache2-foreground"
        },
        {
            "location": "./../../dockers/CVE-2018-7600/custom_no_tool/drupal/settings.php",
            "content": "<?php\n$databases = array (\n  'default' => \n  array (\n    'default' => \n    array (\n      'database' => getenv('DRUPAL_DB_DATABASE') ?: 'drupal',\n      'username' => getenv('DRUPAL_DB_USER') ?: 'drupal',\n      'password' => getenv('DRUPAL_DB_PASSWORD') ?: 'drupal',\n      'host' => getenv('DRUPAL_DB_HOST') ?: 'db',\n      'port' => '3306',\n      'driver' => 'mysql',\n      'prefix' => '',\n    ),\n  ),\n);\n\n$conf['hash_salt'] = 'a1b2c3d4e5f6g7h8i9j0';\n$update_free_access = FALSE;\n?>"
        },
        {
            "location": "./../../dockers/CVE-2018-7600/custom_no_tool/db/init.sql",
            "content": "CREATE DATABASE IF NOT EXISTS drupal CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;\nUSE drupal;\n\nCREATE TABLE IF NOT EXISTS users (\n  uid INT UNSIGNED NOT NULL AUTO_INCREMENT,\n  name VARCHAR(60) NOT NULL DEFAULT '',\n  pass VARCHAR(255) NOT NULL DEFAULT '',\n  mail VARCHAR(254) NOT NULL DEFAULT '',\n  status TINYINT(4) NOT NULL DEFAULT 0,\n  created INT UNSIGNED NOT NULL DEFAULT 0,\n  access INT UNSIGNED NOT NULL DEFAULT 0,\n  login INT UNSIGNED NOT NULL DEFAULT 0,\n  PRIMARY KEY (uid),\n  UNIQUE KEY name (name)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nINSERT INTO users (name, pass, mail, status, created, access, login) VALUES\n('admin', MD5('admin'), 'admin@example.com', 1, UNIX_TIMESTAMP(), UNIX_TIMESTAMP(), UNIX_TIMESTAMP());\n"
        }
    ],
    "directory_tree": "CVE-2018-7600"
}