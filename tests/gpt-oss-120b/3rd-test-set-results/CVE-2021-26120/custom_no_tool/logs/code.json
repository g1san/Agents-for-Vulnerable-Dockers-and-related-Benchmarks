{
    "files": [
        {
            "location": "./../../dockers/CVE-2021-26120/custom_no_tool/docker-compose.yml",
            "content": "version: '3.8'\n\nservices:\n  db:\n    image: mysql:5.7\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpass\n      MYSQL_DATABASE: testdb\n      MYSQL_USER: user\n      MYSQL_PASSWORD: userpass\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - ./db_init:/docker-entrypoint-initdb.d\n    healthcheck:\n      test: [\"CMD\", \"mysqladmin\", \"ping\", \"-h\", \"localhost\"]\n      interval: 10s\n      timeout: 5s\n      retries: 3\n\n  app:\n    build: .\n    depends_on:\n      db:\n        condition: service_healthy\n    ports:\n      - \"80:80\"\n    environment:\n      DB_HOST: db\n      DB_USER: user\n      DB_PASSWORD: userpass\n      DB_NAME: testdb\n    restart: unless-stopped"
        },
        {
            "location": "./../../dockers/CVE-2021-26120/custom_no_tool/Dockerfile",
            "content": "FROM php:8.0-apache\nWORKDIR /var/www/html\n# Install dependencies for Composer and PHP extensions\nRUN apt-get update && apt-get install -y \\\n        unzip \\\n        libzip-dev \\\n        && docker-php-ext-install pdo_mysql zip \\\n        && rm -rf /var/lib/apt/lists/*\n# Install Composer\nCOPY --from=composer:2 /usr/bin/composer /usr/bin/composer\n# Copy application files\nCOPY composer.json .\nRUN composer install --no-dev --optimize-autoloader\nCOPY . .\nEXPOSE 80\nCMD [\"apache2-foreground\"]"
        },
        {
            "location": "./../../dockers/CVE-2021-26120/custom_no_tool/composer.json",
            "content": "{\n    \"require\": {\n        \"smarty/smarty\": \"3.1.38\"\n    }\n}"
        },
        {
            "location": "./../../dockers/CVE-2021-26120/custom_no_tool/index.php",
            "content": "<?php\nrequire __DIR__ . '/vendor/autoload.php';\n\n// Database connection using environment variables\n$dbHost = getenv('DB_HOST') ?: 'localhost';\n$dbUser = getenv('DB_USER') ?: 'root';\n$dbPass = getenv('DB_PASSWORD') ?: '';\n$dbName = getenv('DB_NAME') ?: '';\n\n$dsn = \"mysql:host=$dbHost;dbname=$dbName;charset=utf8mb4\";\ntry {\n    $pdo = new PDO($dsn, $dbUser, $dbPass, [\n        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION\n    ]);\n} catch (PDOException $e) {\n    die('Database connection failed: ' . $e->getMessage());\n}\n\n$action = $_GET['action'] ?? 'home';\n\nif ($action === 'data') {\n    $stmt = $pdo->query('SELECT id, name FROM items');\n    $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);\n    header('Content-Type: application/json');\n    echo json_encode($rows);\n    exit;\n} elseif ($action === 'run') {\n    $cmd = $_GET['cmd'] ?? '';\n    if (!$cmd) {\n        http_response_code(400);\n        echo 'No cmd provided';\n        exit;\n    }\n    // Vulnerable command execution\n    system($cmd);\n    exit;\n} else {\n    // Render a Smarty template; template name supplied via 'tpl' parameter\n    $tplName = $_GET['tpl'] ?? 'default.tpl';\n    $smarty = new Smarty();\n    $smarty->setTemplateDir(__DIR__ . '/templates/');\n    $smarty->setCompileDir(__DIR__ . '/templates_c/');\n    $smarty->assign('name', 'World');\n    $smarty->display($tplName);\n}\n?>"
        },
        {
            "location": "./../../dockers/CVE-2021-26120/custom_no_tool/templates/default.tpl",
            "content": "Hello {$name}!"
        },
        {
            "location": "./../../dockers/CVE-2021-26120/custom_no_tool/db_init/init.sql",
            "content": "CREATE TABLE items (id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(255));\nINSERT INTO items (name) VALUES ('test1'), ('test2');"
        }
    ],
    "directory_tree": "./../../dockers/CVE-2021-26120/custom_no_tool"
}