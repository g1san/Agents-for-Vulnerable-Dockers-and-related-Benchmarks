{
    "files": [
        {
            "location": "./../../dockers/CVE-2017-3066/custom_no_tool/docker-compose.yml",
            "content": "services:\n  coldfusion:\n    build:\n      context: ./coldfusion\n    image: adobe/coldfusion:10u22\n    ports:\n      - \"8500:8500\"\n    environment:\n      - LICENSE=accept\n\n  vulnerable-app:\n    build:\n      context: ./vulnerable-app\n    depends_on:\n      - coldfusion\n    environment:\n      CF_HOST: http://coldfusion:8500\n    ports:\n      - \"5000:5000\"\n"
        },
        {
            "location": "./../../dockers/CVE-2017-3066/custom_no_tool/coldfusion/Dockerfile",
            "content": "FROM python:3.11-slim\nWORKDIR /app\nRUN pip install --no-cache-dir flask\nCOPY app.py .\nEXPOSE 8500\nCMD [\"python\", \"app.py\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2017-3066/custom_no_tool/coldfusion/app.py",
            "content": "from flask import Flask, request, jsonify\n\napp = Flask(__name__)\n\n@app.route('/')\ndef index():\n    return 'Simulated ColdFusion server for CVE-2017-3066'\n\n@app.route('/flex2gateway/', methods=['GET', 'POST'])\ndef flex2gateway():\n    # Placeholder response mimicking the BlazeDS endpoint\n    return jsonify({'message': 'BlazeDS endpoint placeholder'}), 200\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=8500)\n"
        },
        {
            "location": "./../../dockers/CVE-2017-3066/custom_no_tool/vulnerable-app/Dockerfile",
            "content": "FROM python:3.11-slim\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY app.py .\nEXPOSE 5000\nCMD [\"python\", \"app.py\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2017-3066/custom_no_tool/vulnerable-app/requirements.txt",
            "content": "flask==2.2.5\nrequests==2.31.0\n"
        },
        {
            "location": "./../../dockers/CVE-2017-3066/custom_no_tool/vulnerable-app/app.py",
            "content": "import os\nimport json\nfrom flask import Flask, request, jsonify, Response\nimport requests\n\napp = Flask(__name__)\n\n# ColdFusion endpoint (insecure, no auth)\nCF_HOST = os.getenv('CF_HOST', 'http://localhost:8500')\n\n@app.route('/')\ndef index():\n    return 'Vulnerable app - CVE-2017-3066 demonstration (ColdFusion)'\n\n# Endpoint that forwards arbitrary HTTP requests to the ColdFusion server (demonstrates the vulnerable deserialization path)\n@app.route('/coldfusion', methods=['POST'])\ndef cf_proxy():\n    method = request.json.get('method', 'GET').upper()\n    path = request.json.get('path', '/flex2gateway/')\n    data = request.json.get('data')\n    headers = request.json.get('headers', {})\n    url = f\"{CF_HOST}{path}\"\n    try:\n        resp = requests.request(method, url, json=data, headers=headers, timeout=10)\n        # Preserve original content type and status code\n        return (resp.content, resp.status_code, resp.headers.items())\n    except Exception as e:\n        return jsonify({'error': str(e)}), 500\n\n# Simple test endpoint that triggers a request to a known vulnerable BlazeDS endpoint\n@app.route('/trigger', methods=['POST'])\ndef trigger():\n    # This payload mimics a typical AMF request; in a real exploit it would contain a malicious serialized object.\n    payload = request.json.get('payload', {})\n    url = f\"{CF_HOST}/flex2gateway/\"\n    try:\n        resp = requests.post(url, json=payload, timeout=10)\n        return jsonify({'status_code': resp.status_code, 'response': resp.text})\n    except Exception as e:\n        return jsonify({'error': str(e)}), 500\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000)\n"
        }
    ],
    "directory_tree": "CVE-2017-3066/custom_no_tool"
}