#!/bin/sh

# Wait until CouchDB responds to the health endpoint
while ! curl -s http://127.0.0.1:5984/_up > /dev/null; do
  echo "Waiting for CouchDB to become ready..."
  sleep 2
done

echo "CouchDB is up. Creating test user..."

# Create the test user using the admin credentials defined in the environment
curl -s -X PUT \
  -H "Content-Type: application/json" \
  -d @/docker-entrypoint-initdb.d/init-user.json \
  http://$COUCHDB_USER:$COUCHDB_PASSWORD@127.0.0.1:5984/_users/org.couchdb.user:testuser