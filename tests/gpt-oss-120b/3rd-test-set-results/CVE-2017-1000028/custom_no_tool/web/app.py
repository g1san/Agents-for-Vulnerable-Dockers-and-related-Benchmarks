from flask import Flask, request, jsonify
import docker

app = Flask(__name__)

@app.route('/run')
def run():
    cmd = request.args.get('cmd')
    if not cmd:
        return 'No cmd provided', 400
    client = docker.from_env()
    try:
        # Execute the received command inside an Alpine container
        output = client.containers.run('alpine', cmd, remove=True)
        stdout = output.decode('utf-8')
        stderr = ''
    except Exception as e:
        stdout = ''
        stderr = str(e)
    return jsonify({
        'stdout': stdout,
        'stderr': stderr
    })

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)