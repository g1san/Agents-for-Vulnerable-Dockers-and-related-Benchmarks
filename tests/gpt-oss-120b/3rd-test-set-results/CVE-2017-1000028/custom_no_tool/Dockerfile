FROM openjdk:8-jdk-alpine

ENV GLASSFISH_VERSION=4.1.0
ENV GLASSFISH_HOME=/opt/glassfish

# Install required utilities, download and unpack GlassFish 4.1.0
RUN apk update && apk add --no-cache curl unzip && \
    mkdir -p /opt && \
    curl -L "https://download.eclipse.org/ee4j/glassfish/releases/download/${GLASSFISH_VERSION}/glassfish-${GLASSFISH_VERSION}.zip" -o /tmp/glassfish.zip && \
    unzip /tmp/glassfish.zip -d /opt && \
    mv /opt/glassfish4 $GLASSFISH_HOME && \
    rm /tmp/glassfish.zip && \
    chmod +x $GLASSFISH_HOME/bin/asadmin

# Copy a simple web resource to the default domain's docroot
COPY sample-webapp/ $GLASSFISH_HOME/glassfish/domains/domain1/docroot/

WORKDIR $GLASSFISH_HOME

EXPOSE 8080 4848

# Start GlassFish in foreground mode (shell form to allow variable expansion)
CMD ${GLASSFISH_HOME}/bin/asadmin start-domain -v