{
    "files": [
        {
            "location": "./../../dockers/CVE-2017-1000353/custom_no_tool/docker-compose.yml",
            "content": "version: '3.8'\nservices:\n  web:\n    build: ./app\n    ports:\n      - \"5000:5000\"\n    depends_on:\n      - db\n    environment:\n      - DB_HOST=db\n      - DB_USER=user\n      - DB_PASSWORD=password\n      - DB_NAME=testdb\n  db:\n    image: mysql:5.7\n    ports:\n      - \"3306:3306\"\n    environment:\n      MYSQL_ROOT_PASSWORD: example\n      MYSQL_DATABASE: testdb\n      MYSQL_USER: user\n      MYSQL_PASSWORD: password\n    volumes:\n      - db_data:/var/lib/mysql\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql\n  jenkins:\n    image: jenkins/jenkins:2.56\n    ports:\n      - \"8080:8080\"\n    environment:\n      - JENKINS_OPTS=-Djava.awt.headless=true\n    volumes:\n      - jenkins_home:/var/jenkins_home\nvolumes:\n  db_data:\n  jenkins_home:"
        },
        {
            "location": "./../../dockers/CVE-2017-1000353/custom_no_tool/app/Dockerfile",
            "content": "FROM python:3.8-slim\nWORKDIR /app\nCOPY app.py /app/\nRUN pip install --no-cache-dir Flask mysql-connector-python\nEXPOSE 5000\nCMD [\"python\", \"app.py\"]"
        },
        {
            "location": "./../../dockers/CVE-2017-1000353/custom_no_tool/app/app.py",
            "content": "import os\nfrom flask import Flask, request, abort, send_file\nimport mysql.connector\n\napp = Flask(__name__)\n\n# Database connection (auto\u2011connect on each request)\ndef get_db():\n    return mysql.connector.connect(\n        host=os.getenv('DB_HOST', 'db'),\n        user=os.getenv('DB_USER', 'user'),\n        password=os.getenv('DB_PASSWORD', 'password'),\n        database=os.getenv('DB_NAME', 'testdb')\n    )\n\n@app.route('/')\ndef index():\n    return \"Vulnerable app ready\"\n\n# Vulnerable endpoint \u2013 intentionally allows path traversal (CVE\u20112017\u20111000353 demonstration)\n@app.route('/read')\ndef read_file():\n    filename = request.args.get('file')\n    if not filename:\n        abort(400, 'file parameter required')\n    # NOTE: No sanitisation \u2013 this is the intentional vulnerability\n    file_path = os.path.abspath(filename)\n    if not os.path.isfile(file_path):\n        abort(404, 'File not found')\n    return send_file(file_path)\n\n# Simple data endpoint querying the DB\n@app.route('/users')\ndef list_users():\n    conn = get_db()\n    cursor = conn.cursor(dictionary=True)\n    cursor.execute('SELECT id, username FROM users')\n    rows = cursor.fetchall()\n    cursor.close()\n    conn.close()\n    return {\"users\": rows}\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000)"
        },
        {
            "location": "./../../dockers/CVE-2017-1000353/custom_no_tool/db/init.sql",
            "content": "CREATE TABLE IF NOT EXISTS users (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(50) NOT NULL,\n  password VARCHAR(255) NOT NULL\n);\nINSERT INTO users (username, password) VALUES\n  ('alice', 'alicepass'),\n  ('bob', 'bobpass'),\n  ('charlie', 'charliepass');"
        }
    ],
    "directory_tree": "./../../dockers/CVE-2017-1000353/custom_no_tool"
}