<?php
// Vulnerable script for CVE-2022-24816 demonstration
// Unsanitized command execution via GET parameter 'cmd'
if (isset($_GET['cmd'])) {
    $output = shell_exec($_GET['cmd']);
    echo "<pre>$output</pre>";
}

// Simple DB connection to demonstrate that the service is functional
$mysqli = new mysqli($_ENV['DB_HOST'], $_ENV['DB_USER'], $_ENV['DB_PASSWORD'], $_ENV['DB_NAME']);
if ($mysqli->connect_error) {
    die('Connection Error (' . $mysqli->connect_errno . ') ' . $mysqli->connect_error);
}

$result = $mysqli->query('SELECT id, name FROM users');
if ($result) {
    echo "<h2>User List</h2><ul>";
    while ($row = $result->fetch_assoc()) {
        echo "<li>ID: {$row['id']} - Name: {$row['name']}</li>";
    }
    echo "</ul>";
}
?>