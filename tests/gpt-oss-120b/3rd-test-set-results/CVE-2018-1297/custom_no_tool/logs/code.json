{
    "files": [
        {
            "location": "./../../dockers/CVE-2018-1297/custom_no_tool/docker-compose.yml",
            "content": "services:\n  app:\n    build: ./app\n    ports:\n      - \"8080:8080\"\n    depends_on:\n      db:\n        condition: service_healthy\n    environment:\n      DB_HOST: db\n      DB_PORT: \"3306\"\n      DB_USER: testuser\n      DB_PASSWORD: testpass\n      DB_NAME: testdb\n  db:\n    image: mysql:5.7\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpass\n      MYSQL_DATABASE: testdb\n      MYSQL_USER: testuser\n      MYSQL_PASSWORD: testpass\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql\n    healthcheck:\n      test: [\"CMD\", \"sh\", \"-c\", \"mysqladmin ping -h localhost -u root -p\\\"$MYSQL_ROOT_PASSWORD\\\"\"]\n      interval: 5s\n      timeout: 2s\n      retries: 10\n  jmeter:\n    image: apache/jmeter:4.0\n    command: [\"jmeter-server\"]\n    ports:\n      - \"1099:1099\"\n    healthcheck:\n      test: [\"CMD\", \"sh\", \"-c\", \"echo > /dev/tcp/localhost/1099 || exit 1\"]\n      interval: 5s\n      timeout: 2s\n      retries: 10"
        },
        {
            "location": "./../../dockers/CVE-2018-1297/custom_no_tool/app/Dockerfile",
            "content": "FROM node:18-slim\nWORKDIR /usr/src/app\nCOPY package*.json ./\nRUN npm install\nCOPY . .\nCOPY wait-for-it.sh /usr/src/app/wait-for-it.sh\nCOPY entrypoint.sh /usr/src/app/entrypoint.sh\nRUN apt-get update && apt-get install -y bash netcat-openbsd && rm -rf /var/lib/apt/lists/* && chmod +x /usr/src/app/wait-for-it.sh /usr/src/app/entrypoint.sh\nEXPOSE 8080\nENTRYPOINT [\"/usr/src/app/entrypoint.sh\"]\nCMD [\"node\", \"index.js\"]"
        },
        {
            "location": "./../../dockers/CVE-2018-1297/custom_no_tool/app/package.json",
            "content": "{\n  \"name\": \"vuln-app\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Application vulnerable to CVE-2018-1297 for testing\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"node index.js\"\n  },\n  \"dependencies\": {\n    \"express\": \"4.16.0\",\n    \"mysql\": \"2.18.1\",\n    \"lodash\": \"4.17.10\"\n  }\n}"
        },
        {
            "location": "./../../dockers/CVE-2018-1297/custom_no_tool/app/index.js",
            "content": "const express = require('express');\nconst mysql = require('mysql');\nconst _ = require('lodash');\n\nconst app = express();\nconst port = 8080;\n\n// Create DB connection using env vars\nconst db = mysql.createConnection({\n  host: process.env.DB_HOST || 'db',\n  user: process.env.DB_USER || 'testuser',\n  password: process.env.DB_PASSWORD || 'testpass',\n  database: process.env.DB_NAME || 'testdb'\n});\n\ndb.connect(err => {\n  if (err) {\n    console.error('Database connection failed:', err);\n    return;\n  }\n  console.log('Connected to database');\n});\n\n// A route that uses a vulnerable lodash function (prototype pollution) to demonstrate exploitation\napp.get('/vuln', (req, res) => {\n  const userInput = req.query.input || {};\n  // The following line is intentionally vulnerable: _.assign merges user-controlled input into a system object\n  const merged = _.assign({ safe: true }, userInput);\n  res.json({ merged });\n});\n\napp.get('/', (req, res) => {\n  db.query('SELECT * FROM users LIMIT 5', (err, results) => {\n    if (err) {\n      return res.status(500).send('DB error');\n    }\n    res.json({ users: results });\n  });\n});\n\napp.listen(port, () => {\n  console.log(`Vulnerable app listening on port ${port}`);\n});"
        },
        {
            "location": "./../../dockers/CVE-2018-1297/custom_no_tool/app/wait-for-it.sh",
            "content": "#!/usr/bin/env bash\n#   Use this script to test if a given TCP host/port are available\n#   Adapted from the original wait-for-it script\nset -e\n\nHOST=\nPORT=\nTIMEOUT=15\nSTRICT=0\nQUIET=0\n\nusage(){\n  cat << USAGE\nUsage: $0 host:port [-t timeout] [-- command args]\n -t TIMEOUT  Timeout in seconds, zero for no timeout\n --strict    Only execute subcommand if the test succeeds\n --quiet     Don't output any status messages\nUSAGE\n}\n\nwhile [[ \"$#\" -gt 0 ]]; do\n  case $1 in\n    *:* )\n      HOSTPORT=(${1//:/ })\n      HOST=${HOSTPORT[0]}\n      PORT=${HOSTPORT[1]}\n      shift\n      ;;\n    -t)\n      TIMEOUT=$2\n      shift 2\n      ;;\n    --strict)\n      STRICT=1\n      shift\n      ;;\n    --quiet)\n      QUIET=1\n      shift\n      ;;\n    --)\n      shift\n      CMD=($(printf \"%s \" \"$@\"))\n      break\n      ;;\n    *)\n      usage\n      exit 1\n      ;;\n  esac\ndone\n\nif [[ -z \"$HOST\" || -z \"$PORT\" ]]; then\n  echo \"Error: host and port must be specified\"\n  usage\n  exit 1\nfi\n\nwait_until_ready(){\n  if [[ $TIMEOUT -gt 0 ]]; then\n    end=$(($(date +%s) + TIMEOUT))\n  fi\n  while :; do\n    if nc -z \"$HOST\" \"$PORT\"; then\n      return 0\n    fi\n    if [[ $TIMEOUT -gt 0 && $(date +%s) -ge $end ]]; then\n      return 1\n    fi\n    sleep 0.5\n  done\n}\n\nif wait_until_ready; then\n  [[ $QUIET -eq 0 ]] && echo \"$HOST:$PORT is available\"\nelse\n  echo \"Timeout occurred after waiting $TIMEOUT seconds for $HOST:$PORT\"\n  [[ $STRICT -eq 1 ]] && exit 1\nfi\n\nif [[ ${#CMD[@]} -gt 0 ]]; then\n  exec \"${CMD[@]}\"\nfi"
        },
        {
            "location": "./../../dockers/CVE-2018-1297/custom_no_tool/app/entrypoint.sh",
            "content": "#!/bin/sh\nset -e\n# Wait for the MySQL service to be ready using the absolute path to the script\n/usr/src/app/wait-for-it.sh db:3306 -t 30 --strict -- echo \"Database is up\"\n# Start the Node application\nexec \"$@\""
        },
        {
            "location": "./../../dockers/CVE-2018-1297/custom_no_tool/db/init.sql",
            "content": "CREATE TABLE IF NOT EXISTS users (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  username VARCHAR(50) NOT NULL,\n  email VARCHAR(100) NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nINSERT INTO users (username, email) VALUES\n('alice', 'alice@example.com'),\n('bob', 'bob@example.com'),\n('carol', 'carol@example.com');\n"
        }
    ],
    "directory_tree": "CVE-2018-1297/custom_no_tool"
}