{
    "files": [
        {
            "location": "./../../dockers/CVE-2020-17526/custom_no_tool/docker-compose.yml",
            "content": "version: \"2.4\"\nservices:\n  vulnerable:\n    build:\n      context: ./.\n      dockerfile: Dockerfile.vuln\n    ports:\n      - \"8080:8080\"\n    environment:\n      - AIRFLOW__CORE__SQL_ALCHEMY_CONN=postgresql+psycopg2://testuser:testpass@db:5432/testdb\n      - AIRFLOW__CORE__EXECUTOR=SequentialExecutor\n    depends_on:\n      db:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n  attacker:\n    build:\n      context: ./.\n      dockerfile: Dockerfile.attacker\n    privileged: true\n    volumes:\n      - /:/host:rw\n    command: [\"/exploit.sh\"]\n    depends_on:\n      - vulnerable\n  db:\n    image: postgres:13-alpine\n    environment:\n      POSTGRES_USER: testuser\n      POSTGRES_PASSWORD: testpass\n      POSTGRES_DB: testdb\n    ports:\n      - \"5432:5432\"\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U testuser\"]\n      interval: 5s\n      timeout: 5s\n      retries: 5\n    volumes:\n      - ./init.sql:/docker-entrypoint-initdb.d/init.sql\n  redis:\n    image: redis:6-alpine\n    ports:\n      - \"6379:6379\"\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"ping\"]\n      interval: 5s\n      timeout: 5s\n      retries: 5"
        },
        {
            "location": "./../../dockers/CVE-2020-17526/custom_no_tool/Dockerfile.vuln",
            "content": "FROM apache/airflow:1.10.14-python3.8\n\nENV AIRFLOW_HOME=/opt/airflow\nENV PATH=$PATH:/usr/local/bin\n\n# Install dependencies needed for the wait\u2011for\u2011db loop and psycopg2\nUSER root\nRUN apt-get update && \\\n    apt-get install -y --no-install-recommends postgresql-client && \\\n    rm -rf /var/lib/apt/lists/* && \\\n    pip install --no-cache-dir psycopg2-binary\n\nCOPY airflow.cfg ${AIRFLOW_HOME}/airflow.cfg\nCOPY entrypoint.sh /entrypoint.sh\nRUN chmod +x /entrypoint.sh && chown -R airflow:airflow ${AIRFLOW_HOME} /entrypoint.sh\n\nUSER root\nEXPOSE 8080\nENTRYPOINT [\"/entrypoint.sh\"]"
        },
        {
            "location": "./../../dockers/CVE-2020-17526/custom_no_tool/entrypoint.sh",
            "content": "#!/usr/bin/env bash\nset -e\n\n# Wait for PostgreSQL to be ready using pg_isready (installed via postgresql-client)\necho \"Waiting for PostgreSQL to become reachable...\"\nwhile ! pg_isready -d \"$AIRFLOW__CORE__SQL_ALCHEMY_CONN\" -U \"$(echo $AIRFLOW__CORE__SQL_ALCHEMY_CONN | cut -d'/' -f3 | cut -d':' -f1)\" >/dev/null 2>&1; do\n  sleep 2\ndone\n\necho \"PostgreSQL is ready. Initializing Airflow metadata database...\"\n# Airflow 1.10.x uses 'airflow initdb'\nairflow initdb || true\n\necho \"Starting Airflow webserver...\"\n# Run the webserver as the airflow user\nexec gosu airflow airflow webserver"
        },
        {
            "location": "./../../dockers/CVE-2020-17526/custom_no_tool/Dockerfile.attacker",
            "content": "FROM alpine:3.12\nCOPY exploit.sh /exploit.sh\nRUN chmod +x /exploit.sh"
        },
        {
            "location": "./../../dockers/CVE-2020-17526/custom_no_tool/exploit.sh",
            "content": "#!/bin/sh\n# Demonstration of host file write via privileged container with host FS mount\n\necho \"pwned by CVE-2020-17526\" > /host/tmp/host_root.txt"
        },
        {
            "location": "./../../dockers/CVE-2020-17526/custom_no_tool/init.sql",
            "content": "-- Sample test data for the vulnerable Airflow environment\nCREATE TABLE example (\n    id SERIAL PRIMARY KEY,\n    name TEXT NOT NULL\n);\nINSERT INTO example (name) VALUES ('test1'), ('test2');"
        },
        {
            "location": "./../../dockers/CVE-2020-17526/custom_no_tool/airflow.cfg",
            "content": "[webserver]\nsecret_key = temporary_key\nweb_server_port = 8080\n[core]\nload_examples = False\nexecutor = SequentialExecutor\nsql_alchemy_conn = postgresql+psycopg2://testuser:testpass@db:5432/testdb"
        },
        {
            "location": "./../../dockers/CVE-2020-17526/custom_no_tool/index.html",
            "content": "<!DOCTYPE html>\n<html>\n<head><title>Vulnerable Service</title></head>\n<body><h1>Welcome to the vulnerable web service</h1></body>\n</html>"
        }
    ],
    "directory_tree": "CVE-2020-17526/custom_no_tool/\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 Dockerfile.vuln\n\u251c\u2500\u2500 Dockerfile.attacker\n\u251c\u2500\u2500 entrypoint.sh\n\u251c\u2500\u2500 exploit.sh\n\u251c\u2500\u2500 init.sql\n\u251c\u2500\u2500 airflow.cfg\n\u2514\u2500\u2500 index.html"
}