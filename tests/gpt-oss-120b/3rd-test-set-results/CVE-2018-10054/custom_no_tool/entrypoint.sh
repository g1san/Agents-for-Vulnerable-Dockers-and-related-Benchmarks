#!/bin/sh
# Start H2 server in background with web console accessible remotely
java -cp /h2-${H2_VERSION}.jar org.h2.tools.Server \
     -web -webAllowOthers -webPort 8082 \
     -tcp -tcpAllowOthers -tcpPort 9092 \
     -baseDir /data \
     &
SERVER_PID=$!
# Wait for the server to be ready
while ! java -cp /h2-${H2_VERSION}.jar org.h2.tools.Shell \
        -url jdbc:h2:tcp://localhost:9092/./test \
        -user sa -password '' -cmd "SELECT 1" >/dev/null 2>&1; do
  echo "Waiting for H2 server to become ready..."
  sleep 1
done
# Run initialization script
java -cp /h2-${H2_VERSION}.jar org.h2.tools.RunScript \
     -url jdbc:h2:tcp://localhost:9092/./test \
     -user sa -password '' -script /scripts/init.sql
# Keep the container alive as long as the server runs
wait $SERVER_PID