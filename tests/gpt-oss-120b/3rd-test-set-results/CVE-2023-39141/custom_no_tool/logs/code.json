{
    "files": [
        {
            "location": "./../../dockers/CVE-2023-39141/custom_no_tool/Dockerfile",
            "content": "FROM ziahamza/webui-aria2:1.1.0\n\n# Set working directory\nWORKDIR /app\n\n# Copy Node.js manifest and install dependencies\nCOPY package.json ./\nRUN npm install --only=production\n\n# Copy application source files\nCOPY server.js ./\nCOPY public ./public\n\n# Expose the default application port\nEXPOSE 3000\n\n# Start the server\nCMD [\"node\", \"server.js\"]"
        },
        {
            "location": "./../../dockers/CVE-2023-39141/custom_no_tool/docker-compose.yml",
            "content": "services:\n  web:\n    build: .\n    ports:\n      - \"3000:3000\""
        },
        {
            "location": "./../../dockers/CVE-2023-39141/custom_no_tool/package.json",
            "content": "{\n  \"name\": \"webui-aria2\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Demo app for CVE-2023-39141\",\n  \"main\": \"server.js\",\n  \"scripts\": {\n    \"start\": \"node server.js\"\n  },\n  \"dependencies\": {\n    \"express\": \"^4.18.2\"\n  }\n}"
        },
        {
            "location": "./../../dockers/CVE-2023-39141/custom_no_tool/server.js",
            "content": "const express = require('express');\nconst path = require('path');\nconst fs = require('fs');\nconst app = express();\nconst PORT = process.env.PORT || 3000;\n\n// Define the directory that will serve static files\nconst STATIC_ROOT = path.join(__dirname, 'public');\n\n// Ensure the static directory exists (create if missing)\nif (!fs.existsSync(STATIC_ROOT)) {\n  fs.mkdirSync(STATIC_ROOT, { recursive: true });\n}\n\n// Helper to check if a resolved path stays inside STATIC_ROOT\nfunction isPathInside(parent, child) {\n  const relative = path.relative(parent, child);\n  return !relative.startsWith('..') && !path.isAbsolute(relative);\n}\n\n// Safe file serving route \u2013 replaces the vulnerable implementation\napp.get('/*', (req, res) => {\n  // Decode URL components and prevent null bytes\n  const safePath = decodeURIComponent(req.path);\n\n  // Resolve the absolute path of the requested file within STATIC_ROOT\n  const absolutePath = path.resolve(STATIC_ROOT, '.' + safePath);\n\n  // Verify that the resolved path is still inside STATIC_ROOT\n  if (!isPathInside(STATIC_ROOT, absolutePath)) {\n    return res.status(403).send('Forbidden: directory traversal attempt detected');\n  }\n\n  // Check if the file exists and is a regular file\n  fs.stat(absolutePath, (err, stats) => {\n    if (err || !stats.isFile()) {\n      return res.status(404).send('File not found');\n    }\n    res.sendFile(absolutePath);\n  });\n});\n\napp.listen(PORT, () => {\n  console.log(`Server listening on port ${PORT}`);\n});"
        },
        {
            "location": "./../../dockers/CVE-2023-39141/custom_no_tool/public/index.html",
            "content": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>WebUI Aria2 Demo</title>\n</head>\n<body>\n  <h1>WebUI Aria2 \u2013 Patched Demo</h1>\n  <p>This is a placeholder static page served by the patched server.</p>\n</body>\n</html>"
        },
        {
            "location": "./../../dockers/CVE-2023-39141/custom_no_tool/db/init.sql",
            "content": "CREATE TABLE test (\n    id SERIAL PRIMARY KEY,\n    data TEXT\n);\n\nINSERT INTO test (data) VALUES ('sample data');"
        }
    ],
    "directory_tree": "./../../dockers/CVE-2023-39141/custom_no_tool"
}