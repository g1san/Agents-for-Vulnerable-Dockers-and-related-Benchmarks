{
    "files": [
        {
            "location": "./../../dockers/CVE-2018-19475/custom_no_tool/docker-compose.yml",
            "content": "services:\n  web:\n    build: ./web\n    ports:\n      - \"3000:3000\"\n    environment:\n      NODE_ENV: production\n    user: appuser\n    cap_drop:\n      - ALL"
        },
        {
            "location": "./../../dockers/CVE-2018-19475/custom_no_tool/web/Dockerfile",
            "content": "FROM node:18-bullseye\n\n# Create a non\u2011root user\nRUN groupadd -r appgroup && useradd -r -g appgroup appuser\n\nWORKDIR /usr/src/app\n\n# Install Ghostscript (vulnerable version 9.25 is not available in bullseye, install the latest available version)\nRUN apt-get update \\\n    && apt-get install -y --no-install-recommends \\\n        ghostscript \\\n        libgs9-common \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Install Node.js dependencies (production only)\nCOPY package.json .\nRUN npm install --only=production\n\n# Add application source and adjust ownership\nCOPY . .\nRUN chown -R appuser:appgroup /usr/src/app\n\nEXPOSE 3000\nUSER appuser\nCMD [\"node\",\"app.js\"]"
        },
        {
            "location": "./../../dockers/CVE-2018-19475/custom_no_tool/web/app.js",
            "content": "const express = require('express');\nconst { spawn } = require('child_process');\nconst app = express();\n\n// Whitelisted commands \u2013 hard\u2011coded map, never derived from user input\nconst allowedCommands = {\n  ls: { cmd: 'ls', args: ['-la'] },\n  pwd: { cmd: 'pwd', args: [] }\n};\n\nfunction runCommand(commandObj) {\n  return new Promise((resolve, reject) => {\n    const child = spawn(commandObj.cmd, commandObj.args, { stdio: ['ignore', 'pipe', 'pipe'] });\n    let stdout = '';\n    let stderr = '';\n    child.stdout.on('data', (data) => { stdout += data; });\n    child.stderr.on('data', (data) => { stderr += data; });\n    child.on('error', (err) => reject(err));\n    child.on('close', (code) => {\n      if (code === 0) {\n        resolve(stdout);\n      } else {\n        reject(new Error(stderr));\n      }\n    });\n  });\n}\n\napp.get('/run', async (req, res) => {\n  const name = req.query.cmd;\n  const entry = allowedCommands[name];\n  if (!entry) {\n    return res.status(400).send('Invalid or unsupported command');\n  }\n  try {\n    const output = await runCommand(entry);\n    res.send(`Output: ${output}`);\n  } catch (err) {\n    res.status(500).send(`Error: ${err.message}`);\n  }\n});\n\napp.listen(3000, '0.0.0.0', () => console.log('App listening on port 3000'));"
        },
        {
            "location": "./../../dockers/CVE-2018-19475/custom_no_tool/web/package.json",
            "content": "{\n  \"name\": \"webapp\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Demo app\",\n  \"main\": \"app.js\",\n  \"scripts\": {\n    \"start\": \"node app.js\"\n  },\n  \"dependencies\": {\n    \"express\": \"^4.18.2\"\n  }\n}"
        }
    ],
    "directory_tree": "CVE-2018-19475/custom_no_tool"
}