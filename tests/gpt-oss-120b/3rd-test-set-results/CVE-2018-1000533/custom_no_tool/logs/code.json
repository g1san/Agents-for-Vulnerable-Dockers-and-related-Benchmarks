{
    "files": [
        {
            "location": "./../../dockers/CVE-2018-1000533/custom_no_tool/docker-compose.yml",
            "content": "version: '3.8'\n\nservices:\n  web:\n    build:\n      context: ./web\n    ports:\n      - \"5000:5000\"\n    depends_on:\n      db:\n        condition: service_healthy\n    environment:\n      - DB_HOST=db\n      - DB_USER=root\n      - DB_PASSWORD=example\n      - DB_NAME=vuln_db\n    restart: unless-stopped\n\n  db:\n    image: mysql:5.7\n    restart: unless-stopped\n    environment:\n      MYSQL_ROOT_PASSWORD: example\n      MYSQL_ROOT_HOST: \"%\"\n      MYSQL_DATABASE: vuln_db\n    volumes:\n      - db_data:/var/lib/mysql\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql\n    ports:\n      - \"3306:3306\"\n    healthcheck:\n      test: [\"CMD\", \"mysqladmin\", \"ping\", \"-h\", \"localhost\"]\n      interval: 5s\n      timeout: 2s\n      retries: 10\n\nvolumes:\n  db_data:"
        },
        {
            "location": "./../../dockers/CVE-2018-1000533/custom_no_tool/web/Dockerfile",
            "content": "FROM python:3.9\nWORKDIR /app\nENV DEBIAN_FRONTEND=noninteractive\nRUN apt-get update && \\\n    apt-get install -y --no-install-recommends default-mysql-client gcc default-libmysqlclient-dev && \\\n    rm -rf /var/lib/apt/lists/*\nCOPY requirements.txt ./\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY entrypoint.sh ./\nCOPY . .\nRUN chmod +x entrypoint.sh\nEXPOSE 5000\nENTRYPOINT [\"./entrypoint.sh\"]"
        },
        {
            "location": "./../../dockers/CVE-2018-1000533/custom_no_tool/web/requirements.txt",
            "content": "Flask==1.1.4\nmysql-connector-python==8.0.28\nWerkzeug==1.0.1\nJinja2>=2.10,<3.0\nMarkupSafe==2.0.1"
        },
        {
            "location": "./../../dockers/CVE-2018-1000533/custom_no_tool/web/entrypoint.sh",
            "content": "#!/bin/sh\nexec python app.py"
        },
        {
            "location": "./../../dockers/CVE-2018-1000533/custom_no_tool/web/app.py",
            "content": "import os\nimport time\nfrom flask import Flask, request, jsonify\nimport mysql.connector\n\napp = Flask(__name__)\n\n# Base directory for safe file reads\nSAFE_BASE_DIR = os.path.abspath(os.path.join(os.getcwd(), 'safe_files'))\n\ndef get_db_connection(retries=5, delay=2):\n    for attempt in range(retries):\n        try:\n            conn = mysql.connector.connect(\n                host=os.getenv('DB_HOST', 'db'),\n                user=os.getenv('DB_USER', 'root'),\n                password=os.getenv('DB_PASSWORD', 'example'),\n                database=os.getenv('DB_NAME', 'vuln_db')\n            )\n            return conn\n        except mysql.connector.Error as e:\n            if attempt < retries - 1:\n                time.sleep(delay)\n            else:\n                raise e\n\n@app.route('/read', methods=['GET'])\ndef read_file():\n    filename = request.args.get('file')\n    if not filename:\n        return jsonify({'error': 'file parameter required'}), 400\n    # Resolve path and ensure it stays within SAFE_BASE_DIR\n    requested_path = os.path.abspath(os.path.join(SAFE_BASE_DIR, filename))\n    if not requested_path.startswith(SAFE_BASE_DIR):\n        return jsonify({'error': 'Access to the requested path is denied'}), 403\n    try:\n        with open(requested_path, 'r') as f:\n            data = f.read()\n        return jsonify({'content': data})\n    except FileNotFoundError:\n        return jsonify({'error': 'File not found'}), 404\n    except Exception as e:\n        return jsonify({'error': 'Unable to read file'}), 500\n\n@app.route('/users', methods=['GET'])\ndef list_users():\n    try:\n        conn = get_db_connection()\n        cursor = conn.cursor(dictionary=True)\n        cursor.execute(\"SELECT id, username FROM users\")\n        rows = cursor.fetchall()\n        cursor.close()\n        conn.close()\n        return jsonify(rows)\n    except Exception as e:\n        return jsonify({'error': 'Database query failed'}), 500\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000)"
        },
        {
            "location": "./../../dockers/CVE-2018-1000533/custom_no_tool/web/safe_files/.gitkeep",
            "content": ""
        },
        {
            "location": "./../../dockers/CVE-2018-1000533/custom_no_tool/db/init.sql",
            "content": "CREATE TABLE IF NOT EXISTS users (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    username VARCHAR(50) NOT NULL,\n    password VARCHAR(255) NOT NULL\n);\n\nINSERT INTO users (username, password) VALUES\n('alice', 'alicepass'),\n('bob', 'bobpass'),\n('charlie', 'charliepass');"
        }
    ],
    "directory_tree": "custom_no_tool/\n\u251c\u2500 docker-compose.yml\n\u251c\u2500 web/\n\u2502  \u251c\u2500 Dockerfile\n\u2502  \u251c\u2500 requirements.txt\n\u2502  \u251c\u2500 entrypoint.sh\n\u2502  \u251c\u2500 app.py\n\u2502  \u2514\u2500 safe_files/\n\u2502     \u2514\u2500 .gitkeep\n\u2514\u2500 db/\n   \u2514\u2500 init.sql"
}