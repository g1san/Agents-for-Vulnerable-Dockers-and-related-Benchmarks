{
    "files": [
        {
            "location": "./../../dockers/CVE-2015-3337/custom_no_tool/docker-compose.yml",
            "content": "services:\n  web:\n    build: ./app\n    ports:\n      - \"8080:5000\"\n    depends_on:\n      - db\n      - elasticsearch\n    environment:\n      DB_HOST: db\n      DB_USER: test\n      DB_PASSWORD: test\n      DB_NAME: testdb\n  db:\n    image: mysql:5.5\n    restart: always\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpass\n      MYSQL_DATABASE: testdb\n      MYSQL_USER: test\n      MYSQL_PASSWORD: test\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - db_data:/var/lib/mysql\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql:ro\n    healthcheck:\n      test: [\"CMD\", \"mysqladmin\", \"ping\", \"-h\", \"localhost\", \"-uroot\", \"-prootpass\"]\n      interval: 5s\n      timeout: 2s\n      retries: 10\n  elasticsearch:\n    image: elasticsearch:1.4.4\n    environment:\n      - discovery.type=single-node\n    ports:\n      - \"9200:9200\"\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9200\"]\n      interval: 5s\n      timeout: 3s\n      retries: 10\nvolumes:\n  db_data:"
        },
        {
            "location": "./../../dockers/CVE-2015-3337/custom_no_tool/app/Dockerfile",
            "content": "FROM python:3.9-alpine\nWORKDIR /app\nCOPY requirements.txt .\n# Install all required build\u2011time dependencies, install Python packages, then remove the build tools\nRUN apk add --no-cache \\\n        build-base \\\n        musl-dev \\\n        libffi-dev \\\n        openssl-dev \\\n        python3-dev && \\\n    pip install --no-cache-dir -r requirements.txt && \\\n    apk del --purge build-base musl-dev libffi-dev openssl-dev python3-dev\nCOPY . .\nRUN mkdir -p /app/files\nCMD [\"python\", \"app.py\"]"
        },
        {
            "location": "./../../dockers/CVE-2015-3337/custom_no_tool/app/requirements.txt",
            "content": "Flask==2.0.3\nJinja2==3.0.3\nmarkupsafe==2.0.1\nPyMySQL==1.0.2"
        },
        {
            "location": "./../../dockers/CVE-2015-3337/custom_no_tool/app/app.py",
            "content": "import os\nimport time\nfrom flask import Flask, request, abort\nimport pymysql\n\napp = Flask(__name__)\n\nDB_HOST = os.getenv('DB_HOST', 'db')\nDB_USER = os.getenv('DB_USER', 'test')\nDB_PASSWORD = os.getenv('DB_PASSWORD', 'test')\nDB_NAME = os.getenv('DB_NAME', 'testdb')\n\ndef get_db(max_retries=5, delay=2):\n    attempt = 0\n    while attempt < max_retries:\n        try:\n            conn = pymysql.connect(host=DB_HOST, user=DB_USER, password=DB_PASSWORD, database=DB_NAME)\n            return conn\n        except pymysql.err.OperationalError:\n            attempt += 1\n            time.sleep(delay)\n    return pymysql.connect(host=DB_HOST, user=DB_USER, password=DB_PASSWORD, database=DB_NAME)\n\nBASE_DIR = os.path.abspath(os.path.join(os.getcwd(), 'files'))\nos.makedirs(BASE_DIR, exist_ok=True)\n\n@app.route('/')\ndef index():\n    return \"Vulnerable app for CVE-2015-3337\"\n\n@app.route('/read')\ndef read_file():\n    filename = request.args.get('file')\n    if not filename:\n        abort(400)\n    requested_path = os.path.abspath(os.path.join(BASE_DIR, filename))\n    if not requested_path.startswith(BASE_DIR + os.sep):\n        abort(403)\n    try:\n        with open(requested_path, 'r') as f:\n            return f.read()\n    except Exception as e:\n        return str(e), 500\n\nif __name__ == '__main__':\n    get_db()\n    app.run(host='0.0.0.0', port=5000)"
        },
        {
            "location": "./../../dockers/CVE-2015-3337/custom_no_tool/db/init.sql",
            "content": "CREATE TABLE users (id INT AUTO_INCREMENT PRIMARY KEY, username VARCHAR(50), password VARCHAR(50));\nINSERT INTO users (username, password) VALUES ('admin','admin123');"
        }
    ],
    "directory_tree": "./../../dockers/CVE-2015-3337/custom_no_tool"
}