{
    "files": [
        {
            "location": "./../../dockers/CVE-2021-28169/custom_no_tool/docker-compose.yml",
            "content": "version: \"3.8\"\nservices:\n  redis:\n    image: redis:5.0.9\n    container_name: vulnerable_redis\n    ports:\n      - \"6379:6379\"\n    command: [\"redis-server\", \"/usr/local/etc/redis/redis.conf\", \"--protected-mode\", \"no\"]\n    volumes:\n      - ./redis/redis.conf:/usr/local/etc/redis/redis.conf\n  app:\n    build:\n      context: ./app\n      dockerfile: Dockerfile\n    container_name: vulnerable_app\n    depends_on:\n      - redis\n      - jetty\n    ports:\n      - \"5000:5000\"\n    environment:\n      - REDIS_HOST=redis\n      - REDIS_PORT=6379\n  jetty:\n    image: jetty:9.4.40-jdk11\n    container_name: vulnerable_jetty\n    ports:\n      - \"8080:8080\"\n    # No additional configuration; the image tag encodes the vulnerable version\n"
        },
        {
            "location": "./../../dockers/CVE-2021-28169/custom_no_tool/app/Dockerfile",
            "content": "FROM python:3.9-slim\nWORKDIR /usr/src/app\nCOPY requirements.txt ./\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY app.py ./\nEXPOSE 5000\nCMD [\"python\", \"app.py\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2021-28169/custom_no_tool/app/requirements.txt",
            "content": "flask\nredis\n"
        },
        {
            "location": "./../../dockers/CVE-2021-28169/custom_no_tool/app/app.py",
            "content": "from flask import Flask, request, jsonify\nimport redis\nimport os\n\napp = Flask(__name__)\n\nredis_host = os.getenv('REDIS_HOST', 'localhost')\nredis_port = int(os.getenv('REDIS_PORT', 6379))\nclient = redis.StrictRedis(host=redis_host, port=redis_port, decode_responses=True)\n\n@app.route('/')\ndef index():\n    return 'Vulnerable Flask app connected to Redis.'\n\n# Simple endpoint that writes user input directly into Redis (demonstrates unsafe usage)\n@app.route('/set', methods=['POST'])\ndef set_value():\n    key = request.form.get('key')\n    value = request.form.get('value')\n    if not key or not value:\n        return jsonify({'error': 'key and value required'}), 400\n    client.set(key, value)\n    return jsonify({'status': 'ok'}), 200\n\n# Endpoint that allows execution of arbitrary Redis commands (illustrates CVE exploit)\n@app.route('/cmd', methods=['POST'])\ndef exec_cmd():\n    cmd = request.form.get('cmd')\n    if not cmd:\n        return jsonify({'error': 'cmd required'}), 400\n    # WARNING: This is intentionally insecure for testing CVE-2021-28169\n    result = client.execute_command(*cmd.split())\n    return jsonify({'result': result}), 200\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000)\n"
        },
        {
            "location": "./../../dockers/CVE-2021-28169/custom_no_tool/redis/redis.conf",
            "content": "# Minimal Redis configuration for testing CVE-2021-28169\nbind 0.0.0.0\nprotected-mode no\nport 6379\nlogfile \"\"\n"
        }
    ],
    "directory_tree": "./../../dockers/CVE-2021-28169/custom_no_tool"
}