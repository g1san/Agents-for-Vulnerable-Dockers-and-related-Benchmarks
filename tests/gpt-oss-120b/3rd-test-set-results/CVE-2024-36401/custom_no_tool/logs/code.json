{
    "files": [
        {
            "location": "./../../dockers/CVE-2024-36401/custom_no_tool/docker-compose.yml",
            "content": "services:\n  web:\n    build: ./app\n    ports:\n      - \"5000:5000\"\n    environment:\n      - FLASK_APP=app.py\n      - DB_HOST=db\n    depends_on:\n      - db\n      - geoserver\n  db:\n    image: mysql:5.7\n    restart: always\n    environment:\n      MYSQL_ROOT_PASSWORD: example\n      MYSQL_DATABASE: testdb\n      MYSQL_USER: user\n      MYSQL_PASSWORD: password\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - db_data:/var/lib/mysql\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql\n  geoserver:\n    build: ./geoserver\n    ports:\n      - \"8080:8080\"\n    environment:\n      - GEOSERVER_DATA_DIR=/opt/geoserver/data_dir\n    depends_on:\n      - db\nvolumes:\n  db_data:\n"
        },
        {
            "location": "./../../dockers/CVE-2024-36401/custom_no_tool/app/Dockerfile",
            "content": "FROM python:3.8-slim\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY . .\nCMD [\"python\", \"app.py\"]"
        },
        {
            "location": "./../../dockers/CVE-2024-36401/custom_no_tool/app/requirements.txt",
            "content": "Flask==2.3.2\nmysql-connector-python==8.0.33"
        },
        {
            "location": "./../../dockers/CVE-2024-36401/custom_no_tool/app/app.py",
            "content": "from flask import Flask, request, jsonify\nimport mysql.connector\nimport os\nimport ast\n\napp = Flask(__name__)\n\n# Safe endpoint \u2013 evaluates literal Python expressions only\n@app.route('/vuln')\ndef safe_eval():\n    expr = request.args.get('expr', '')\n    try:\n        # Use ast.literal_eval to avoid code execution\n        result = ast.literal_eval(expr)\n        return jsonify({'result': result})\n    except Exception as e:\n        return jsonify({'error': str(e)}), 400\n\n# Simple DB test endpoint\n@app.route('/users')\ndef list_users():\n    conn = mysql.connector.connect(\n        host=os.getenv('DB_HOST', 'db'),\n        user='user',\n        password='password',\n        database='testdb'\n    )\n    cursor = conn.cursor()\n    cursor.execute('SELECT id, name FROM users')\n    rows = cursor.fetchall()\n    cursor.close()\n    conn.close()\n    return jsonify({'users': [{'id': r[0], 'name': r[1]} for r in rows]})\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000)\n"
        },
        {
            "location": "./../../dockers/CVE-2024-36401/custom_no_tool/db/init.sql",
            "content": "CREATE DATABASE IF NOT EXISTS testdb;\nUSE testdb;\nCREATE TABLE IF NOT EXISTS users (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(50) NOT NULL\n);\nINSERT INTO users (name) VALUES ('alice'), ('bob'), ('charlie');\n"
        },
        {
            "location": "./../../dockers/CVE-2024-36401/custom_no_tool/geoserver/Dockerfile",
            "content": "FROM tomcat:10.1.30-jdk11\nENV GEOSERVER_VERSION=2.25.2 \\\n    GEOSERVER_DATA_DIR=/opt/geoserver/data_dir \\\n    CATALINA_HOME=/usr/local/tomcat\n\nRUN apt-get update && apt-get install -y wget unzip && \\\n    mkdir -p $GEOSERVER_DATA_DIR $CATALINA_HOME/webapps && \\\n    wget -O /tmp/geoserver.zip https://downloads.geoserver.org/${GEOSERVER_VERSION}/geoserver-${GEOSERVER_VERSION}-war.zip && \\\n    unzip -j /tmp/geoserver.zip geoserver.war -d $CATALINA_HOME/webapps && \\\n    rm -f /tmp/geoserver.zip && \\\n    apt-get clean && rm -rf /var/lib/apt/lists/*\nEXPOSE 8080\n"
        }
    ],
    "directory_tree": "CVE-2024-36401/custom_no_tool"
}