FROM maven:3.9-eclipse-temurin-8 AS build
WORKDIR /app

# Copy the entire project (pom and source files)
COPY . /app

# Adjust project structure for Maven standard layout
RUN mkdir -p src/main && mv webapp src/main/webapp

# Build the WAR (skip tests for speed)
RUN mvn -B package -DskipTests

# ---------- Final image ----------
FROM tomcat:8.5-jre8
# Clean default webapps
RUN rm -rf /usr/local/tomcat/webapps/*
# Deploy the built WAR as ROOT
COPY --from=build /app/target/vulnerable-struts-1.0.0.war /usr/local/tomcat/webapps/ROOT.war
EXPOSE 8080