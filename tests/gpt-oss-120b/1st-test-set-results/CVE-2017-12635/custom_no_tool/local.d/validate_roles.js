// Dummy validation function that mimics the vulnerable behaviour.
// CouchDB's validate_doc_update hook is written in JavaScript.
// This version deliberately *does not* reject a document that contains
// duplicate "roles" keys where the first key grants "_admin".
function(doc, oldDoc, userCtx) {
  if (doc.type === "user" && doc.roles && doc.roles.indexOf("_admin") !== -1) {
    // In a real secure validator we would reject this, but the vulnerability
    // allows it to pass when the duplicate key is later overwritten by the
    // JavaScript parser.
    return; // accept
  }
  // Normal validation â€“ accept everything else
}