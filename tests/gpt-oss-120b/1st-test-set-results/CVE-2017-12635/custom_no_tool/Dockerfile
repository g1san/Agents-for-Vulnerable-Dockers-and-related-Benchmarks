FROM couchdb:2.0.99

# Ensure target directory exists before copying files
RUN mkdir -p /opt/couchdb/etc/local.d

# Copy custom validation files and init script
COPY local.d/ /opt/couchdb/etc/local.d/

# Set ownership and permissions
RUN chown -R couchdb:couchdb /opt/couchdb/etc/local.d && \
    find /opt/couchdb/etc/local.d -type f -exec chmod 644 {} + && \
    chmod 755 /opt/couchdb/etc/local.d/init.sh

EXPOSE 5984