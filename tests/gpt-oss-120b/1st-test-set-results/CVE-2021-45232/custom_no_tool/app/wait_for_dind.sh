#!/bin/sh
# wait_for_dind.sh â€“ blocks until the Docker-in-Docker daemon responds to /_ping
set -e
MAX_RETRIES=30
COUNT=0
while true; do
  if curl -s http://dind:2375/_ping | grep -q OK; then
    echo "Dind is healthy"
    break
  fi
  COUNT=$((COUNT+1))
  if [ $COUNT -ge $MAX_RETRIES ]; then
    echo "Dind did not become healthy in time"
    exit 1
  fi
  echo "Waiting for dind..."
  sleep 2
done
exec "$@"
