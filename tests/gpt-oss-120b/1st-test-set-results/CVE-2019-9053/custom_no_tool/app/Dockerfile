FROM node:18
WORKDIR /usr/src/app

# Install required packages: bash, netcat-openbsd, curl and any other utilities
RUN apt-get update && \
    apt-get install -y bash netcat-openbsd curl && \
    rm -rf /var/lib/apt/lists/*

COPY package.json .
RUN npm install

# Copy application source (including any local files)
COPY . .

# Ensure the bundled wait‑for‑it script is executable
RUN chmod +x /usr/src/app/wait-for-it.sh

EXPOSE 3000

# Use bash (which is now installed) and wait for MySQL before starting the Node app
CMD ["bash", "/usr/src/app/wait-for-it.sh", "db:3306", "--", "node", "server.js"]