FROM ubuntu:22.04
ENV DEBIAN_FRONTEND=noninteractive
ENV HADOOP_VERSION=3.3.3
RUN apt-get update && apt-get install -y --no-install-recommends \
    openjdk-17-jdk \
    wget \
    ca-certificates \
    gnupg \
    tar \
    libssl3 \
    libssl-dev && \
    wget https://archive.apache.org/dist/hadoop/common/hadoop-${HADOOP_VERSION}/hadoop-${HADOOP_VERSION}.tar.gz && \
    tar -xzf hadoop-${HADOOP_VERSION}.tar.gz -C /opt && \
    rm hadoop-${HADOOP_VERSION}.tar.gz && \
    ln -s /opt/hadoop-${HADOOP_VERSION} /opt/hadoop && \
    mkdir -p /opt/hadoop/lib/native && \
    ln -s /usr/lib/x86_64-linux-gnu/libcrypto.so.3 /opt/hadoop/lib/native/libcrypto.so && \
    if [ -f /opt/hadoop/sbin/container-executor ]; then \
        chown root:root /opt/hadoop/sbin/container-executor && \
        chmod 4755 /opt/hadoop/sbin/container-executor; \
    fi && \
    apt-get clean && rm -rf /var/lib/apt/lists/*
ENV HADOOP_HOME=/opt/hadoop
ENV PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin
EXPOSE 8088 8042
CMD ["sleep", "infinity"]