<?php
// Secure file reader â€“ prevents path traversal
$baseDir = realpath(__DIR__ . '/files');
if ($baseDir === false) {
    // Ensure the base directory exists
    mkdir(__DIR__ . '/files', 0755, true);
    $baseDir = realpath(__DIR__ . '/files');
}
if (isset($_GET['file'])) {
    $requested = $_GET['file'];
    // Resolve the absolute path safely
    $resolved = realpath($baseDir . '/' . $requested);
    // Verify that the resolved path is inside the allowed base directory
    if ($resolved !== false && strpos($resolved, $baseDir) === 0 && is_file($resolved)) {
        echo '<pre>' . htmlspecialchars(file_get_contents($resolved)) . '</pre>';
    } else {
        http_response_code(400);
        echo 'Invalid file request.';
    }
} else {
    echo '<form method="GET">File: <input name="file" /><input type="submit" /></form>';
}
?>