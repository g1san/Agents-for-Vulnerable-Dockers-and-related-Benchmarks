## ---------- Multiâ€‘stage build ---------- ##
# Stage 1: Build the Java application using Maven
FROM maven:3.6.3-openjdk-8 AS build
WORKDIR /app
# Copy Maven descriptor and source code
COPY pom.xml .
COPY src ./src
# Resolve dependencies and package the application
RUN mvn clean package -DskipTests

# Stage 2: Runtime image with only OpenJDK 8
FROM openjdk:8-jre-slim
WORKDIR /app
# Copy the assembled jar from the build stage
COPY --from=build /app/target/vulnapp-1.0-SNAPSHOT-jar-with-dependencies.jar ./vulnapp.jar
# Expose application port (default 8080 as used by the app)
EXPOSE 8080
# Run the application
CMD ["java", "-jar", "vulnapp.jar"]