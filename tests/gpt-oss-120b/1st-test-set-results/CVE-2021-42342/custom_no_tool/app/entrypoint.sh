#!/bin/sh
# Wait for MySQL to become reachable before starting the Flask app
set -e
# Initial pause to give MySQL container time to finish initialization
sleep 5
host="${DATABASE_HOST:-db}"
port=3306
max_tries=120
tries=0
while ! mysqladmin ping -h "$host" -P "$port" --silent; do
  tries=$((tries + 1))
  if [ $tries -ge $max_tries ]; then
    echo "MySQL not reachable after $max_tries attempts, exiting."
    exit 1
  fi
  echo "Waiting for MySQL at $host:$port... (attempt $tries)"
  sleep 2
done
exec python app.py