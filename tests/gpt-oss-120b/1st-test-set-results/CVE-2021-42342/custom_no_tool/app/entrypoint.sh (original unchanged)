#!/bin/sh
# Wait for MySQL to become reachable before starting the Flask app
set -e
host="${DATABASE_HOST:-db}"
port=3306
user="${DATABASE_USER:-vulnuser}"
password="${DATABASE_PASSWORD:-vulnpass}"
max_tries=30
tries=0
while ! mysqladmin ping -h "$host" -P "$port" -u "$user" -p"$password" --silent; do
  tries=$((tries + 1))
  if [ $tries -ge $max_tries ]; then
    echo "MySQL not reachable after $max_tries attempts, exiting."
    exit 1
  fi
  echo "Waiting for MySQL at $host:$port... (attempt $tries)"
  sleep 2
done
exec python app.py
