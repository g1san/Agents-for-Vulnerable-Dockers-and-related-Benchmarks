FROM node:14-alpine
WORKDIR /usr/src/app

# Copy package definition first
COPY package.json .

# Install build tools, MySQL client, then install npm deps and clean up build tools
RUN apk add --no-cache make gcc g++ python3 mariadb-client \
    && npm install \
    && apk del make gcc g++ python3

# Copy application source files
COPY server.js .
COPY wait-for-db.sh .
RUN chmod +x wait-for-db.sh

EXPOSE 8080
CMD ["node","server.js"]