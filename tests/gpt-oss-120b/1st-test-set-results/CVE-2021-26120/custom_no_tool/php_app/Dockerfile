FROM php:8.0-apache

# Install required system packages and PHP extensions
RUN apt-get update && apt-get install -y \
        libzip-dev \
        zlib1g-dev \
        unzip \
    && docker-php-ext-install zip

# Install Composer
COPY --from=composer:2.5 /usr/bin/composer /usr/bin/composer

WORKDIR /var/www/html

# Copy application source files
COPY index.php .
COPY templates ./templates

# Install the vulnerable Smarty version (3.1.38)
RUN composer require smarty/smarty:3.1.38

EXPOSE 80
CMD ["apache2-foreground"]