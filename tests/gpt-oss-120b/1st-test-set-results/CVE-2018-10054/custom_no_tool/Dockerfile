FROM openjdk:11-jre-slim

ENV H2_VERSION=1.4.197

# Install curl (required for downloading the H2 jar)
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# Download the H2 Database jar into /opt
RUN curl -L -o /opt/h2.jar https://repo1.maven.org/maven2/com/h2database/h2/${H2_VERSION}/h2-${H2_VERSION}.jar

# Create a directory for database files and place the init script
RUN mkdir -p /opt/h2-data
COPY init.sql /opt/init.sql
COPY entrypoint.sh /opt/entrypoint.sh
RUN chmod +x /opt/entrypoint.sh

# Expose the default H2 web console (8082) and TCP port (9092)
EXPOSE 8082 9092

# Default environment variables (can be overridden in dockerâ€‘compose)
ENV WEB_ALLOW_OTHERS=false
ENV TCP_ALLOW_OTHERS=false

# Use the custom entrypoint that conditionally adds flags and runs the init script
ENTRYPOINT ["sh", "/opt/entrypoint.sh"]