FROM openjdk:11-jre-slim

ENV H2_VERSION=2.0.204

# Install wget and CA certificates in one layer and clean apt cache
RUN apt-get update && apt-get install -y --no-install-recommends wget ca-certificates && rm -rf /var/lib/apt/lists/*

# Create directory for the database files
RUN mkdir -p /opt/db

# Download the H2 database jar (vulnerable version)
RUN wget -O /opt/h2.jar https://repo1.maven.org/maven2/com/h2database/h2/${H2_VERSION}/h2-${H2_VERSION}.jar

# Copy initialization script, entrypoint and sample data
COPY init.sql /opt/init.sql
COPY entrypoint.sh /opt/entrypoint.sh
RUN chmod +x /opt/entrypoint.sh

# Expose default H2 TCP and web console ports
EXPOSE 1521 8082

ENTRYPOINT ["/opt/entrypoint.sh"]