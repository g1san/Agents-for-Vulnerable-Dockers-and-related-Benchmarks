#!/bin/sh
set -e

# Ensure the database directory exists (also created at build time)
mkdir -p /opt/db

# Initialize the database with test data if it does not exist yet
if [ ! -f /opt/db/test.mv.db ]; then
    java -cp /opt/h2.jar org.h2.tools.RunScript \
        -url jdbc:h2:/opt/db/test \
        -user sa \
        -script /opt/init.sql
fi

# Start H2 server as the container's main process
exec java -cp /opt/h2.jar org.h2.tools.Server \
    -tcp -tcpPort 1521 -tcpAllowOthers \
    -web -webPort 8082 -webAllowOthers \
    -baseDir /opt/db \
    -ifNotExists