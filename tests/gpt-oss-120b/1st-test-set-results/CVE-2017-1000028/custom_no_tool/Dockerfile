FROM glassfish:4.1-jdk8

# Set GlassFish home directory
ENV GLASSFISH_HOME=/opt/glassfish

# Copy the web application source into a temporary location
COPY webapp/ /tmp/webapp/

# Build the WAR file directly in the autodeploy directory
WORKDIR /tmp/webapp
RUN mkdir -p $GLASSFISH_HOME/glassfish/domains/domain1/autodeploy && \
    jar cf $GLASSFISH_HOME/glassfish/domains/domain1/autodeploy/webapp.war -C /tmp/webapp .

# Expose the default HTTP port
EXPOSE 8080

# Start GlassFish in foreground mode when the container runs
CMD ["/opt/glassfish/bin/asadmin", "start-domain", "-v"]