#!/bin/sh
# Wait until the local registry is ready
while ! curl -s http://registry:5000/v2/_catalog > /dev/null; do
  echo "Waiting for registry to become available..."
  sleep 2
done

echo "Registry is up. Pulling malicious image..."
# Pull the malicious image from the registry service
docker pull registry:5000/malicious

if [ $? -ne 0 ]; then
  echo "Failed to pull malicious image. Exiting."
  exit 1
fi

echo "Running malicious container..."
# Run the image (remove container after it exits)
docker run --rm registry:5000/malicious