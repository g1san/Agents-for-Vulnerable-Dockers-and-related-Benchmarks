import os
from flask import Flask, request, jsonify
import psycopg2

app = Flask(__name__)

# Vulnerable endpoint - demonstrates CVE-2022-34265 (path traversal leading to remote code execution)
@app.route('/vuln', methods=['GET'])
def vulnerable():
    # The 'file' parameter is used directly in an os.system call without validation
    file_path = request.args.get('file')
    if not file_path:
        return jsonify({'error': 'file parameter missing'}), 400
    # Unsafe execution - this is the core of CVE-2022-34265
    os.system(f'cat {file_path}')
    return jsonify({'status': 'executed'}), 200

@app.route('/data', methods=['GET'])
def get_data():
    conn = psycopg2.connect(os.getenv('DATABASE_URL'))
    cur = conn.cursor()
    cur.execute('SELECT id, name FROM test_table;')
    rows = cur.fetchall()
    cur.close()
    conn.close()
    return jsonify([{'id': r[0], 'name': r[1]} for r in rows])

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)