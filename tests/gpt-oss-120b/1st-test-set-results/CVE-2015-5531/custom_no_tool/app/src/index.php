<?php
// Secure payload handling – replace unsafe unserialize with JSON validation
if (isset($_GET['payload'])) {
    $data = $_GET['payload'];
    $decoded = base64_decode($data, true);
    if ($decoded === false) {
        http_response_code(400);
        echo "Invalid base64 payload.";
        exit;
    }
    // Expect a JSON object with a simple string field "action"
    $json = json_decode($decoded, true);
    if (json_last_error() !== JSON_ERROR_NONE) {
        http_response_code(400);
        echo "Payload is not valid JSON.";
        exit;
    }
    if (!isset($json['action']) || !is_string($json['action'])) {
        http_response_code(400);
        echo "Missing or invalid 'action' field.";
        exit;
    }
    // Process the allowed action safely
    echo "Processed action: " . htmlspecialchars($json['action']);
} else {
    echo "Send payload via ?payload=BASE64_JSON_STRING";
}
?>