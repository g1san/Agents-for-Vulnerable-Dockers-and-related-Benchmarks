#!/usr/bin/env bash
# wait-for-it.sh script (simplified version)
# Usage: ./wait-for-it.sh host:port -- command args
set -e
HOSTPORT=$1
shift
# Extract host and port
HOST=$(echo $HOSTPORT | cut -d':' -f1)
PORT=$(echo $HOSTPORT | cut -d':' -f2)
# Timeout after 60 seconds
TIMEOUT=60
START_TIME=$(date +%s)
while ! nc -z $HOST $PORT >/dev/null 2>&1; do
  echo "Waiting for $HOST:$PORT..."
  sleep 1
  CURRENT_TIME=$(date +%s)
  ELAPSED=$((CURRENT_TIME - START_TIME))
  if [ $ELAPSED -ge $TIMEOUT ]; then
    echo "Timeout waiting for $HOST:$PORT"
    exit 1
  fi
done
# Execute the remaining command
exec "$@"