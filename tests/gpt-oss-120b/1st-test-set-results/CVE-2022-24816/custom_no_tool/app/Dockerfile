FROM python:3.9-slim
WORKDIR /app
# Install build tools, PostgreSQL client libraries, netcat, dos2unix and bash for the wait‑for‑it script
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc \
    libpq-dev \
    python3-dev \
    netcat-openbsd \
    dos2unix \
    bash \
    && rm -rf /var/lib/apt/lists/*
# Install Python dependencies (pin Werkzeug to a compatible version)
RUN pip install Flask==2.0.1 Werkzeug==2.0.3 psycopg2-binary
# Copy application code and helper script
COPY app.py .
COPY wait-for-it.sh .
# Ensure the script has Unix line endings and is executable
RUN dos2unix wait-for-it.sh && chmod +x wait-for-it.sh
EXPOSE 5000
# Wait for the database to become healthy before starting the app
CMD ["sh", "-c", "./wait-for-it.sh db:5432 -- python app.py"]