#!/bin/sh
set -e

# Initialise the metadata database only when the webserver starts
COMPONENT=${1:-webserver}

if [ "$COMPONENT" = "webserver" ]; then
  if [ ! -f /usr/local/airflow/airflow.db ]; then
    airflow db init
  fi
fi

if [ "$COMPONENT" = "scheduler" ]; then
  exec airflow scheduler
else
  exec airflow webserver
fi