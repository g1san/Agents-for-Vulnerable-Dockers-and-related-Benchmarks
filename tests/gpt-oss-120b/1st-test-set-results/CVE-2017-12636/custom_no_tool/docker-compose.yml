services:
  registry:
    image: registry:2.8.1
    container_name: vulnerable_registry
    environment:
      - REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY=/var/lib/registry
    ports:
      - "5000:5000"
    volumes:
      - registry-data:/var/lib/registry
  client:
    build:
      context: ./
      dockerfile: Dockerfile.client
    container_name: exploit_client
    depends_on:
      - registry
    environment:
      - DOCKER_HOST=unix:///var/run/docker.sock
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    privileged: true
    networks:
      - default
  simple_app:
    build:
      context: ./simple-app
    container_name: simple_app
    depends_on:
      - registry
    networks:
      - default
volumes:
  registry-data:
networks:
  default:
    driver: bridge