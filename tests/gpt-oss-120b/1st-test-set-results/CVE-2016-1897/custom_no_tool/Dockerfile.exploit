FROM debian:bullseye-slim

# Install tools needed to download and extract a static ffmpeg binary, plus required runtime libraries
RUN apt-get update && apt-get install -y --no-install-recommends ca-certificates curl xz-utils libstdc++ && rm -rf /var/lib/apt/lists/*

# Download vulnerable ffmpeg 2.8.4 static build and install it
ENV FFMPEG_URL="https://johnvansickle.com/ffmpeg/releases/ffmpeg-2.8.4-64bit-static.tar.xz"
RUN curl -L "$FFMPEG_URL" -o /tmp/ffmpeg.tar.xz && \
    tar -xJf /tmp/ffmpeg.tar.xz -C /tmp && \
    mv /tmp/ffmpeg-*/ffmpeg /usr/local/bin/ffmpeg && \
    chmod +x /usr/local/bin/ffmpeg && \
    rm -f /tmp/ffmpeg.tar.xz

COPY exploit.sh /exploit.sh
RUN chmod +x /exploit.sh

EXPOSE 8080
ENTRYPOINT ["/exploit.sh"]