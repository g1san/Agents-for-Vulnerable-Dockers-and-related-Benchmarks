FROM ubuntu:16.04
RUN apt-get update && apt-get install -y apache2 apache2-utils && rm -rf /var/lib/apt/lists/*
# Enable CGI module
RUN a2enmod cgi && a2enmod rewrite && service apache2 restart
# Create CGI directory and copy script
RUN mkdir -p /usr/lib/cgi-bin
COPY vulnerable.cgi /usr/lib/cgi-bin/vulnerable.cgi
RUN chmod +x /usr/lib/cgi-bin/vulnerable.cgi
# Configure default site to allow CGI execution
RUN sed -i 's/Options Indexes FollowSymLinks/Options Indexes FollowSymLinks ExecCGI/' /etc/apache2/sites-available/000-default.conf && \
    echo "ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/" >> /etc/apache2/sites-available/000-default.conf && \
    echo "<Directory \"/usr/lib/cgi-bin\">" >> /etc/apache2/sites-available/000-default.conf && \
    echo "    AllowOverride None" >> /etc/apache2/sites-available/000-default.conf && \
    echo "    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch" >> /etc/apache2/sites-available/000-default.conf && \
    echo "    AddHandler cgi-script .cgi" >> /etc/apache2/sites-available/000-default.conf && \
    echo "    Require all granted" >> /etc/apache2/sites-available/000-default.conf && \
    echo "</Directory>" >> /etc/apache2/sites-available/000-default.conf
EXPOSE 80
CMD ["/usr/sbin/apache2ctl", "-D", "FOREGROUND"]