FROM php:7.3-apache
RUN apt-get update && apt-get install -y \
    git unzip curl \
    libpng-dev libjpeg-dev libfreetype6-dev libpq-dev libzip-dev && \
    docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ && \
    docker-php-ext-install pdo pdo_mysql gd zip && \
    apt-get clean && rm -rf /var/lib/apt/lists/*
WORKDIR /var/www/html
RUN curl -L https://ftp.drupal.org/files/projects/drupal-7.31.zip -o drupal.zip \
    && unzip drupal.zip && mv drupal-7.31/* . && rm -rf drupal-7.31 drupal.zip \
    && mv sites/default.default sites/default || true \
    && mkdir -p sites/default \
    && chown -R www-data:www-data /var/www/html
COPY settings.php ./sites/default/
RUN chown -R www-data:www-data /var/www/html