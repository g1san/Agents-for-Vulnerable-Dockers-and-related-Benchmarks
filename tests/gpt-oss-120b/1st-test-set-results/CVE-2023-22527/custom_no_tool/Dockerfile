FROM atlassian/confluence-server:8.5.3

# Install any missing runtime dependencies that the patched image might need
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        ca-certificates \
        wget \
        unzip \
        netcat-openbsd && \
    rm -rf /var/lib/apt/lists/*

# Ensure the Confluence start script is executable (path used by the entrypoint wrapper)
RUN chmod +x /opt/atlassian/confluence/bin/start-confluence.sh || true

# Copy the wait‑for‑it script into the image (kept for optional manual use)
COPY wait-for-it.sh /usr/local/bin/wait-for-it.sh
RUN chmod +x /usr/local/bin/wait-for-it.sh

# Use the default entrypoint from the base image; no custom command overrides