CREATE DATABASE IF NOT EXISTS cacti;
USE cacti;

-- Users
CREATE TABLE user_auth (
    id int(11) NOT NULL AUTO_INCREMENT,
    username varchar(20) NOT NULL,
    password varchar(255) NOT NULL,
    PRIMARY KEY (id)
);
INSERT INTO user_auth (username, password) VALUES ('admin', MD5('admin'));

-- Poller table
CREATE TABLE poller (
    id int(11) NOT NULL AUTO_INCREMENT,
    hostname varchar(255) NOT NULL,
    PRIMARY KEY (id)
);
INSERT INTO poller (hostname) VALUES ('localhost');

-- poller_item with command injection possibility
CREATE TABLE poller_item (
    id int(11) NOT NULL AUTO_INCREMENT,
    host_id int(11) NOT NULL DEFAULT '1',
    rrd_path varchar(255),
    action int(11),
    command varchar(255),
    PRIMARY KEY (id)
);

-- Example vulnerable command
-- This is where RCE can occur due to unsanitized user input
INSERT INTO poller_item (host_id, rrd_path, action, command) VALUES (
    1,
    '/tmp/test.rrd',
    1,  -- POLLER_ACTION_SCRIPT_PHP
    '/bin/echo vulnerable > /tmp/vuln-test'
);
