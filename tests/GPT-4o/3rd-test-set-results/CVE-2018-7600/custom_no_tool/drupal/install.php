<?php

// This script is used to automate the installation of Drupal.
// It will be executed when the Drupal container starts.

// Check if the site is already installed.
if (file_exists('/var/www/html/sites/default/settings.php')) {
  exit('Drupal is already installed.\n');
}

// Copy the default settings file.
copy('/var/www/html/sites/default/default.settings.php', '/var/www/html/sites/default/settings.php');

// Include the settings file to set the database connection.
include '/var/www/html/sites/default/settings.php';

// Set up the database connection.
$databases['default']['default'] = array (
  'driver' => 'mysql',
  'database' => 'drupal',
  'username' => 'drupal',
  'password' => 'drupal',
  'host' => 'db',
  'prefix' => '',
);

// Save the settings file.
file_put_contents('/var/www/html/sites/default/settings.php', '<?php\n' . var_export($databases, TRUE) . ';\n');

// Run the Drupal installation script.
exec('drush site-install standard --account-name=admin --account-pass=admin --db-url=mysql://drupal:drupal@db/drupal');

