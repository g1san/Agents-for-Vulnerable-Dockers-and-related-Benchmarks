{
    "files": [
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/docker-compose.yml",
            "content": "version: '3.8'\n\nservices:\n  web:\n    build: ./web\n    ports:\n      - \"8000:8000\"\n    depends_on:\n      - db\n    environment:\n      - WAIT_FOR_IT=db:3306\n    command: [\"/bin/sh\", \"-c\", \"./wait-for-it.sh db:3306 --timeout=60 --strict -- python manage.py migrate && python manage.py runserver 0.0.0.0:8000\"]\n    networks:\n      - webnet\n\n  db:\n    image: mysql:5.7\n    environment:\n      MYSQL_ROOT_PASSWORD: example\n      MYSQL_DATABASE: testdb\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - db_data:/var/lib/mysql\n      - ./web/init_db.sql:/docker-entrypoint-initdb.d/init_db.sql\n    networks:\n      - webnet\n    command: [\"--default-authentication-plugin=mysql_native_password\"]\n    healthcheck:\n      test: [\"CMD\", \"mysqladmin\", \"ping\", \"-h\", \"localhost\"]\n      interval: 10s\n      retries: 3\n\nvolumes:\n  db_data:\n\nnetworks:\n  webnet:\n"
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/Dockerfile",
            "content": "FROM python:3.8.13\n\nWORKDIR /app\n\nCOPY requirements.txt requirements.txt\nRUN pip install --no-cache-dir -r requirements.txt\n\n# Install netcat for the wait-for-it script\nRUN apt-get update && apt-get install -y netcat\n\nCOPY . .\n\n# Ensure the wait-for-it script is executable\nRUN chmod +x /app/wait-for-it.sh\n\nCMD [\"/bin/sh\", \"-c\", \"./wait-for-it.sh db:3306 --timeout=60 --strict -- python manage.py migrate && python manage.py runserver 0.0.0.0:8000\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/requirements.txt",
            "content": "Django==3.2.14\nmysqlclient==2.0.3\nwait-for-it==0.0.1\n"
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/manage.py",
            "content": "#!/usr/bin/env python\nimport os\nimport sys\n\nif __name__ == '__main__':\n    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'vuln_project.settings')\n    try:\n        from django.core.management import execute_from_command_line\n    except ImportError as exc:\n        raise ImportError(\n            \"Couldn't import Django. Are you sure it's installed and \"\n            \"available on your PYTHONPATH environment variable? Did you \"\n            \"forget to activate a virtual environment?\"\n        ) from exc\n    execute_from_command_line(sys.argv)\n"
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/vuln_project/settings.py",
            "content": "from pathlib import Path\nimport os\n\n# Build paths inside the project like this: BASE_DIR / 'subdir'.\nBASE_DIR = Path(__file__).resolve().parent.parent\n\n# SECURITY WARNING: keep the secret key used in production secret!\nSECRET_KEY = 'django-insecure-!@#%&*^$randomsecretkey'\n\n# SECURITY WARNING: don't run with debug turned on in production!\nDEBUG = True\n\nALLOWED_HOSTS = ['*']\n\n# Application definition\nINSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'app',\n]\n\nMIDDLEWARE = [\n    'django.middleware.security.SecurityMiddleware',\n    'django.contrib.sessions.middleware.SessionMiddleware',\n    'django.middleware.common.CommonMiddleware',\n    'django.middleware.csrf.CsrfViewMiddleware',\n    'django.contrib.auth.middleware.AuthenticationMiddleware',\n    'django.contrib.messages.middleware.MessageMiddleware',\n    'django.middleware.clickjacking.XFrameOptionsMiddleware',\n]\n\nROOT_URLCONF = 'vuln_project.urls'\n\nTEMPLATES = [\n    {\n        'BACKEND': 'django.template.backends.django.DjangoTemplates',\n        'DIRS': [],\n        'APP_DIRS': True,\n        'OPTIONS': {\n            'context_processors': [\n                'django.template.context_processors.debug',\n                'django.template.context_processors.request',\n                'django.contrib.auth.context_processors.auth',\n                'django.contrib.messages.context_processors.messages',\n            ],\n        },\n    },\n]\n\nWSGI_APPLICATION = 'vuln_project.wsgi.application'\n\n# Database\n# https://docs.djangoproject.com/en/3.2/ref/settings/#databases\n\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.mysql',\n        'NAME': 'testdb',\n        'USER': 'root',\n        'PASSWORD': 'example',\n        'HOST': 'db',\n        'PORT': '3306',\n    }\n}\n\n# Password validation\n# https://docs.djangoproject.com/en/3.2/ref/settings/#auth-password-validators\n\nAUTH_PASSWORD_VALIDATORS = [\n    {\n        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',\n    },\n    {\n        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',\n    },\n    {\n        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',\n    },\n    {\n        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',\n    },\n]\n\n# Internationalization\n# https://docs.djangoproject.com/en/3.2/topics/i18n/\n\nLANGUAGE_CODE = 'en-us'\n\nTIME_ZONE = 'UTC'\n\nUSE_I18N = True\n\nUSE_L10N = True\n\nUSE_TZ = True\n\n# Static files (CSS, JavaScript, Images)\n# https://docs.djangoproject.com/en/3.2/howto/static-files/\n\nSTATIC_URL = '/static/'\n\n# Default primary key field type\n# https://docs.djangoproject.com/en/3.2/ref/settings/#default-auto-field\n\nDEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'\n"
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/vuln_project/urls.py",
            "content": "from django.contrib import admin\nfrom django.urls import path, include\n\nurlpatterns = [\n    path('admin/', admin.site.urls),\n    path('', include('app.urls')),\n]\n"
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/vuln_project/wsgi.py",
            "content": "import os\n\nfrom django.core.wsgi import get_wsgi_application\n\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'vuln_project.settings')\n\napplication = get_wsgi_application()\n"
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/app/models.py",
            "content": "from django.db import models\n\nclass SampleData(models.Model):\n    name = models.CharField(max_length=100)\n    created_at = models.DateTimeField(auto_now_add=True)\n\n    def __str__(self):\n        return self.name\n"
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/app/views.py",
            "content": "from django.shortcuts import render\nfrom django.http import HttpResponse\nfrom django.db.models.functions import Trunc\nfrom .models import SampleData\n\n# Vulnerable view\n\ndef vulnerable_view(request):\n    kind = request.GET.get('kind', 'day')  # This is where the vulnerability exists\n    data = SampleData.objects.annotate(truncated=Trunc('created_at', kind))\n    return HttpResponse(data)\n"
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/app/urls.py",
            "content": "from django.urls import path\nfrom . import views\n\nurlpatterns = [\n    path('vulnerable/', views.vulnerable_view),\n]\n"
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/app/__init__.py",
            "content": ""
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/vuln_project/__init__.py",
            "content": ""
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/app/migrations/0001_initial.py",
            "content": "# Generated by Django 3.2.13 on 2022-01-01\n\nfrom django.db import migrations, models\n\nclass Migration(migrations.Migration):\n\n    initial = True\n\n    dependencies = []\n\n    operations = [\n        migrations.CreateModel(\n            name='SampleData',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('name', models.CharField(max_length=100)),\n                ('created_at', models.DateTimeField(auto_now_add=True)),\n            ],\n        ),\n    ]\n"
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/app/migrations/__init__.py",
            "content": ""
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/init_db.sql",
            "content": "USE testdb;\n\nCREATE TABLE IF NOT EXISTS app_sampledata (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(100),\n    created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\nINSERT INTO app_sampledata (name, created_at) VALUES ('Test Data 1', NOW()), ('Test Data 2', NOW());\n"
        },
        {
            "location": "./../../dockers/CVE-2022-34265/custom_no_tool/web/wait-for-it.sh",
            "content": "#!/usr/bin/env bash\n#   Use this script to test if a given TCP host/port are available\n\n# The MIT License (MIT)\n#\n# Permission is hereby granted, free of charge, to any person obtaining a copy\n# of this software and associated documentation files (the \"Software\"), to deal\n# in the Software without restriction, including without limitation the rights\n# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n# copies of the Software, and to permit persons to whom the Software is\n# furnished to do so, subject to the following conditions:\n#\n# The above copyright notice and this permission notice shall be included in\n# all copies or substantial portions of the Software.\n#\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n# THE SOFTWARE.\n\nset -e\n\ncmdname=$(basename $0)\n\n\nfunction usage()\n{\n    cat << USAGE >&2\nUsage:\n    $cmdname host:port [-s] [-t timeout] [-- command args]\n    -h HOST | --host=HOST       Host or IP under test\n    -p PORT | --port=PORT       TCP port under test\n    -s | --strict               Only execute subcommand if the test succeeds\n    -q | --quiet                Don't output any status messages\n    -t TIMEOUT | --timeout=TIMEOUT\n                                Timeout in seconds, zero for no timeout\n    -- COMMAND ARGS             Execute command with args after the test finishes\n\n\nUSAGE\n    exit 1\n}\n\nwait_for()\n{\n    if [[ $TIMEOUT -gt 0 ]]; then\n        echo \"Waiting for $HOST:$PORT...\"\n    fi\n\n    for i in $(seq $TIMEOUT) ; do\n        nc -z $HOST $PORT\n        result=$?\n\n        if [[ $result -eq 0 ]]; then\n            if [[ $QUIET -ne 1 ]]; then\n                echo \"$HOST:$PORT is available after $i seconds\"\n            fi\n            return 0\n        fi\n\n        sleep 1\n    done\n\n    echo \"Operation timed out after $TIMEOUT seconds\"\n    return 1\n}\n\n# process arguments\nwhile [[ $# -gt 0 ]]; do\n    case \"$1\" in\n        *:* )\n        hostport=(${1//:/ })\n        HOST=${hostport[0]}\n        PORT=${hostport[1]}\n        shift 1\n        ;;\n        -h)\n        HOST=\"$2\"\n        if [[ $HOST == \"\" ]]; then break; fi\n        shift 2\n        ;;\n        --host=*)\n        HOST=\"${1#*=}\"\n        shift 1\n        ;;\n        -p)\n        PORT=\"$2\"\n        if [[ $PORT == \"\" ]]; then break; fi\n        shift 2\n        ;;\n        --port=*)\n        PORT=\"${1#*=}\"\n        shift 1\n        ;;\n        -s | --strict)\n        STRICT=1\n        shift 1\n        ;;\n        -q | --quiet)\n        QUIET=1\n        shift 1\n        ;;\n        -t)\n        TIMEOUT=\"$2\"\n        if [[ $TIMEOUT == \"\" ]]; then break; fi\n        shift 2\n        ;;\n        --timeout=*)\n        TIMEOUT=\"${1#*=}\"\n        shift 1\n        ;;\n        --)\n        shift\n        CLI=($@)\n        break\n        ;;\n        --help)\n        usage\n        ;;\n        *)\n        echo \"Unknown argument: $1\"\n        usage\n        ;;\n    esac\n\ndone\n\nif [[ \"$HOST\" == \"\" || \"$PORT\" == \"\" ]]; then\n    echo \"Error: you need to provide a host and port to test.\"\n    usage\nfi\n\nTIMEOUT=${TIMEOUT:-15}\nSTRICT=${STRICT:-0}\nQUIET=${QUIET:-0}\n\nwait_for\nresult=$?\n\nif [[ $CLI != \"\" ]]; then\n    if [[ $result -ne 0 && $STRICT -eq 1 ]]; then\n        echo \"Strict mode, not executing subprocess\"\n        exit $result\n    fi\n    exec \"${CLI[@]}\"\nelse\n    exit $result\nfi\n"
        }
    ],
    "directory_tree": "CVE-2022-34265/\n\u251c\u2500\u2500 custom_no_tool\n\u2502   \u251c\u2500\u2500 docker-compose.yml\n\u2502   \u2514\u2500\u2500 web\n\u2502       \u251c\u2500\u2500 Dockerfile\n\u2502       \u251c\u2500\u2500 app\n\u2502       \u2502   \u251c\u2500\u2500 __init__.py\n\u2502       \u2502   \u251c\u2500\u2500 migrations\n\u2502       \u2502   \u2502   \u251c\u2500\u2500 0001_initial.py\n\u2502       \u2502   \u2502   \u2514\u2500\u2500 __init__.py\n\u2502       \u2502   \u251c\u2500\u2500 models.py\n\u2502       \u2502   \u251c\u2500\u2500 urls.py\n\u2502       \u2502   \u2514\u2500\u2500 views.py\n\u2502       \u251c\u2500\u2500 init_db.sql\n\u2502       \u251c\u2500\u2500 manage.py\n\u2502       \u251c\u2500\u2500 requirements.txt\n\u2502       \u251c\u2500\u2500 vuln_project\n\u2502       \u2502   \u251c\u2500\u2500 __init__.py\n\u2502       \u2502   \u251c\u2500\u2500 settings.py\n\u2502       \u2502   \u251c\u2500\u2500 urls.py\n\u2502       \u2502   \u2514\u2500\u2500 wsgi.py\n\u2502       \u2514\u2500\u2500 wait-for-it.sh\n"
}