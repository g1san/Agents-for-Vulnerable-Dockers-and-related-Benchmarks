FROM alpine:3.3

RUN apk add --no-cache --virtual .build-deps \
        build-base \
        wget \
        tar \
        bzip2 \
        x264-dev \
        x265-dev \
        libvpx-dev \
        libvorbis-dev \
        lame-dev \
        opus-dev \
        libtheora-dev \
        yasm \
    && wget --no-check-certificate https://ffmpeg.org/releases/ffmpeg-2.6.6.tar.bz2 \
    && tar xvjf ffmpeg-2.6.6.tar.bz2 \
    && cd ffmpeg-2.6.6 \
    && ./configure --prefix=/usr --disable-debug --enable-shared --enable-gpl --enable-libx264 --enable-libx265 \
    && make \
    && make install \
    && cd .. \
    && rm -rf ffmpeg-2.6.6 ffmpeg-2.6.6.tar.bz2 \
    && apk del .build-deps

WORKDIR /media

# Copy any media files here for testing
COPY sample.m3u8 /media/sample.m3u8

CMD ["/usr/bin/ffmpeg", "-i", "http://0.0.0.0:8080/media/sample.m3u8", "-f", "null", "-"]  # Run FFmpeg to process the sample file
