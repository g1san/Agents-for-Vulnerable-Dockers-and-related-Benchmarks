#!/bin/bash

# Watch the /media directory for new files and process them with ffmpeg
inotifywait -m /media -e create -e moved_to |
    while read path action file; do
        echo "The file '$file' appeared in directory '$path' via '$action'"
        # Check if the file is accessible and process it with ffmpeg
        if [[ "$file" == *.m3u8 ]]; then
            if [[ -f "/media/$file" ]]; then
                ffmpeg -i "/media/$file" -c:v libx264 -c:a aac -f mp4 "/media/processed_${file%.*}.mp4"
            else
                echo "File not found: /media/$file"
            fi
        else
            echo "Unsupported file format: $file"
        fi
    done
