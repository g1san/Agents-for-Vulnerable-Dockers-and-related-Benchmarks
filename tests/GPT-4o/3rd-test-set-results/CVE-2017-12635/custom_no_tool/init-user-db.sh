#!/bin/bash
# Initialize the CouchDB database with a user that has duplicate roles

# Wait for CouchDB to start
while ! curl -s http://admin:password@localhost:5984/_users; do
    echo "Waiting for CouchDB to start..."
    sleep 1
done

# Create a user with duplicate roles, including '_admin'
USER_DOC='{
  "_id": "org.couchdb.user:attacker",
  "name": "attacker",
  "roles": ["user", "_admin"],
  "type": "user",
  "password": "attackerpass"
}'

curl -X PUT http://admin:password@localhost:5984/_users/org.couchdb.user:attacker \
     -H "Content-Type: application/json" \
     -d "$USER_DOC"
