{
    "files": [
        {
            "location": "./../../dockers/CVE-2017-12635/custom_no_tool/docker-compose.yml",
            "content": "services:\n  couchdb:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    container_name: vulnerable_couchdb\n    environment:\n      - COUCHDB_USER=admin\n      - COUCHDB_PASSWORD=password\n    ports:\n      - \"5984:5984\"\n    volumes:\n      - couchdb_data:/opt/couchdb/data\n    command: [\"/bin/bash\", \"-c\", \"./init-user-db.sh && couchdb\"]\n\nvolumes:\n  couchdb_data:\n    driver: local\n"
        },
        {
            "location": "./../../dockers/CVE-2017-12635/custom_no_tool/Dockerfile",
            "content": "FROM erlang:20\n\n# Configure the old Debian repository\nRUN echo 'deb http://archive.debian.org/debian buster main' > /etc/apt/sources.list && \\\n    echo 'deb-src http://archive.debian.org/debian buster main' >> /etc/apt/sources.list && \\\n    echo 'Acquire::Check-Valid-Until \"false\";' > /etc/apt/apt.conf.d/99no-check-valid-until\n\n# Install dependencies\nRUN apt-get update && \\\n    apt-get install -y --no-install-recommends \\\n    build-essential \\\n    libicu-dev \\\n    libcurl4-openssl-dev \\\n    curl \\\n    wget \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Manually download and install libmozjs185-dev from an alternative source\nRUN wget https://snapshot.debian.org/archive/debian/20170707T000000Z/pool/main/libm/libmozjs185/libmozjs185-dev_1.8.5-1.0.0+dfsg-4_amd64.deb && \\\n    dpkg -i libmozjs185-dev_1.8.5-1.0.0+dfsg-4_amd64.deb && \\\n    rm libmozjs185-dev_1.8.5-1.0.0+dfsg-4_amd64.deb\n\n# Download and build CouchDB 1.7.0\nRUN curl -L https://archive.apache.org/dist/couchdb/source/1.7.0/apache-couchdb-1.7.0.tar.gz | tar xz && \\\n    cd apache-couchdb-1.7.0 && \\\n    ./configure && \\\n    make && \\\n    make install\n\n# Setup CouchDB\nRUN adduser --disabled-password --gecos '' couchdb && \\\n    chown -R couchdb:couchdb /usr/local/var/lib/couchdb /usr/local/var/log/couchdb /usr/local/var/run/couchdb\n\nCOPY init-user-db.sh /init-user-db.sh\nRUN chmod +x /init-user-db.sh\n\nUSER couchdb\n\nCMD [\"couchdb\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2017-12635/custom_no_tool/init-user-db.sh",
            "content": "#!/bin/bash\n# Initialize the CouchDB database with a user that has duplicate roles\n\n# Wait for CouchDB to start\nwhile ! curl -s http://admin:password@localhost:5984/_users; do\n    echo \"Waiting for CouchDB to start...\"\n    sleep 1\ndone\n\n# Create a user with duplicate roles, including '_admin'\nUSER_DOC='{\n  \"_id\": \"org.couchdb.user:attacker\",\n  \"name\": \"attacker\",\n  \"roles\": [\"user\", \"_admin\"],\n  \"type\": \"user\",\n  \"password\": \"attackerpass\"\n}'\n\ncurl -X PUT http://admin:password@localhost:5984/_users/org.couchdb.user:attacker \\\n     -H \"Content-Type: application/json\" \\\n     -d \"$USER_DOC\"\n"
        }
    ],
    "directory_tree": "CVE-2017-12635/\n\u251c\u2500\u2500 custom_no_tool\n\u2502   \u251c\u2500\u2500 Dockerfile\n\u2502   \u251c\u2500\u2500 docker-compose.yml\n\u2502   \u2514\u2500\u2500 init-user-db.sh\n"
}