FROM ubuntu:16.04

RUN apt-get update && \
    apt-get install -y openssh-server build-essential wget libssl-dev libcurl4-openssl-dev libexpat1-dev gettext && \
    mkdir /var/run/sshd && \
    useradd -m -d /home/git -s /usr/bin/git-shell git && \
    echo 'git:git' | chpasswd && \
    mkdir -p /home/git/.ssh && \
    chown git:git /home/git/.ssh

# Install specific vulnerable version of Git
RUN wget https://www.kernel.org/pub/software/scm/git/git-2.7.4.tar.gz && \
    tar -xzvf git-2.7.4.tar.gz && \
    cd git-2.7.4 && \
    make prefix=/usr/local all && \
    make prefix=/usr/local install

COPY sshd_config /etc/ssh/sshd_config

CMD ["/usr/sbin/sshd", "-D"]
