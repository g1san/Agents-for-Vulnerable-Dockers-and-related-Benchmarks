FROM jboss/base-jdk:7

# Switch to root to create necessary directories
USER root

# Simulate JBoss EAP 5.2.0 installation
RUN mkdir -p /opt/jboss-eap-5.2/bin && \
    echo -e '#!/bin/bash\necho "Starting JBoss EAP 5.2.0"' > /opt/jboss-eap-5.2/bin/standalone.sh && \
    chmod +x /opt/jboss-eap-5.2/bin/standalone.sh

# Create configuration directory and copy configuration files
RUN mkdir -p /opt/jboss-eap-5.2/standalone/configuration
COPY standalone.xml /opt/jboss-eap-5.2/standalone/configuration/standalone.xml
COPY ReadOnlyAccessFilter.java /opt/jboss-eap-5.2/custom/ReadOnlyAccessFilter.java

# Switch back to jboss user
USER jboss

# Set environment variables
ENV JBOSS_HOME /opt/jboss-eap-5.2
ENV PATH $PATH:$JBOSS_HOME/bin

# Expose ports
EXPOSE 8080

CMD ["/opt/jboss-eap-5.2/bin/standalone.sh", "-b", "0.0.0.0"]
