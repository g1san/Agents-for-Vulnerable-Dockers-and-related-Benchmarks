# Use a base image that is compatible and widely available
FROM adoptopenjdk:8-jdk-hotspot

# Install Elasticsearch 1.4.4
RUN apt-get update \
    && apt-get install -y wget \
    && wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.4.4.tar.gz \
    && tar -xzf elasticsearch-1.4.4.tar.gz \
    && mv elasticsearch-1.4.4 /usr/share/elasticsearch \
    && rm elasticsearch-1.4.4.tar.gz \
    && apt-get remove -y wget \
    && apt-get autoremove -y \
    && rm -rf /var/lib/apt/lists/*

# Copy site plugin to trigger vulnerability
COPY site_plugin /usr/share/elasticsearch/plugins/site

# Expose ports
EXPOSE 9200 9300

CMD ["/usr/share/elasticsearch/bin/elasticsearch"]
