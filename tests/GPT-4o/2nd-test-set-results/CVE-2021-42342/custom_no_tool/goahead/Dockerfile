FROM debian:bullseye

RUN apt-get update && \
    apt-get install -y build-essential wget git libssl-dev && \
    git clone https://github.com/embedthis/goahead.git && \
    cd goahead && \
    git checkout main && \
    make && \
    make install

WORKDIR /goahead

# Copy the GoAhead binary to the working directory
RUN cp build/linux-x64-dev/bin/goahead /goahead/

# Ensure shared libraries are installed
RUN cp build/linux-x64-dev/lib/libgo.so /usr/local/lib/ && \
    ldconfig

# Set the library path
ENV LD_LIBRARY_PATH=/usr/local/lib

CMD ["./goahead", "--home", "/etc/goahead", "--port", "80"]
