FROM ubuntu:20.04

# Set non-interactive frontend for apt-get
ENV DEBIAN_FRONTEND=noninteractive

# Install dependencies
RUN apt-get update && \
    apt-get install -y wget build-essential && \
    apt-get install -y ghostscript libxml2-dev && \
    apt-get clean

# Define ImageMagick version
ENV IMAGEMAGICK_VERSION=6.9.11-39

# Download and install ImageMagick from a reliable mirror
RUN wget https://legacy.imagemagick.org/download/releases/ImageMagick-${IMAGEMAGICK_VERSION}.tar.gz && \
    tar -xzf ImageMagick-${IMAGEMAGICK_VERSION}.tar.gz && \
    cd ImageMagick-${IMAGEMAGICK_VERSION} && \
    ./configure --prefix=/usr/local && \
    make && \
    make install && \
    ldconfig /usr/local/lib

# Copy test script
COPY test.sh /usr/local/bin/test.sh
RUN chmod +x /usr/local/bin/test.sh

# Expose port
EXPOSE 80

CMD ["/usr/local/bin/test.sh"]
