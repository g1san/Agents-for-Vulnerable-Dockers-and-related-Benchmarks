version: '3.8'

services:
  hadoop:
    build: ./hadoop
    container_name: hadoop
    user: "root" # Start container as root to set up environment
    volumes:
      - hadoop_data:/hadoop_data
    ports:
      - "9870:9870"
      - "8088:8088"
    environment:
      - HADOOP_HOME=/hadoop
      - HADOOP_CONF_DIR=/hadoop/etc/hadoop
      - HDFS_NAMENODE_USER=hadoop
      - HDFS_DATANODE_USER=hadoop
      - HDFS_SECONDARYNAMENODE_USER=hadoop
    command: ["/bin/bash", "-c", "mkdir -p /run/sshd && chown root:root /run/sshd && chmod 0755 /run/sshd && service ssh start && su hadoop -c 'start-dfs.sh && start-yarn.sh' && tail -f /dev/null"]

volumes:
  hadoop_data:
