FROM php:7.3-apache

# Install necessary extensions and tools
RUN docker-php-ext-install mysqli pdo pdo_mysql && \
    a2enmod rewrite

# Download and install CMS Made Simple version 2.2.9
RUN curl -o cmsms.tar.gz -L https://downloads.sourceforge.net/project/cmsmadesimple/stable/2.2.9/cmsmadesimple-2.2.9-install.tar.gz && \
    file_type=$(file --mime-type -b cmsms.tar.gz) && \
    if [ "$file_type" = "application/x-gzip" ]; then \
        tar -xzf cmsms.tar.gz -C /var/www/html --strip-components=1; \
    else \
        tar -xf cmsms.tar.gz -C /var/www/html --strip-components=1; \
    fi && \
    rm cmsms.tar.gz

# Copy configuration files
COPY ./src/config.php /var/www/html/config.php

# Set permissions
RUN chown -R www-data:www-data /var/www/html && \
    chmod -R 755 /var/www/html

# Expose port 80
EXPOSE 80
