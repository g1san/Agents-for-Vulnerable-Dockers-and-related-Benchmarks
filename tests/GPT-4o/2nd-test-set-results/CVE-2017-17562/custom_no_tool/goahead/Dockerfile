FROM alpine:3.7

RUN apk add --no-cache build-base wget tar

# Download and extract GoAhead source
RUN wget https://example.com/goahead-3.6.5.tar.gz -O /tmp/goahead-3.6.5.tar.gz \
    && mkdir -p /goahead-3.6.5 \
    && tar -xzf /tmp/goahead-3.6.5.tar.gz -C /goahead-3.6.5 --strip-components=1 \
    && rm /tmp/goahead-3.6.5.tar.gz

RUN cd /goahead-3.6.5 \
    && make \
    && cp /goahead-3.6.5/build/linux-x86-default/bin/goahead /usr/local/bin/ \
    && rm -rf /goahead-3.6.5

COPY goahead.conf /etc/goahead/goahead.conf

CMD ["goahead", "/etc/goahead/goahead.conf"]
