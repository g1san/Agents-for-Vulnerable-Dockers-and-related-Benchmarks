# Use an official AdoptOpenJDK runtime as a parent image
FROM adoptopenjdk:11-jdk-hotspot

# Set the working directory in the container
WORKDIR /usr/src/app

# Install necessary packages
RUN apt-get update && apt-get install -y wget netcat && rm -rf /var/lib/apt/lists/*

# Download HugeGraph-Server binary from GitHub releases
RUN wget https://github.com/apache/incubator-hugegraph/releases/download/v0.11.2/hugegraph-0.11.2.tar.gz \
    && tar -xzf hugegraph-0.11.2.tar.gz -C /usr/src/app \
    && rm hugegraph-0.11.2.tar.gz

# Set the working directory to HugeGraph-Server
WORKDIR /usr/src/app/hugegraph-0.11.2

# Expose the port the app runs on
EXPOSE 8080

# Run the application
CMD ["sh", "-c", "while ! nc -z db 3306; do sleep 1; done; ./bin/start-hugegraph.sh"]
