services:
  ghostscript:
    build: ./ghostscript
    container_name: ghostscript_vulnerable
    volumes:
      - ./scripts:/scripts
    command: ["gs", "-dNOPAUSE", "-dBATCH", "-sDEVICE=txtwrite", "-sOutputFile=/scripts/output.txt", "/scripts/exploit.ps"]

  imagemagick:
    image: dpokidov/imagemagick:7.0.8-14
    container_name: imagemagick
    volumes:
      - ./scripts:/scripts
    depends_on:
      - ghostscript

  python:
    image: python:3.7-slim
    container_name: python_script_runner
    volumes:
      - ./scripts:/scripts
    working_dir: /scripts
    command: ["python", "exploit.py"]
    depends_on:
      - ghostscript
      - imagemagick

networks:
  default:
    name: ghostscript_network
