FROM alpine:3.14

RUN apk add --no-cache build-base git autoconf automake libtool linux-headers openssl-dev

# Clone GoAhead from GitHub and build
WORKDIR /usr/src
git clone https://github.com/embedthis/goahead.git 
RUN cd goahead \
    && make \
    && make install \
    && mkdir -p /usr/local/goahead/bin \
    && cp build/linux-x86-default/goahead /usr/local/goahead/bin/

COPY ./web /usr/local/goahead/web

WORKDIR /usr/local/goahead

ENTRYPOINT ["/usr/local/goahead/bin/goahead"]
CMD ["-d", "/usr/local/goahead/web"]
