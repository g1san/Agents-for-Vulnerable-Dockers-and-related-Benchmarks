services:
  flink-jobmanager:
    image: apache/flink:1.11.3
    hostname: jobmanager
    ports:
      - "8081:8081"
    environment:
      - JOB_MANAGER_RPC_ADDRESS=jobmanager
    command: jobmanager

  flink-taskmanager:
    image: apache/flink:1.11.3
    depends_on:
      - flink-jobmanager
    environment:
      - JOB_MANAGER_RPC_ADDRESS=jobmanager
    command: taskmanager

  zookeeper:
    image: zookeeper:3.6.3
    ports:
      - "2181:2181"
    environment:
      ZOO_MY_ID: 1
      ZOO_SERVERS: server.1=zookeeper:2888:3888

  flink-client:
    image: openjdk:8u312-jdk
    depends_on:
      - flink-jobmanager
    volumes:
      - ./flink-scripts:/scripts
    working_dir: /scripts
    command: ["/bin/bash", "-c", "./submit-job.sh"]
    
volumes:
  flink-scripts:
    driver: local
