# Dockerfile for building Apache APISIX Dashboard from source
FROM golang:1.17 AS builder

WORKDIR /go/src/github.com/apache/apisix-dashboard

# Clone the APISIX Dashboard repository
RUN git clone https://github.com/apache/apisix-dashboard.git .

# Checkout the specific version
RUN git checkout v2.10.1

# Install Node.js
RUN curl -fsSL https://deb.nodesource.com/setup_14.x | bash - \
    && apt-get install -y nodejs

# Install Yarn using npm
RUN npm install -g yarn

# Build the dashboard
RUN make build

FROM nginx:alpine

# Copy the built dashboard
COPY --from=builder /go/src/github.com/apache/apisix-dashboard/output /usr/share/nginx/html

CMD ["nginx", "-g", "daemon off;"]
