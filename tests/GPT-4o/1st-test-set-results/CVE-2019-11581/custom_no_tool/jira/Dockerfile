FROM atlassian/jira-software:7.13.5

USER root

# Ensure the Jira configuration directory exists and has the correct permissions
RUN mkdir -p /opt/atlassian/jira/conf/Catalina/localhost \
    && chown -R jira:jira /opt/atlassian/jira/conf

# Add execution permission to the entrypoint script
RUN chmod +x /docker-entrypoint-init.d/jira-entrypoint.sh

USER jira

# Copy the entrypoint script
COPY jira-entrypoint.sh /docker-entrypoint-init.d/jira-entrypoint.sh

ENTRYPOINT ["/docker-entrypoint-init.d/jira-entrypoint.sh"]
CMD ["/entrypoint.sh", "-fg"]
