#!/usr/bin/env bash
#
# Use this script to test if a given TCP host/port are available

set -e

TIMEOUT=15

HOST="$1"
PORT="$2"
shift 2

CMD="$@"

for i in $(seq $TIMEOUT); do
  nc -z "$HOST" "$PORT" && break
  echo "Waiting for $HOST:$PORT..."
  sleep 1
  if [ "$i" -eq "$TIMEOUT" ]; then
    echo "Timeout waiting for $HOST:$PORT"
    exit 1
  fi
done

exec $CMD
