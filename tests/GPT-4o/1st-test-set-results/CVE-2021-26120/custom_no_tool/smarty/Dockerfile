FROM php:7.4-apache

RUN apt-get update && \
    apt-get install -y libzip-dev unzip && \
    docker-php-ext-install zip

# Install Smarty 3.1.38
RUN curl -L https://github.com/smarty-php/smarty/archive/v3.1.38.zip -o /tmp/smarty.zip && \
    unzip /tmp/smarty.zip -d /tmp && \
    mv /tmp/smarty-3.1.38/libs /usr/local/lib/php/Smarty && \
    rm -rf /tmp/smarty.zip /tmp/smarty-3.1.38

# Set up Apache to serve Smarty templates
COPY ./src /var/www/html
WORKDIR /var/www/html

RUN chown -R www-data:www-data /var/www/html && \
    a2enmod rewrite

EXPOSE 80
CMD ["apache2-foreground"]
