#!/bin/bash

# Wait for MySQL to be ready
until mysqladmin ping -h mysql -u cactiuser -pcactipass --silent; do
    echo "Waiting for MySQL..."
    sleep 2
done

# Initialize Cacti configuration if not already done
if [ ! -f /var/www/html/include/config.php ]; then
    cat <<EOL > /var/www/html/include/config.php
<?php
\$database_type = 'mysql';
\$database_default = 'cacti';
\$database_hostname = 'mysql';
\$database_username = 'cactiuser';
\$database_password = 'cactipass';
\$database_port = '3306';
\$database_ssl = false;
?>
EOL
fi

# Start Apache
exec apache2-foreground