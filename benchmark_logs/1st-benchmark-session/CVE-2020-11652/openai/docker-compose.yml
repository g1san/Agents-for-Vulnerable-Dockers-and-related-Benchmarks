version: '3.7'
services:
  salt-master:
    build: ./salt-master
    ports:
      - "4505:4505"
      - "4506:4506"
    volumes:
      - salt-master-data:/var/cache/salt
    networks:
      salt-network:
        aliases:
          - salt-master
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    healthcheck:
      test: ["CMD", "pgrep", "-f", "salt-master"]
      interval: 30s
      timeout: 10s
      retries: 5

  salt-minion:
    build: ./salt-minion
    depends_on:
      salt-master:
        condition: service_healthy
    networks:
      salt-network:
        aliases:
          - salt-minion
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    healthcheck:
      test: ["CMD", "pgrep", "-f", "salt-minion"]
      interval: 30s
      timeout: 10s
      retries: 5

volumes:
  salt-master-data:

networks:
  salt-network:
    driver: bridge
