FROM jenkins/jenkins:2.441-slim

# Disable the setup wizard so Jenkins is immediately usable
ENV JAVA_OPTS="-Djenkins.install.runSetupWizard=false"

USER root
# Add a readable test file inside the controller filesystem to demonstrate file read
RUN mkdir -p /var/jenkins_home/loot \
    && echo "CVE-2024-23897 test secret: if you can read this via CLI, arbitrary file read works." > /var/jenkins_home/loot/secret.txt \
    && chown -R jenkins:jenkins /var/jenkins_home/loot

# Seed an init script that keeps Jenkins unsecured (no auth), ensuring immediate exploitability
COPY --chown=jenkins:jenkins scripts/init.groovy.d/01-unsecured.groovy /usr/share/jenkins/ref/init.groovy.d/01-unsecured.groovy

USER jenkins
