version: "3.8"

services:
  salt-master:
    build:
      context: ./master
      dockerfile: Dockerfile
    image: cve-2020-11651/salt-master:3000.1
    container_name: cve-2020-11651-master
    entrypoint: []
    command: ["/usr/bin/salt-master", "-l", "info"]
    ports:
      - "4505:4505"
      - "4506:4506"
    volumes:
      - master-pki:/etc/salt/pki
      - master-cache:/var/cache/salt
    restart: unless-stopped

  salt-minion:
    build:
      context: ./minion
      dockerfile: Dockerfile
    image: cve-2020-11651/salt-minion:3000.1
    container_name: cve-2020-11651-minion
    depends_on:
      - salt-master
    entrypoint: []
    command: ["/usr/bin/salt-minion", "-l", "info"]
    volumes:
      - minion-pki:/etc/salt/pki
      - minion-cache:/var/cache/salt
    restart: unless-stopped

volumes:
  master-pki:
  master-cache:
  minion-pki:
  minion-cache:
