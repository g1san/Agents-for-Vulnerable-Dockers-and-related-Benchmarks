{
    "file_name": [
        "compose.yaml",
        "Dockerfile",
        "entrypoint.sh",
        "config/smtpd.conf",
        "config/aliases"
    ],
    "file_code": [
        "services:\n  opensmtpd:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    image: instrumentisto/opensmtpd:6.6.1\n    container_name: cve-2020-7247-opensmtpd\n    ports:\n      - \"2525:25/tcp\"\n    volumes:\n      - ./config/smtpd.conf:/etc/opensmtpd/smtpd.conf:ro\n      - ./config/aliases:/etc/opensmtpd/aliases:ro\n    restart: unless-stopped\n",
        "## Multi-stage build to produce OpenSMTPD 6.6.1p1 locally\nFROM debian:bullseye AS build\n\nENV DEBIAN_FRONTEND=noninteractive \\\n    OSMTPD_VER=6.6.1p1\n\nRUN apt-get update \\\n && apt-get install -y --no-install-recommends \\\n    ca-certificates curl build-essential pkg-config \\\n    libevent-dev libssl-dev libbsd-dev zlib1g-dev \\\n    bison flex automake autoconf libtool \\\n && rm -rf /var/lib/apt/lists/*\n\n# Fetch and build OpenSMTPD portable 6.6.1p1\nRUN curl -fsSL https://www.opensmtpd.org/archives/opensmtpd-${OSMTPD_VER}.tar.gz -o /tmp/opensmtpd.tar.gz \\\n && mkdir -p /usr/src/opensmtpd \\\n && tar -xzf /tmp/opensmtpd.tar.gz -C /usr/src/opensmtpd --strip-components=1\n\nWORKDIR /usr/src/opensmtpd\nRUN ./configure --prefix=/usr --sysconfdir=/etc/opensmtpd \\\n && make -j\"$(nproc)\" \\\n && make install\n\n# Runtime image\nFROM debian:bullseye-slim AS runtime\n\nENV DEBIAN_FRONTEND=noninteractive\n\nRUN groupadd -r _smtpd \\\n && useradd -r -g _smtpd -d /var/empty -s /usr/sbin/nologin _smtpd \\\n && groupadd -r _smtpq \\\n && useradd -r -g _smtpq -d /var/empty -s /usr/sbin/nologin _smtpq \\\n && apt-get update \\\n && apt-get install -y --no-install-recommends \\\n      libevent-2.1-7 libssl1.1 libbsd0 ca-certificates tzdata \\\n && rm -rf /var/lib/apt/lists/*\n\n# Binaries and support files\nCOPY --from=build /usr/sbin/smtpd /usr/sbin/smtpd\nCOPY --from=build /usr/bin/smtpctl /usr/bin/smtpctl\nCOPY --from=build /usr/libexec/ /usr/libexec/\nCOPY --from=build /usr/share/opensmtpd/ /usr/share/opensmtpd/\n\n# Entrypoint\nCOPY entrypoint.sh /entrypoint.sh\nRUN chmod +x /entrypoint.sh \\\n && mkdir -p /etc/opensmtpd /var/spool/smtpd /var/run/smtpd \\\n && chown -R _smtpd:_smtpd /var/spool/smtpd /var/run/smtpd\n\nEXPOSE 25/tcp\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"-d\", \"-f\", \"/etc/opensmtpd/smtpd.conf\"]\n",
        "#!/bin/sh\nset -e\n\n# Ensure runtime directories exist with correct ownership\nmkdir -p /var/spool/smtpd /var/run/smtpd\nchown -R _smtpd:_smtpd /var/spool/smtpd /var/run/smtpd\n\n# Start OpenSMTPD in foreground using passed arguments\nexec /usr/sbin/smtpd \"$@\"\n",
        "# OpenSMTPD 6.6.x minimal config for local delivery\n\n# Aliases table\ntable aliases file:/etc/opensmtpd/aliases\n\n# Listen on all interfaces\nlisten on 0.0.0.0\n\n# Deliver to system mbox for local users (e.g., root)\naction \"local\" mbox alias <aliases>\n\n# Accept mail for local domains from any source\nmatch from any for local action \"local\"\n",
        "# Minimal aliases file\nroot: root\n"
    ],
    "directory_tree": "./../../dockers/CVE-2020-7247/custom_no_tool\n\u251c\u2500\u2500 compose.yaml\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 entrypoint.sh\n\u2514\u2500\u2500 config\n    \u251c\u2500\u2500 smtpd.conf\n    \u2514\u2500\u2500 aliases\n"
}