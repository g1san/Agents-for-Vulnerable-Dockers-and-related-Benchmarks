web/Dockerfile
FROM php:5.4-apache

# Stabilize apt on EOL Debian bases and install required tools
RUN set -eux; \
    if [ -f /etc/apt/sources.list ]; then \
      sed -ri 's|deb.debian.org|archive.debian.org|g; s|security.debian.org|archive.debian.org|g' /etc/apt/sources.list || true; \
      printf 'Acquire::Check-Valid-Until "false";\n' > /etc/apt/apt.conf.d/99no-check-valid || true; \
    fi; \
    apt-get -o Acquire::Check-Valid-Until=false update; \
    apt-get install -y --no-install-recommends ca-certificates curl unzip; \
    rm -rf /var/lib/apt/lists/*

# Build and enable required PHP extensions for phpMyAdmin 4.4.x
RUN set -eux; \
    apt-get -o Acquire::Check-Valid-Until=false update; \
    apt-get install -y --no-install-recommends $PHPIZE_DEPS; \
    docker-php-ext-install mysqli mbstring; \
    apt-get purge -y --auto-remove $PHPIZE_DEPS; \
    rm -rf /var/lib/apt/lists/*

# Download and install vulnerable phpMyAdmin version 4.4.15.6
ENV PHPMYADMIN_VERSION=4.4.15.6
RUN set -eux; \
    curl -fsSL -o /tmp/pma.zip \
      https://files.phpmyadmin.net/phpMyAdmin/${PHPMYADMIN_VERSION}/phpMyAdmin-${PHPMYADMIN_VERSION}-all-languages.zip; \
    unzip -q /tmp/pma.zip -d /var/www/html/; \
    mv /var/www/html/phpMyAdmin-${PHPMYADMIN_VERSION}-all-languages /var/www/html/phpmyadmin; \
    rm -f /tmp/pma.zip; \
    chown -R www-data:www-data /var/www/html/phpmyadmin

# Add phpMyAdmin configuration
COPY config.inc.php /var/www/html/phpmyadmin/config.inc.php

# Convenience index to reach phpMyAdmin quickly
COPY index.php /var/www/html/index.php
