{
    "files": [
        {
            "location": "./../../dockers/CVE-2020-7247/custom_no_tool/docker-compose.yml",
            "content": "services:\n  opensmtpd:\n    build:\n      context: ./smtpd\n      dockerfile: Dockerfile\n    image: instrumentisto/opensmtpd:6.6\n    container_name: cve-2020-7247-opensmtpd\n    ports:\n      - \"25:25\"\n    volumes:\n      - ./smtpd/smtpd.conf:/etc/smtpd/smtpd.conf:ro\n      - ./smtpd/aliases:/etc/smtpd/aliases:ro\n    restart: unless-stopped\n"
        },
        {
            "location": "./../../dockers/CVE-2020-7247/custom_no_tool/smtpd/Dockerfile",
            "content": "# Local build providing OpenSMTPD 6.6.x from Alpine 3.11 packages\nFROM alpine:3.11\n\n# Use Alpine 3.11 repositories that contain OpenSMTPD 6.6.x\nRUN echo \"https://dl-cdn.alpinelinux.org/alpine/v3.11/main\" > /etc/apk/repositories \\\n && echo \"https://dl-cdn.alpinelinux.org/alpine/v3.11/community\" >> /etc/apk/repositories \\\n && apk add --no-cache \\\n      opensmtpd=6.6.4p1-r1 \\\n      ca-certificates \\\n      tzdata \\\n      bash \\\n && update-ca-certificates\n\n# Ensure configuration directory exists; config will be bind-mounted\nRUN mkdir -p /etc/smtpd \\\n    && mkdir -p /var/spool/smtpd \\\n    && mkdir -p /var/mail\n\n# Copy entrypoint\nCOPY docker-entrypoint.sh /usr/local/bin/docker-entrypoint.sh\nRUN chmod +x /usr/local/bin/docker-entrypoint.sh\n\nEXPOSE 25/tcp\n\nENTRYPOINT [\"/usr/local/bin/docker-entrypoint.sh\"]\nCMD [\"/usr/sbin/smtpd\", \"-d\", \"-f\", \"/etc/smtpd/smtpd.conf\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2020-7247/custom_no_tool/smtpd/docker-entrypoint.sh",
            "content": "#!/usr/bin/env sh\nset -e\n\n# Prepare runtime dirs\nmkdir -p /var/mail /var/spool/smtpd /run/smtpd\nchmod 755 /run/smtpd || true\n\n# Ensure root's mbox exists for alias delivery (postmaster -> root)\nif [ ! -f /var/mail/root ]; then\n  touch /var/mail/root\nfi\nchmod 600 /var/mail/root || true\nchown root:root /var/mail/root || true\n\n# Initialize OpenSMTPD spool with required permissions and structure\n# Top-level spool must be 711 and owned by root\nchmod 711 /var/spool/smtpd || true\nchown root:root /var/spool/smtpd || true\n\n# Create expected subdirectories\nmkdir -p /var/spool/smtpd/offline \\\n         /var/spool/smtpd/purge \\\n         /var/spool/smtpd/queue \\\n         /var/spool/smtpd/temporary\n\n# Set strict perms and ownership as required by OpenSMTPD 6.6.4p1 on Alpine 3.11\n# Subdirs must be 700, owned by uid 101 (smtpd) and gid 0 (root)\nfor d in offline purge queue temporary; do\n  chmod 700 \"/var/spool/smtpd/$d\" || true\n  chown 101:0 \"/var/spool/smtpd/$d\" || true\ndone\n\n# Ensure config files exist (they will be mounted read-only by compose)\nif [ ! -f /etc/smtpd/smtpd.conf ]; then\n  echo \"Error: /etc/smtpd/smtpd.conf not found (volume not mounted?)\" >&2\n  exit 1\nfi\nif [ ! -f /etc/smtpd/aliases ]; then\n  echo \"Warning: /etc/smtpd/aliases not found; proceeding without aliases\" >&2\nfi\n\n# Execute smtpd in foreground with provided args\nexec \"$@\"\n"
        },
        {
            "location": "./../../dockers/CVE-2020-7247/custom_no_tool/smtpd/smtpd.conf",
            "content": "# Minimal OpenSMTPD configuration using 6.6+ grammar (match/action)\n# Local aliases table\ntable aliases file:/etc/smtpd/aliases\n\n# Listen on all interfaces on the default SMTP port\nlisten on 0.0.0.0 port 25\n\n# Define local delivery action with alias expansion to the aliases table\naction \"local_mbox\" mbox alias <aliases>\n\n# Accept from anywhere and deliver to local users' mbox files\nmatch from any for local action \"local_mbox\"\n\n# Additionally accept mail for the example domain to facilitate testing\nmatch from any for domain \"test.local\" action \"local_mbox\"\n"
        },
        {
            "location": "./../../dockers/CVE-2020-7247/custom_no_tool/smtpd/aliases",
            "content": "# Basic aliases for local delivery tests\n# These are read directly from the file backend in this setup\npostmaster: root\nroot: postmaster\n"
        }
    ],
    "directory_tree": "./../../dockers/CVE-2020-7247/custom_no_tool\n\u2514\u2500\u2500 docker-compose.yml\n\u2514\u2500\u2500 smtpd\n    \u251c\u2500\u2500 Dockerfile\n    \u251c\u2500\u2500 docker-entrypoint.sh\n    \u251c\u2500\u2500 smtpd.conf\n    \u2514\u2500\u2500 aliases"
}