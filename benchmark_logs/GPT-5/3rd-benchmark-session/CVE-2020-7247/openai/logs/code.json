{
    "files": [
        {
            "location": "./../../dockers/CVE-2020-7247/openai/docker-compose.yml",
            "content": "services:\n  opensmtpd:\n    build: ./smtpd\n    container_name: cve-2020-7247-opensmtpd\n    ports:\n      - \"25:25\"\n    restart: unless-stopped\n"
        },
        {
            "location": "./../../dockers/CVE-2020-7247/openai/smtpd/Dockerfile",
            "content": "FROM debian:10-slim\n\nENV DEBIAN_FRONTEND=noninteractive \\\n    OSMTPD_VER=6.6.1p1 \\\n    OSMTPD_URL=https://www.opensmtpd.org/archives/opensmtpd-6.6.1p1.tar.gz\n\n# Point APT to archived repositories for Debian Buster and relax validity checks\nRUN sed -i \\\n      -e 's|deb.debian.org/debian|archive.debian.org/debian|g' \\\n      -e 's|security.debian.org/debian-security|archive.debian.org/debian-security|g' \\\n      -e 's|deb.debian.org/debian-security|archive.debian.org/debian-security|g' \\\n      /etc/apt/sources.list \\\n && printf 'Acquire::Check-Valid-Until \"false\";\\nAcquire::AllowInsecureRepositories \"true\";\\n' > /etc/apt/apt.conf.d/99no-check-valid-until\n\n# Build and runtime dependencies\nRUN apt-get update \\\n && apt-get install -y --no-install-recommends \\\n    build-essential \\\n    libssl-dev \\\n    libevent-dev \\\n    zlib1g-dev \\\n    libbsd-dev \\\n    libasr-dev \\\n    pkg-config \\\n    curl \\\n    ca-certificates \\\n    openssl \\\n    ssl-cert \\\n    # parser generator needed by build\n    bison \\\n    # optional but commonly paired with bison\n    flex \\\n    # autotools (kept harmlessly; not strictly needed for release tarballs)\n    autoconf \\\n    automake \\\n    libtool \\\n    m4 \\\n    # runtime libs to keep \\\n    libevent-2.1-6 \\\n    libssl1.1 \\\n    libasr0 \\\n    zlib1g \\\n && rm -rf /var/lib/apt/lists/*\n\n# Fetch, build and install OpenSMTPD portable from official archives (release tarball includes configure)\nRUN set -eux; \\\n    curl -fL \"$OSMTPD_URL\" -o /tmp/opensmtpd.tar.gz; \\\n    mkdir -p /tmp/opensmtpd; \\\n    tar -xzf /tmp/opensmtpd.tar.gz -C /tmp/opensmtpd --strip-components=0; \\\n    cd \"/tmp/opensmtpd/opensmtpd-${OSMTPD_VER}\"; \\\n    ./configure --prefix=/usr --sysconfdir=/etc --with-ssl=openssl; \\\n    make -j\"$(nproc)\"; \\\n    make install; \\\n    cd /; \\\n    rm -rf /tmp/opensmtpd /tmp/opensmtpd.tar.gz\n\n# Create required users/groups and spool directories\nRUN addgroup --system _smtpd || true \\\n && adduser --system --ingroup _smtpd --no-create-home _smtpd || true \\\n && addgroup --system _smtpq || true \\\n && adduser --system --ingroup _smtpq --no-create-home _smtpq || true \\\n && mkdir -p /var/spool/smtpd /var/spool/mail /run/smtpd \\\n && chown -R _smtpd:_smtpd /var/spool/smtpd \\\n && chmod 1733 /var/spool/mail\n\n# Provide minimal aliases to avoid alias resolution issues\nRUN printf \"root: root\\n\" > /etc/aliases\n\nCOPY smtpd.conf /etc/smtpd.conf\nCOPY entrypoint.sh /entrypoint.sh\nRUN chmod +x /entrypoint.sh\n\nEXPOSE 25\n\nCMD [\"/entrypoint.sh\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2020-7247/openai/smtpd/smtpd.conf",
            "content": "# Minimal OpenSMTPD configuration listening on all interfaces\n# Deliver locally to mbox (default /var/mail/<user>)\n\npki localhost cert \"/etc/ssl/certs/ssl-cert-snakeoil.pem\"\npki localhost key  \"/etc/ssl/private/ssl-cert-snakeoil.key\"\n\nlisten on 0.0.0.0 port 25\n\naction \"local_mbox\" mbox\nmatch from any for local action \"local_mbox\"\n"
        },
        {
            "location": "./../../dockers/CVE-2020-7247/openai/smtpd/entrypoint.sh",
            "content": "#!/bin/sh\nset -e\n\n# Ensure runtime directories exist\nmkdir -p /run/smtpd /var/spool/mail\nchmod 1733 /var/spool/mail\n\n# Create a non-privileged local user for testing delivery (optional)\nif ! id tester >/dev/null 2>&1; then\n  adduser --disabled-password --gecos \"Test User\" tester || true\nfi\n\n# Generate snakeoil certs if missing (TLS not required, but config references them)\nif [ ! -f /etc/ssl/certs/ssl-cert-snakeoil.pem ] || [ ! -f /etc/ssl/private/ssl-cert-snakeoil.key ]; then\n  mkdir -p /etc/ssl/private\n  openssl req -x509 -nodes -newkey rsa:2048 -days 3650 \\\n    -subj \"/CN=localhost\" \\\n    -keyout /etc/ssl/private/ssl-cert-snakeoil.key \\\n    -out /etc/ssl/certs/ssl-cert-snakeoil.pem >/dev/null 2>&1 || true\n  chmod 600 /etc/ssl/private/ssl-cert-snakeoil.key\nfi\n\n# Initialize aliases (no-op if already present)\nnewaliases >/dev/null 2>&1 || true\n\n# Run OpenSMTPD in foreground\nexec /usr/sbin/smtpd -f /etc/smtpd.conf -n -d\n"
        }
    ],
    "directory_tree": "./../../dockers/CVE-2020-7247/openai\n\u2514\u2500\u2500 docker-compose.yml\n\u2514\u2500\u2500 smtpd\n    \u251c\u2500\u2500 Dockerfile\n    \u251c\u2500\u2500 entrypoint.sh\n    \u2514\u2500\u2500 smtpd.conf\n"
}