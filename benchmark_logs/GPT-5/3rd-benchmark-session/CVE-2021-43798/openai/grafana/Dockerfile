FROM grafana/grafana:8.3.0

# Become root to perform privileged operations
USER root

# Provide a deterministic file on the filesystem that can be read via the traversal bug
RUN echo 'CVE-2021-43798 test file: if you can read this via /public/plugins/<plugin-id>/../../../../../../etc/vulnproof.txt then the instance is vulnerable.' \
    > /etc/vulnproof.txt \
    && chmod 0644 /etc/vulnproof.txt

# Replace the default Grafana config to enable anonymous access for easy testing
COPY conf/grafana.ini /etc/grafana/grafana.ini

# Return to the default grafana user for runtime
USER grafana
