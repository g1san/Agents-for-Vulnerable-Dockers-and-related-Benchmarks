FROM saltstack/salt:2019.2.3

# Configure the vulnerable salt-master
COPY etc/salt/master /etc/salt/master

# Provide some directories and demo data
RUN mkdir -p /srv/salt /secrets \
    && echo "super-secret-token = 9f9f2a2d-2a10-4fa9-bb2c-6e0d2c9d1abc" > /secrets/secret.txt \
    && chmod 600 /secrets/secret.txt \
    && mkdir -p /var/cache/salt/master /var/log/salt /var/run/salt \
    && touch /var/log/salt/master

EXPOSE 4505 4506

# Run the salt-master with info logging for visibility
CMD ["salt-master", "-l", "info"]
