FROM saltstack/salt:2019.2.3

# Create a local OS user for PAM external_auth to allow authenticated access
# to wheel/runner functions over the ZeroMQ ClearFuncs path.
# Use adduser since the base image does not provide useradd.
RUN adduser -D -s /bin/ash saltuser \
 && echo 'saltuser:saltpass' | chpasswd

# Ensure standard locations exist
RUN mkdir -p /srv/salt /etc/salt

# Default config in image (compose also binds the same file at runtime)
COPY master.conf /etc/salt/master

# Expose the master ports (publisher 4505, request server 4506)
EXPOSE 4505 4506
