FROM saltstack/salt:3000.1

# Copy Salt master configuration
COPY config/master /etc/salt/master

# Ensure required directories exist
RUN mkdir -p /srv/salt /etc/salt/pki/master /var/log/salt /var/cache/salt /var/run/salt \
    && chown -R root:root /etc/salt /srv/salt /var/log/salt /var/cache/salt /var/run/salt

EXPOSE 4505 4506

# Use exec-form ENTRYPOINT/CMD to avoid shell interpretation issues
ENTRYPOINT ["salt-master"]
CMD ["-l", "info", "-u", "root"]
