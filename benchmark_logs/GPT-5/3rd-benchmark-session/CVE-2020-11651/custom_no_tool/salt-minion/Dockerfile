FROM saltstack/salt:3000.1

# Copy Salt minion configuration
COPY config/minion /etc/salt/minion

# Startup script to set master host and run the minion
COPY start-minion.sh /usr/local/bin/start-minion.sh
RUN chmod +x /usr/local/bin/start-minion.sh \
    && mkdir -p /var/log/salt /var/cache/salt /var/run/salt \
    && chown -R root:root /etc/salt /var/log/salt /var/cache/salt /var/run/salt

# Use exec-form ENTRYPOINT to avoid shell entrypoint conflicts
ENTRYPOINT ["/usr/local/bin/start-minion.sh"]
