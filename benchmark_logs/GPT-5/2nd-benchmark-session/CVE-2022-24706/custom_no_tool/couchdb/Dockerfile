FROM couchdb:3.2.1

USER root

# Provide permissive HTTP bind and ensure Erlang distribution settings and cookie
COPY local.ini /opt/couchdb/etc/local.d/local.ini
COPY vm.args /opt/couchdb/etc/erlang/vm.args

# Set the Erlang cookie to the historically default, predictable value
RUN echo -n "monster" > /opt/couchdb/.erlang.cookie \
    && chown couchdb:couchdb /opt/couchdb/.erlang.cookie \
    && chmod 400 /opt/couchdb/.erlang.cookie \
    && chown -R couchdb:couchdb /opt/couchdb/etc

EXPOSE 5984 4369 9100

USER couchdb
