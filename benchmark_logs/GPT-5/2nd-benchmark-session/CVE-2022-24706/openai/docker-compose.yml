version: "3.8"
services:
  couchdb:
    image: couchdb:3.2.1
    container_name: cve-2022-24706-couchdb
    restart: unless-stopped
    environment:
      # Pin Erlang distribution to a fixed port used by the official image
      - ERL_FLAGS=-kernel inet_dist_listen_min 9100 inet_dist_listen_max 9100
      # Admin user required since CouchDB 3.x disables Admin Party by default
      - COUCHDB_USER=admin
      - COUCHDB_PASSWORD=admin
      # Do NOT set any custom Erlang cookie; default vulnerable cookie remains
    ports:
      - "5984:5984"   # CouchDB HTTP API
      - "4369:4369"   # epmd
      - "9100:9100"   # Erlang distribution listener
    volumes:
      - couchdb-data:/opt/couchdb/data
volumes:
  couchdb-data:
