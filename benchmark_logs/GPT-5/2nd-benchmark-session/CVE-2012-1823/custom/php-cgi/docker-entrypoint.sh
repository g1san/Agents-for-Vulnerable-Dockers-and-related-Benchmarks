#!/bin/sh
set -e

# Export the php-cgi binary into the shared volume for Apache to invoke.
mkdir -p /opt/php-cgi

# Try a few common locations to find the built php-cgi
PHP_CGI_PATH=""
for p in \
  "/usr/local/bin/php-cgi" \
  "/usr/local/php-5.4.1/bin/php-cgi" \
  "$(command -v php-cgi 2>/dev/null || true)" \
; do
  if [ -n "$p" ] && [ -x "$p" ]; then
    PHP_CGI_PATH="$p"
    break
  fi
done

if [ -z "$PHP_CGI_PATH" ]; then
  echo "php-cgi binary not found" >&2
  exit 1
fi

cp -f "$PHP_CGI_PATH" /opt/php-cgi/php-cgi
chmod +x /opt/php-cgi/php-cgi

echo "[php-cgi-exporter] Ready. php-cgi at /opt/php-cgi/php-cgi"

# Keep the container running to keep the shared volume available
exec tail -f /dev/null
