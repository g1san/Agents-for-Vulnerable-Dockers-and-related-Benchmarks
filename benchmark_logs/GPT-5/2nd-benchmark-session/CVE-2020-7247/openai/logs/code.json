{
    "file_name": [
        "./../../dockers/CVE-2020-7247/openai/docker-compose.yml",
        "./../../dockers/CVE-2020-7247/openai/opensmtpd/Dockerfile",
        "./../../dockers/CVE-2020-7247/openai/opensmtpd/entrypoint.sh",
        "./../../dockers/CVE-2020-7247/openai/opensmtpd/smtpd.conf"
    ],
    "file_code": [
        "services:\n  opensmtpd:\n    build:\n      context: ./opensmtpd\n    image: cve-2020-7247/opensmtpd:6.6.1p1\n    container_name: cve-2020-7247-opensmtpd\n    ports:\n      - \"25:25\"\n    restart: unless-stopped\n    tty: true\n    networks:\n      - cve20207247\n\nnetworks:\n  cve20207247:\n    driver: bridge\n",
        "FROM debian:10-slim\n\nENV DEBIAN_FRONTEND=noninteractive \\\n    OSMTPD_VERSION=6.6.1p1 \\\n    OSMTPD_URL=https://www.opensmtpd.org/archives/opensmtpd-6.6.1p1.tar.gz\n\n# Use Debian Buster archive repositories and disable Valid-Until checks\nRUN printf 'deb http://archive.debian.org/debian buster main contrib non-free\\n' > /etc/apt/sources.list \\\n && printf 'deb http://archive.debian.org/debian buster-updates main contrib non-free\\n' >> /etc/apt/sources.list \\\n && printf 'deb http://archive.debian.org/debian-security buster/updates main contrib non-free\\n' >> /etc/apt/sources.list \\\n && printf 'Acquire::Check-Valid-Until \"false\";\\nAcquire::Languages \"none\";\\n' > /etc/apt/apt.conf.d/99no-check-valid-until\n\n# Base packages and full build toolchain for OpenSMTPD portable\nRUN apt-get update \\\n && apt-get install -y --no-install-recommends \\\n    ca-certificates curl gnupg dirmngr \\\n    build-essential pkg-config \\\n    autoconf automake libtool m4 \\\n    libevent-dev libssl-dev zlib1g-dev \\\n    libbsd-dev libedit-dev \\\n    libasr-dev \\\n    bison flex \\\n && rm -rf /var/lib/apt/lists/*\n\n# Create required system users and directories with correct ownership/permissions\n# Force _smtpd UID to 997 to satisfy queue backend check; keep queue GID as 0 (root)\nRUN groupadd --system _smtpd \\\n && useradd --system --no-create-home --uid 997 --gid _smtpd _smtpd \\\n && groupadd --system _smtpq \\\n && useradd --system --no-create-home --gid _smtpq _smtpq \\\n && mkdir -p /var/spool/smtpd/queue /var/spool/smtpd/offline /var/empty /var/run/smtpd \\\n && chown root:root /var/spool/smtpd \\\n && chmod 711 /var/spool/smtpd \\\n && chown -R 997:0 /var/spool/smtpd/queue \\\n && chmod 700 /var/spool/smtpd/queue \\\n && chown root:_smtpq /var/spool/smtpd/offline \\\n && chmod 770 /var/spool/smtpd/offline \\\n && chmod 755 /var/empty \\\n && chmod 755 /var/run/smtpd\n\n# Build and install OpenSMTPD portable 6.6.1p1 (vulnerable)\nWORKDIR /tmp/build\nRUN set -eux; \\\n    curl -fsSL \"$OSMTPD_URL\" -o opensmtpd.tar.gz; \\\n    tar xzf opensmtpd.tar.gz; \\\n    cd OpenSMTPD-portable-* || cd opensmtpd-*; \\\n    ./bootstrap; \\\n    ./configure --prefix=/usr/local; \\\n    make -j\"$(nproc)\"; \\\n    make install; \\\n    ldconfig; \\\n    test -x /usr/local/sbin/smtpd; \\\n    strip /usr/local/sbin/smtpd || true; \\\n    cd /; \\\n    rm -rf /tmp/build\n\n# Configuration\nCOPY smtpd.conf /usr/local/etc/smtpd.conf\nCOPY entrypoint.sh /entrypoint.sh\nRUN chmod +x /entrypoint.sh\n\nEXPOSE 25/tcp\n\nENTRYPOINT [\"/entrypoint.sh\"]\n",
        "#!/usr/bin/env bash\nset -euo pipefail\n\n# Ensure required runtime directories and correct ownership/permissions\nmkdir -p /var/spool/smtpd/queue /var/spool/smtpd/offline /var/empty /var/run/smtpd\nchown root:root /var/spool/smtpd\nchmod 711 /var/spool/smtpd\n# Queue must be uid 997 and gid 0 (root)\nchown -R 997:0 /var/spool/smtpd/queue\nchmod 700 /var/spool/smtpd/queue\nchown root:_smtpq /var/spool/smtpd/offline\nchmod 770 /var/spool/smtpd/offline\nchmod 755 /var/empty\nchmod 755 /var/run/smtpd\n\n# Remove stale sockets and pid files; stop any orphaned smtpd from previous crashes\npkill -x smtpd >/dev/null 2>&1 || true\nrm -f /var/run/smtpd/* /var/run/smtpd.sock /var/run/smtpd.pid >/dev/null 2>&1 || true\n\n# Show version for verification\n/usr/local/sbin/smtpd -v || true\n\n# Run OpenSMTPD in foreground with provided config\nexec /usr/local/sbin/smtpd -d -f /usr/local/etc/smtpd.conf\n",
        "listen on 0.0.0.0 port 25\n\naction \"relayall\" relay\nmatch from any for any action \"relayall\"\n"
    ],
    "directory_tree": "./../../dockers/CVE-2020-7247/openai\n\u2514\u2500\u2500 opensmtpd\n    \u251c\u2500\u2500 Dockerfile\n    \u251c\u2500\u2500 entrypoint.sh\n    \u251c\u2500\u2500 smtpd.conf\n\u2514\u2500\u2500 docker-compose.yml"
}