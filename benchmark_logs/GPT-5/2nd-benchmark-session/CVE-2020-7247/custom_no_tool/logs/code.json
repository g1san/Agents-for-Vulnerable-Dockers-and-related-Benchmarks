{
    "file_name": [
        "./../../dockers/CVE-2020-7247/custom_no_tool/docker-compose.yml",
        "./../../dockers/CVE-2020-7247/custom_no_tool/Dockerfile",
        "./../../dockers/CVE-2020-7247/custom_no_tool/entrypoint.sh",
        "./../../dockers/CVE-2020-7247/custom_no_tool/smtpd.conf"
    ],
    "file_code": [
        "services:\n  opensmtpd:\n    image: instrumentisto/opensmtpd:6.6.1\n    build: .\n    ports:\n      - \"25:25\"\n    restart: unless-stopped\n",
        "FROM debian:11-slim\n\nENV DEBIAN_FRONTEND=noninteractive \\\n    OPENSMTPD_VERSION=6.6.1p1 \\\n    LIBASR_VERSION=1.0.4\n\n# Build and runtime dependencies\nRUN apt-get update \\\n && apt-get install -y --no-install-recommends \\\n      ca-certificates curl build-essential \\\n      libssl-dev libevent-dev zlib1g-dev pkg-config \\\n      bison flex \\\n && rm -rf /var/lib/apt/lists/*\n\n# Create required system users and groups\nRUN groupadd -r _smtpd && useradd -r -g _smtpd -d /var/empty -s /usr/sbin/nologin _smtpd \\\n && groupadd -r _smtpq && useradd -r -g _smtpq -d /var/empty -s /usr/sbin/nologin _smtpq\n\n# Ensure chroot base exists\nRUN mkdir -p /var/empty && chmod 755 /var/empty && chown root:root /var/empty\n\n# Build and install libasr (not available as a Debian package)\nRUN set -eux; \\\n    curl -fsSL -o /tmp/libasr.tar.gz \\\n      https://www.opensmtpd.org/archives/libasr-${LIBASR_VERSION}.tar.gz; \\\n    mkdir -p /usr/src/libasr; \\\n    tar -xzf /tmp/libasr.tar.gz -C /usr/src/libasr --strip-components=1; \\\n    cd /usr/src/libasr; \\\n    ./configure; \\\n    make -j\"$(nproc)\"; \\\n    make install; \\\n    ldconfig; \\\n    rm -rf /usr/src/libasr /tmp/libasr.tar.gz\n\n# Build OpenSMTPD portable 6.6.1p1\nRUN set -eux; \\\n    curl -fsSL -o /tmp/opensmtpd.tar.gz \\\n      https://www.opensmtpd.org/archives/opensmtpd-${OPENSMTPD_VERSION}.tar.gz; \\\n    mkdir -p /usr/src/opensmtpd; \\\n    tar -xzf /tmp/opensmtpd.tar.gz -C /usr/src/opensmtpd --strip-components=1; \\\n    cd /usr/src/opensmtpd; \\\n    CFLAGS=\"-O2 -pipe -fcommon\" ./configure \\\n      --with-path-queue=/var/spool/smtpd/queue \\\n      --with-path-run=/var/run/smtpd; \\\n    make -j\"$(nproc)\"; \\\n    make install-strip; \\\n    rm -rf /usr/src/opensmtpd /tmp/opensmtpd.tar.gz\n\n# Config\nCOPY smtpd.conf /usr/local/etc/smtpd/smtpd.conf\nCOPY entrypoint.sh /usr/local/bin/entrypoint.sh\nRUN chmod +x /usr/local/bin/entrypoint.sh\n\nEXPOSE 25\n\nENTRYPOINT [\"/usr/local/bin/entrypoint.sh\"]\n",
        "#!/bin/sh\nset -eu\n\n# Ensure chroot base exists for smtpd subprocesses (ca, control, pony, scheduler)\nmkdir -p /var/empty\nchmod 755 /var/empty\nchown root:root /var/empty\n\n# Ensure spool hierarchy exists\nmkdir -p \\\n  /var/spool/smtpd/queue \\\n  /var/spool/smtpd/offline \\\n  /var/spool/smtpd/purge \\\n  /var/spool/smtpd/corrupt \\\n  /var/spool/smtpd/incoming \\\n  /var/spool/smtpd/tmp\n\n# Queue directory must be owned by root and mode 711\nchown root:root /var/spool/smtpd/queue\nchmod 711 /var/spool/smtpd/queue\n\n# Other spool subdirs owned by _smtpq with restrictive perms\nchown -R _smtpq:_smtpq \\\n  /var/spool/smtpd/offline \\\n  /var/spool/smtpd/purge \\\n  /var/spool/smtpd/corrupt \\\n  /var/spool/smtpd/incoming \\\n  /var/spool/smtpd/tmp || true\nchmod 700 \\\n  /var/spool/smtpd/offline \\\n  /var/spool/smtpd/purge \\\n  /var/spool/smtpd/corrupt \\\n  /var/spool/smtpd/incoming \\\n  /var/spool/smtpd/tmp || true\n\n# Runtime directory for control socket\nmkdir -p /var/run/smtpd\nchown -R _smtpd:_smtpd /var/run/smtpd || true\n\n# Start OpenSMTPD in foreground with provided config\nexec /usr/local/sbin/smtpd -d -f /usr/local/etc/smtpd/smtpd.conf\n",
        "listen on 0.0.0.0\n\n# Minimal local delivery action\naction \"local\" mbox\n\n# Accept mail from anywhere for any recipient and deliver to local mbox\nmatch from any for any action \"local\"\n"
    ],
    "directory_tree": "./../../dockers/CVE-2020-7247/custom_no_tool\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 entrypoint.sh\n\u2514\u2500\u2500 smtpd.conf"
}