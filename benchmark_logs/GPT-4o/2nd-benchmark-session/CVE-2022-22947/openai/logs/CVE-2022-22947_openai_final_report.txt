========== Generated Code (First Version) ==========
Directory tree:
./../../dockers/CVE-2022-22947/openai
├── docker-compose.yml
├── gateway
│   ├── Dockerfile
│   └── application.yml
└── nginx
    └── default.conf


---------- docker-compose.yml ----------
version: '3.8'
services:
  gateway:
    build: ./gateway
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=actuator
    image: springcloud/spring-cloud-gateway:CVE-2022-22947
    networks:
      - cve-network

  nginx:
    image: nginx:1.21.3
    ports:
      - "80:80"
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
    networks:
      - cve-network

networks:
  cve-network:
    driver: bridge


---------- gateway/Dockerfile ----------
FROM openjdk:11.0.2

RUN mkdir /app
WORKDIR /app

COPY application.yml /app/

# Add a vulnerable version of Spring Cloud Gateway
RUN curl -L https://repo1.maven.org/maven2/org/springframework/cloud/spring-cloud-gateway/3.0.6/spring-cloud-gateway-3.0.6.jar -o spring-cloud-gateway.jar

CMD ["java", "-jar", "spring-cloud-gateway.jar"]


---------- gateway/application.yml ----------
server:
  port: 8080

spring:
  cloud:
    gateway:
      routes:
        - id: actuator
          uri: http://localhost:8080/actuator
          predicates:
            - Path=/actuator/**

management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: always

---------- nginx/default.conf ----------
server {
    listen       80;
    server_name  localhost;

    location / {
        proxy_pass http://gateway:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}



========== Test Passed! Generated Code (Final Version) ==========
Directory tree:
./../../dockers/CVE-2022-22947/openai
├── docker-compose.yml
├── gateway
│   ├── Dockerfile
│   └── application.yml
└── nginx
    └── default.conf


---------- docker-compose.yml ----------
version: '3.8'
services:
  gateway:
    build: ./gateway
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=actuator
    image: springcloud/spring-cloud-gateway:CVE-2022-22947
    networks:
      - cve-network

  nginx:
    image: nginx:1.21.3
    ports:
      - "80:80"
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
    networks:
      - cve-network

networks:
  cve-network:
    driver: bridge


---------- gateway/Dockerfile ----------
FROM openjdk:11.0.2

RUN mkdir /app
WORKDIR /app

COPY application.yml /app/

# Add a vulnerable version of Spring Cloud Gateway
RUN curl -L https://repo1.maven.org/maven2/org/springframework/cloud/spring-cloud-gateway/3.0.6/spring-cloud-gateway-3.0.6.jar -o spring-cloud-gateway.jar

CMD ["java", "-jar", "spring-cloud-gateway.jar"]


---------- gateway/application.yml ----------
server:
  port: 8080

spring:
  cloud:
    gateway:
      routes:
        - id: actuator
          uri: http://localhost:8080/actuator
          predicates:
            - Path=/actuator/**

management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: always

---------- nginx/default.conf ----------
server {
    listen       80;
    server_name  localhost;

    location / {
        proxy_pass http://gateway:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}

