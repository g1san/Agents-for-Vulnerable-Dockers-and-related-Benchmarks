@echo off

setlocal

set MVNW_VERBOSE=false

if exist "%MAVEN_SKIP_RC%" goto skipRcPre
for %%i in ("%MAVEN_PROJECTBASEDIR%\mvnw.cmd") do for %%j in ("%%~dpi..\mvnw.cmd") do if exist "%%j" (set MAVEN_SKIP_RC=%%j) else if exist "%%~dpi..\..\mvnw.cmd" set MAVEN_SKIP_RC=%%~dpi..\..\mvnw.cmd
:skipRcPre

if exist "%MAVEN_SKIP_RC%" goto skipRcPost
if exist "%MAVEN_PROJECTBASEDIR%\.mvn\mavenrc_pre.bat" call "%MAVEN_PROJECTBASEDIR%\.mvn\mavenrc_pre.bat"
if exist "%MAVEN_PROJECTBASEDIR%\.mvn\mavenrc.cmd" call "%MAVEN_PROJECTBASEDIR%\.mvn\mavenrc.cmd"
if exist "%MAVEN_PROJECTBASEDIR%\.mvn\mavenrc_post.bat" call "%MAVEN_PROJECTBASEDIR%\.mvn\mavenrc_post.bat"
:skipRcPost

if not defined MAVEN_PROJECTBASEDIR set MAVEN_PROJECTBASEDIR=%CD%

if not exist "%MAVEN_PROJECTBASEDIR%\.mvn\wrapper\maven-wrapper.jar" (
    echo The Maven Wrapper jar is not present in the .mvn/wrapper directory of the project.
    echo Please run 'mvn -N io.takari:maven:wrapper' to create it.
    exit /b 1
)

set MAVEN_CMD_LINE_ARGS=%*

set WRAPPER_JAR="%MAVEN_PROJECTBASEDIR%\.mvn\wrapper\maven-wrapper.jar"

set JAVACMD=""
if defined JAVA_HOME set JAVACMD=%JAVA_HOME%\bin\java
if not defined JAVA_HOME set JAVACMD=java

if not exist "%JAVACMD%" (
    echo JAVA_HOME is not set and no 'java' command could be found in your PATH.
    exit /b 1
)

set MAVEN_OPTS="%MAVEN_OPTS% -Xmx1024m"

if not defined MAVEN_SKIP_RC (
    if exist "%MAVEN_PROJECTBASEDIR%\.mvn\wrapper\maven-wrapper.properties" (
        for /f "usebackq tokens=1,2 delims==" %%i in ("%MAVEN_PROJECTBASEDIR%\.mvn\wrapper\maven-wrapper.properties") do (
            if "%%i"=="distributionUrl" set WRAPPER_URL=%%j
        )
    )
)

if not defined WRAPPER_URL (
    echo distributionUrl not defined in %MAVEN_PROJECTBASEDIR%\.mvn\wrapper\maven-wrapper.properties
    exit /b 1
)

set WRAPPER_JAR="%MAVEN_PROJECTBASEDIR%\.mvn\wrapper\maven-wrapper.jar"

"%JAVACMD%" -classpath %WRAPPER_JAR% "-Dmaven.home=%M2_HOME%" "-Dmaven.multiModuleProjectDirectory=%MAVEN_PROJECTBASEDIR%" org.apache.maven.wrapper.MavenWrapperMain %MAVEN_CMD_LINE_ARGS%

endlocal
