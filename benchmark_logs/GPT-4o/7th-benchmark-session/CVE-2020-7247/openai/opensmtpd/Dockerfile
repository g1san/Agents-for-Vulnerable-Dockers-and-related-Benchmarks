FROM debian:10-slim

# Update apt sources to use the archived Debian 10 repositories
RUN echo "deb http://archive.debian.org/debian/ buster main" > /etc/apt/sources.list && \
    echo "deb http://archive.debian.org/debian-security/ buster/updates main" >> /etc/apt/sources.list && \
    echo "Acquire::Check-Valid-Until false;" > /etc/apt/apt.conf.d/99no-check-valid-until && \
    apt-get update && \
    apt-get install -y --no-install-recommends \
    opensmtpd \
    && rm -rf /var/lib/apt/lists/*

# Copy the OpenSMTPD configuration file
COPY smtpd.conf /etc/smtpd/smtpd.conf

# Expose the SMTP port
EXPOSE 25

# Start OpenSMTPD service
CMD ["/usr/sbin/smtpd", "-dv"]
