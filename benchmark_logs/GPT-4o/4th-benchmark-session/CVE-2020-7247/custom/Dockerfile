FROM debian:bullseye-slim

ENV DEBIAN_FRONTEND=noninteractive

# Disable service startup during package installation
RUN echo '#!/bin/sh\nexit 101' > /usr/sbin/policy-rc.d && chmod +x /usr/sbin/policy-rc.d

RUN apt-get update && \
    apt-get install -y opensmtpd=6.6.2p1-1 && \
    mkdir -p /etc/mail && \
    touch /etc/mail/mailname && \
    touch /etc/mail/aliases.db && \
    smtpctl rebuild

COPY smtpd.conf /etc/mail/smtpd.conf

CMD ["/usr/sbin/smtpd", "-d"]
