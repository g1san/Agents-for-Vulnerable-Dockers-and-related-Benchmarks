{
    "file_name": [
        "docker-compose.yml",
        "cacti/Dockerfile",
        "cacti/config.php",
        "cacti/remote_agent.php",
        "nginx/nginx.conf"
    ],
    "file_code": [
        "version: '3.8'\n\nservices:\n  cacti:\n    build: ./cacti\n    ports:\n      - \"8080:80\"\n    depends_on:\n      - db\n    networks:\n      - cacti-net\n\n  db:\n    image: mysql:8.0\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpassword\n      MYSQL_DATABASE: cacti\n      MYSQL_USER: cactiuser\n      MYSQL_PASSWORD: cactipassword\n    networks:\n      - cacti-net\n\n  nginx:\n    image: nginx:1.21\n    volumes:\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf\n    ports:\n      - \"80:80\"\n    depends_on:\n      - cacti\n    networks:\n      - cacti-net\n\nnetworks:\n  cacti-net:\n    driver: bridge\n",
        "FROM php:7.4-apache\n\nRUN apt-get update && \\\n    apt-get install -y \\\n    librrd-dev \\\n    libldap2-dev \\\n    libsnmp-dev \\\n    snmp \\\n    snmpd \\\n    rrdtool \\\n    git \\\n    unzip \\\n    && rm -rf /var/lib/apt/lists/*\n\nRUN docker-php-ext-install mysqli pdo pdo_mysql snmp\n\nWORKDIR /var/www/html\n\n# Updated to use a vulnerable version\nRUN git clone -b release/1.2.22 https://github.com/Cacti/cacti.git .\n\nCOPY config.php include/config.php\nCOPY remote_agent.php include/remote_agent.php\n\nRUN chown -R www-data:www-data /var/www/html\n",
        "<?php\n// Cacti configuration file\n$database_type = \"mysql\";\n$database_default = \"cacti\";\n$database_hostname = \"db\";\n$database_username = \"cactiuser\";\n$database_password = \"cactipassword\";\n$database_port = \"3306\";\n\n$url_path = \"/\";\n",
        "<?php\n// Vulnerable remote_agent.php script\n\n// Simulating the vulnerable code\nif (isset($_GET['action']) && $_GET['action'] === 'polldata') {\n    $ip = $_SERVER['REMOTE_ADDR'];\n    // Simulating a flawed IP verification\n    if ($ip === '127.0.0.1') {\n        $poller_item = $_GET['poller_item'];\n        // Unsafe use of proc_open leading to command injection\n        $process = proc_open($poller_item, [\n            1 => ['pipe', 'w'],\n            2 => ['pipe', 'w'],\n        ], $pipes);\n        if (is_resource($process)) {\n            fclose($pipes[1]);\n            fclose($pipes[2]);\n            proc_close($process);\n        }\n    }\n}\n",
        "worker_processes 1;\n\nerror_log /var/log/nginx/error.log warn;\n\npid /var/run/nginx.pid;\n\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    include /etc/nginx/mime.types;\n    default_type application/octet-stream;\n\n    sendfile on;\n    keepalive_timeout 65;\n\n    server {\n        listen 80;\n\n        location / {\n            proxy_pass http://cacti:80;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n        }\n    }\n}\n"
    ],
    "directory_tree": "./../../dockers/CVE-2022-46169/custom_no_tool"
}