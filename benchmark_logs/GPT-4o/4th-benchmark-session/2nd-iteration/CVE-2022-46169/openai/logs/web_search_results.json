{
    "desc": "CVE-2022-46169 is a critical vulnerability in Cacti, an open-source network monitoring and graphing tool. This flaw allows an unauthenticated attacker to execute arbitrary commands on a server running vulnerable versions of Cacti, specifically those up to and including version 1.2.22. The vulnerability resides in the `remote_agent.php` file, which is accessible without authentication. This script retrieves the client's IP address using the `get_client_addr` function and resolves it to a hostname via `gethostbyaddr`. It then checks for a corresponding entry in the `poller` table where the hostname matches the resolved hostname. If such an entry exists, the function returns `true`, granting authorization. However, due to the implementation of `get_client_addr` in `lib/functions.php`, an attacker can manipulate several `$_SERVER` variables to spoof the client's IP address. This manipulated IP address is subsequently inserted into a string passed to `proc_open`, leading to a command injection vulnerability. By providing parameters like `poller_id=;id`, an attacker can execute arbitrary commands. To exploit this, the attacker must supply a `host_id` and `local_data_id` where the corresponding `poller_item` action is set to `POLLER_ACTION_SCRIPT_PHP`. These IDs can be easily brute-forced, especially since predefined templates like \"Device - Uptime\" or \"Device - Polling Time\" often include such actions.",
    "attack_type": "Command Injection",
    "services": [
        {
            "name": "cacti",
            "version": [
                "1.2.0",
                "1.2.22"
            ],
            "dependency_type": "HARD",
            "description": "Cacti is the primary service vulnerable to CVE-2022-46169. It is a network monitoring and graphing tool that, in versions up to 1.2.22, contains a critical command injection vulnerability."
        },
        {
            "name": "mysql",
            "version": [
                "5.7"
            ],
            "dependency_type": "SOFT-DB",
            "description": "MySQL is used as the database backend for Cacti, storing necessary data and configurations."
        },
        {
            "name": "php",
            "version": [
                "7.4-apache"
            ],
            "dependency_type": "SOFT",
            "description": "PHP is required to run the Cacti application, providing the necessary scripting environment."
        },
        {
            "name": "httpd",
            "version": [
                "2.4"
            ],
            "dependency_type": "SOFT-WEB",
            "description": "Apache HTTP Server is used as the web server to deliver Cacti's web interface."
        }
    ],
    "input_tokens": 842,
    "output_tokens": 611
}