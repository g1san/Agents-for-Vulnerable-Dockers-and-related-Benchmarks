FROM php:7.4-apache

RUN apt-get update \
    && apt-get install -y \
        librrd-dev \
        git \
        unzip \
        libpng-dev \
        libjpeg-dev \
        libxml2-dev \
        libldap2-dev \
        libsnmp-dev \
        snmp \
        snmpd \
        rrdtool \
        libssl-dev \
    && docker-php-ext-configure gd --with-jpeg \
    && docker-php-ext-install gd \
    && docker-php-ext-install mysqli \
    && docker-php-ext-install sockets \
    && docker-php-ext-install gettext \
    && docker-php-ext-install pdo_mysql \
    && docker-php-ext-install ldap \
    && docker-php-ext-install snmp

# Download and setup Cacti
RUN git clone https://github.com/Cacti/cacti.git /var/www/html/cacti \
    && cd /var/www/html/cacti \
    && git checkout tags/release/1.2.22

WORKDIR /var/www/html/cacti

RUN cp include/config.php.dist include/config.php

EXPOSE 80
