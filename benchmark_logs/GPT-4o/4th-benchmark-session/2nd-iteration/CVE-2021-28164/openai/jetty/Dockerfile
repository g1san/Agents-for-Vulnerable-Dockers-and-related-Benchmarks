FROM openjdk:11.0.10-jdk-slim-buster

RUN sed -i 's|http://deb.debian.org/debian|http://archive.debian.org/debian|g' /etc/apt/sources.list && \
    sed -i 's|http://security.debian.org/debian-security|http://archive.debian.org/debian-security|g' /etc/apt/sources.list && \
    apt-get update && \
    apt-get install -y wget && \
    wget https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-distribution/9.4.37.v20210219/jetty-distribution-9.4.37.v20210219.tar.gz && \
    tar xvfz jetty-distribution-9.4.37.v20210219.tar.gz && \
    mv jetty-distribution-9.4.37.v20210219 /opt/jetty && \
    rm jetty-distribution-9.4.37.v20210219.tar.gz

ENV JETTY_HOME /opt/jetty
ENV PATH "$JETTY_HOME/bin:$PATH"

COPY webapps/ROOT /opt/jetty/webapps/ROOT

# Ensure Jetty starts with the default webapp
CMD ["java", "-jar", "/opt/jetty/start.jar", "jetty.http.port=8080", "jetty.deploy.scanInterval=0", "jetty.base=/opt/jetty"]
