FROM python:3.8

RUN echo "nameserver 8.8.8.8" > /etc/resolv.conf && \
    apt-get update && \
    apt-get install -y wget gnupg debian-archive-keyring && \
    wget -O /usr/share/keyrings/salt-archive-keyring.gpg https://repo.saltproject.io/salt/py3/debian/10/amd64/latest/salt-archive-keyring.gpg && \
    echo 'deb [signed-by=/usr/share/keyrings/salt-archive-keyring.gpg] http://archive.repo.saltproject.io/py3/debian/10/amd64/latest/ /' > /etc/apt/sources.list.d/saltstack.list && \
    apt-get update && \
    apt-get install -y salt-master=2019.2.3 && \
    pip install pyzmq==19.0.0 msgpack==1.0.0

COPY salt_master_config/salt_master.conf /etc/salt/master

CMD ["salt-master"]
