{
    "file_name": [
        "./../../dockers/CVE-2022-24706/custom_no_tool/docker-compose.yml",
        "./../../dockers/CVE-2022-24706/custom_no_tool/Dockerfile",
        "./../../dockers/CVE-2022-24706/custom_no_tool/init.sh"
    ],
    "file_code": [
        "services:\n  couchdb:\n    build: .\n    ports:\n      - \"5984:5984\"\n    environment:\n      COUCHDB_USER: admin\n      COUCHDB_PASSWORD: admin\n    volumes:\n      - couchdb_data:/opt/couchdb/data\n    networks:\n      - couchdb_network\n\nvolumes:\n  couchdb_data:\n    driver: local\n\nnetworks:\n  couchdb_network:\n    driver: bridge\n",
        "FROM apache/couchdb:3.2.1\n\nCOPY init.sh /usr/local/bin/init.sh\nRUN chmod +x /usr/local/bin/init.sh\n\nENTRYPOINT [\"/usr/local/bin/init.sh\"]\n",
        "#!/bin/bash\n\n# Ensure the script uses Unix-style line endings\n\n# Set the admin user in the local.ini file\ncat <<EOL >> /opt/couchdb/etc/local.ini\n[admins]\nadmin = admin\nEOL\n\n# Set the Erlang cookie to a secure value before starting CouchDB\necho \"secure_cookie_value\" > /opt/couchdb/.erlang.cookie\nchmod 400 /opt/couchdb/.erlang.cookie\n\n# Start CouchDB in the background to perform initial setup\n/opt/couchdb/bin/couchdb -b\n\n# Wait for CouchDB to start by checking its availability\nuntil curl -s http://admin:admin@localhost:5984/; do\n    echo \"Waiting for CouchDB to start...\"\n    sleep 5\ndone\n\n# Use CouchDB setup endpoint to initialize system databases\ncurl -X POST http://admin:admin@localhost:5984/_cluster_setup -H \"Content-Type: application/json\" -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin\", \"password\":\"admin\", \"node_count\": \"1\"}'\n\n# Ensure system databases are created\nfor db in _users _nodes _dbs _replicator; do\n    echo \"Checking database $db\"\n    if ! curl -s http://admin:admin@localhost:5984/$db; then\n        echo \"Creating database $db\"\n        curl -X PUT http://admin:admin@localhost:5984/$db\n    fi\ndone\n\n# Stop CouchDB to restart it properly\n/opt/couchdb/bin/couchdb -d\n\n# Start CouchDB using the service command\nexec /opt/couchdb/bin/couchdb\n"
    ],
    "directory_tree": "CVE-2022-24706/\n\u2514\u2500\u2500 custom_no_tool/\n    \u251c\u2500\u2500 docker-compose.yml\n    \u251c\u2500\u2500 Dockerfile\n    \u2514\u2500\u2500 init.sh\n"
}