#!/bin/bash

# Start CouchDB in the background
/opt/couchdb/bin/couchdb &
COUCHDB_PID=$!

# Wait for CouchDB to start
until curl -s -u admin:password http://localhost:5984/_up; do
  echo "Waiting for CouchDB to be available..."
  sleep 5
done

# Create system databases if they do not exist
curl -u admin:password -X PUT http://localhost:5984/_users
curl -u admin:password -X PUT http://localhost:5984/_nodes
curl -u admin:password -X PUT http://localhost:5984/_dbs

# Wait for CouchDB process to finish
wait $COUCHDB_PID
