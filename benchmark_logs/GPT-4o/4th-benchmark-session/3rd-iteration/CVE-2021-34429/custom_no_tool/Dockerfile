FROM eclipse-temurin:11-jre-focal

# Install Jetty
RUN apt-get update && \
    apt-get install -y wget && \
    wget https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-distribution/9.4.43.v20210629/jetty-distribution-9.4.43.v20210629.tar.gz && \
    tar -xzf jetty-distribution-9.4.43.v20210629.tar.gz -C /opt && \
    mv /opt/jetty-distribution-9.4.43.v20210629 /opt/jetty && \
    rm jetty-distribution-9.4.43.v20210629.tar.gz

# Set Jetty home and path
ENV JETTY_HOME /opt/jetty
ENV PATH $JETTY_HOME/bin:$PATH

# Set the working directory for Jetty
WORKDIR /opt/jetty

# Copy webapps
COPY webapps /opt/jetty/webapps

# Expose port
EXPOSE 8080

# Start Jetty
CMD ["java", "-jar", "/opt/jetty/start.jar", "--module=deploy", "--module=http"]