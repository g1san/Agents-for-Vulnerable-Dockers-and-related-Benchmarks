FROM debian:buster-slim

# Use archived Debian repositories
RUN sed -i 's|http://deb.debian.org/debian|http://archive.debian.org/debian|g' /etc/apt/sources.list && \
    sed -i '/deb-src/d' /etc/apt/sources.list && \
    apt-get update && \
    apt-get install -y --no-install-recommends \
        libzmq3-dev \
        python2.7 \
        python-pip \
        python-setuptools \
        python-dev \
        ca-certificates \
        wget \
        gcc && \
    pip install salt==2019.2.3 pyzmq==17.1.2 msgpack-python==0.5.6 pycryptodome==3.9.7 && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

ENTRYPOINT ["/entrypoint.sh"]
