FROM debian:bullseye

RUN apt-get update && \
    apt-get install -y wget build-essential libpcre3 libpcre3-dev libssl-dev libexpat1-dev && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# Download and extract Apache HTTP Server 2.4.49 source
RUN wget https://archive.apache.org/dist/httpd/httpd-2.4.49.tar.gz && \
    wget https://archive.apache.org/dist/apr/apr-1.7.0.tar.gz && \
    wget https://archive.apache.org/dist/apr/apr-util-1.6.1.tar.gz && \
    tar -xzf httpd-2.4.49.tar.gz && \
    tar -xzf apr-1.7.0.tar.gz && \
    tar -xzf apr-util-1.6.1.tar.gz && \
    mv apr-1.7.0 httpd-2.4.49/srclib/apr && \
    mv apr-util-1.6.1 httpd-2.4.49/srclib/apr-util && \
    cd httpd-2.4.49 && \
    ./configure --enable-so --enable-cgi --enable-rewrite --with-included-apr --enable-mods-shared=all && \
    make && \
    make install && \
    cd .. && \
    rm -rf httpd-2.4.49 httpd-2.4.49.tar.gz apr-1.7.0.tar.gz apr-util-1.6.1.tar.gz

COPY 000-default.conf /usr/local/apache2/conf/extra/httpd-vhosts.conf

CMD ["/usr/local/apache2/bin/httpd", "-D", "FOREGROUND"]
