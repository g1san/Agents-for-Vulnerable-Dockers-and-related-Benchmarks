FROM debian:bullseye

RUN apt-get update && \
    apt-get install -y build-essential wget libapr1-dev libaprutil1-dev libpcre3-dev && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Download and compile Apache HTTP Server 2.4.50 from a mirror
RUN wget http://archive.apache.org/dist/httpd/httpd-2.4.50.tar.gz && \
    tar xzf httpd-2.4.50.tar.gz && \
    cd httpd-2.4.50 && \
    ./configure --enable-cgi --prefix=/usr/local/apache2 && \
    make && \
    make install && \
    cd .. && \
    rm -rf httpd-2.4.50 httpd-2.4.50.tar.gz

COPY 000-default.conf /usr/local/apache2/conf/extra/httpd-vhosts.conf

CMD ["/usr/local/apache2/bin/httpd", "-D", "FOREGROUND"]
