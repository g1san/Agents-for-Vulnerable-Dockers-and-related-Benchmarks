FROM alpine:3.11

RUN apk add --no-cache \
        build-base \
        libressl-dev \
        libasr-dev \
        libevent-dev \
        sqlite-dev \
        bsd-compat-headers \
        curl \
        git

WORKDIR /usr/local/src

# Clone OpenSMTPD source from GitHub
RUN git clone https://github.com/OpenSMTPD/OpenSMTPD.git \
    && cd OpenSMTPD \
    && git checkout a8e222352f \
    && ./bootstrap \
    && ./configure \
    && make \
    && make install

COPY smtpd.conf /usr/local/etc/smtpd.conf

CMD ["/usr/sbin/smtpd", "-d"]
