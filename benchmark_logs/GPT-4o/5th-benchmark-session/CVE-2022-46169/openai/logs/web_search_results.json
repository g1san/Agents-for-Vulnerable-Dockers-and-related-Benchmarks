{
    "desc": "CVE-2022-46169 is a critical vulnerability identified in Cacti, an open-source platform designed for network monitoring and graphing. This vulnerability allows an unauthenticated attacker to execute arbitrary commands on a server running affected versions of Cacti. The vulnerability resides in the `remote_agent.php` file of Cacti, which is accessible without authentication. Within this file, the function `get_client_addr` retrieves the client's IP address by examining several `$_SERVER` variables. These variables can be manipulated by an attacker to supply a crafted IP address. The retrieved IP address is then resolved to a hostname using the `gethostbyaddr` function. Subsequently, the system checks for an entry in the `poller` table where the hostname matches the resolved hostname. If such an entry exists, the function returns `true`, granting authorization. The core issue arises from the `get_client_addr` function's reliance on `$_SERVER` variables, which can be controlled by an attacker. By supplying a specially crafted `poller_id` parameter, such as `poller_id=;id`, an attacker can inject and execute arbitrary system commands. This is due to the unsanitized input being passed to the `proc_open` function, leading to command execution. To exploit this vulnerability, the attacker needs to provide specific `host_id` and `local_data_id` values, where the corresponding `poller_item` action is set to `POLLER_ACTION_SCRIPT_PHP` (value `2`). These identifiers can be determined through brute-force methods. Notably, many Cacti installations have predefined templates like \"Device - Uptime\" or \"Device - Polling Time\" that include such `poller_item` actions, making exploitation feasible on default configurations. This vulnerability affects Cacti versions up to and including 1.2.22. It has been addressed in versions 1.2.23 and 1.3.0, where the patch prevents the authorization bypass by restricting the `get_client_addr` function from accepting arbitrary IP addresses and implements proper input validation for the `poller_id` parameter.",
    "attack_type": "RCE",
    "services": [
        {
            "name": "cacti",
            "version": [
                "1.2.22"
            ],
            "dependency_type": "HARD",
            "description": "Cacti is an open-source platform designed for network monitoring and graphing. The vulnerability CVE-2022-46169 affects versions up to 1.2.22, allowing command execution."
        },
        {
            "name": "mysql",
            "version": [
                "5.7"
            ],
            "dependency_type": "SOFT-DB",
            "description": "MySQL is a widely used open-source relational database management system. It serves as the backend database for Cacti."
        },
        {
            "name": "php",
            "version": [
                "7.4-apache"
            ],
            "dependency_type": "SOFT-WEB",
            "description": "PHP is a popular general-purpose scripting language that is especially suited to web development. It is used by Cacti to execute its web-based scripts."
        }
    ],
    "input_tokens": 835,
    "output_tokens": 653
}