@echo off

setlocal

set DIRNAME=%~dp0
if "%DIRNAME%" == "" set DIRNAME=.

set MAVEN_PROJECTBASEDIR="%DIRNAME%"

if not "%MAVEN_SKIP_RC%" == "" goto skipRcPre
if exist "%USERPROFILE%\.mavenrc_pre" call "%USERPROFILE%\.mavenrc_pre"
:skipRcPre

if not "%MAVEN_SKIP_RC%" == "" goto skipRc
if exist "%USERPROFILE%\.mavenrc" call "%USERPROFILE%\.mavenrc"
:skipRc

set WRAPPER_JAR="%MAVEN_PROJECTBASEDIR%\.mvn\wrapper\maven-wrapper.jar"
set WRAPPER_LAUNCHER=org.apache.maven.wrapper.MavenWrapperMain

set JAVA_EXE="%JAVA_HOME%\bin\java.exe"

if not exist %JAVA_EXE% (
  echo The JAVA_HOME environment variable is not defined correctly
  echo This environment variable is needed to run this program
  echo NB: JAVA_HOME should point to a JDK not a JRE
  exit /b 1
)

if exist %WRAPPER_JAR% (
  set CLASSPATH=%WRAPPER_JAR%
) else (
  echo Wrapper jar not found: %WRAPPER_JAR%
  exit /b 1
)

"%JAVA_EXE%" %MAVEN_OPTS% -classpath %CLASSPATH% "-Dmaven.multiModuleProjectDirectory=%MAVEN_PROJECTBASEDIR%" %WRAPPER_LAUNCHER% %*
