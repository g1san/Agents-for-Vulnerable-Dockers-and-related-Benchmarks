services:
  spring-cloud-function:
    build:
      context: ./spring-cloud-function
      dockerfile: Dockerfile
    ports:
      - "8080:8080"

  openjdk:
    image: openjdk:8-jdk
    command: tail -f /dev/null

  maven:
    image: maven:3.8.6-openjdk-8
    volumes:
      - ./spring-cloud-function:/usr/src/app
    working_dir: /usr/src/app
    entrypoint: ["/bin/sh", "-c", "mvn clean package && cp target/spring-cloud-function-0.0.1-SNAPSHOT.jar /usr/src/app/target/"]
    depends_on:
      - openjdk
