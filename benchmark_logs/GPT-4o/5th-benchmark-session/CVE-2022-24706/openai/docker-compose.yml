version: '3.9'

services:
  couchdb:
    image: apache/couchdb:3.2.1
    ports:
      - "5984:5984"
    environment:
      - COUCHDB_USER=admin
      - COUCHDB_PASSWORD=password
    volumes:
      - couchdb-data:/opt/couchdb/data
    command: >
      bash -c "while ! curl -s http://localhost:5984/_up; do sleep 1; done && \
      curl -X PUT http://admin:password@localhost:5984/_users"

  erlang:
    image: erlang:23
    command: tail -f /dev/null

volumes:
  couchdb-data:
    driver: local