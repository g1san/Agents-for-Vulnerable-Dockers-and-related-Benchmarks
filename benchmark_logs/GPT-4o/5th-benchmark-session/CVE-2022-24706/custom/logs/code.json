{
    "files": [
        {
            "location": "./../../dockers/CVE-2022-24706/custom/docker-compose.yml",
            "content": "version: '3.8'\n\nservices:\n  couchdb:\n    image: couchdb_custom:latest\n    build:\n      context: .\n      dockerfile: Dockerfile\n    container_name: couchdb_secure\n    ports:\n      - \"5984:5984\"\n      - \"4369:4369\"\n      - \"9100-9200:9100-9200\"\n    environment:\n      - COUCHDB_USER=admin\n      - COUCHDB_PASSWORD=securepassword\n      - ERL_FLAGS=-setcookie mysecretcookie\n    volumes:\n      - couchdb_data:/opt/couchdb/data\n    networks:\n      - couchdb_network\n\nnetworks:\n  couchdb_network:\n    driver: bridge\n\nvolumes:\n  couchdb_data:\n    driver: local\n"
        },
        {
            "location": "./../../dockers/CVE-2022-24706/custom/Dockerfile",
            "content": "FROM apache/couchdb:3.2.2\n\n# Copy the initialization script to the correct location\nCOPY init.sh /docker-entrypoint-initdb.d/init.sh\n\n# Ensure the script is executable\nRUN chmod +x /docker-entrypoint-initdb.d/init.sh\n\n# Use the default entrypoint\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\n\n# Start CouchDB\nCMD [\"couchdb\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2022-24706/custom/init.sh",
            "content": "#!/bin/bash\n\n# Wait for CouchDB to start and be ready\nuntil curl -s http://localhost:5984/_up | grep -q '\"status\":\"ok\"'; do\n  echo \"Waiting for CouchDB to be ready...\"\n  sleep 1\n  curl -s http://localhost:5984/_up || echo \"CouchDB not ready\"\ndone\n\n# Create necessary system databases if they do not exist\nfor db in _users _nodes _replicator _global_changes _dbs; do\n  if ! curl -s -o /dev/null -w \"%{http_code}\" \"http://admin:securepassword@localhost:5984/$db\" | grep -q '200'; then\n    curl -X PUT \"http://admin:securepassword@localhost:5984/$db\" && echo \"$db database created\" || echo \"Failed to create $db database\"\n  else\n    echo \"$db database already exists\"\n  fi\ndone\n\n# Continue with CouchDB startup\nexec \"$@\"\n"
        }
    ],
    "directory_tree": "CVE-2022-24706/\n\u2514\u2500\u2500 custom/\n    \u251c\u2500\u2500 docker-compose.yml\n    \u251c\u2500\u2500 Dockerfile\n    \u2514\u2500\u2500 init.sh"
}