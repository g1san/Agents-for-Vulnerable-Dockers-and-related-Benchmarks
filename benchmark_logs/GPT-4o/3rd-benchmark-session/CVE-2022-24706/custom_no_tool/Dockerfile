FROM apache/couchdb:3.2.1

# Expose the CouchDB port
EXPOSE 5984

# Copy the custom configuration file
COPY couchdb.ini /opt/couchdb/etc/local.d/couchdb.ini

# Set the default Erlang cookie
RUN echo "monster" > /opt/couchdb/.erlang.cookie && \
    chmod 400 /opt/couchdb/.erlang.cookie && \
    chown couchdb:couchdb /opt/couchdb/.erlang.cookie

# Set CouchDB as the entry point
ENTRYPOINT ["/opt/couchdb/bin/couchdb"]

# Default command to run
CMD ["-n"]