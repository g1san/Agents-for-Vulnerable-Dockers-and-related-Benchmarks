FROM openjdk:11-jdk-slim

WORKDIR /app

COPY Log4jVulnerableApp.java ./
COPY log4j2.xml ./

# Install wget to download Log4j library
RUN apt-get update && apt-get install -y wget && rm -rf /var/lib/apt/lists/*

# Download Log4j library
RUN wget https://repo1.maven.org/maven2/org/apache/logging/log4j/log4j-api/2.14.1/log4j-api-2.14.1.jar && \
    wget https://repo1.maven.org/maven2/org/apache/logging/log4j/log4j-core/2.14.1/log4j-core-2.14.1.jar

# Compile the Java application with Log4j in the classpath
RUN javac -cp .:log4j-api-2.14.1.jar:log4j-core-2.14.1.jar Log4jVulnerableApp.java && \
    mkdir -p /app/config && \
    mv log4j2.xml /app/config/

# Run the application with Log4j in the classpath
CMD ["java", "-cp", ".:log4j-api-2.14.1.jar:log4j-core-2.14.1.jar", "Log4jVulnerableApp"]
