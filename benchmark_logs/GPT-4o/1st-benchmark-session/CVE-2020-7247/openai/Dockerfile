FROM debian:11

# Install dependencies for building OpenSMTPD
RUN apt-get update && \
    apt-get install -y git build-essential libssl-dev libevent-dev automake && \
    rm -rf /var/lib/apt/lists/*

# Download and build OpenSMTPD 6.6 from GitHub
RUN git clone https://github.com/OpenSMTPD/OpenSMTPD.git && \
    cd OpenSMTPD && \
    # Use a tag corresponding to version 6.6
    git checkout 6.6.0p1 && \
    ./bootstrap && \
    ./configure && \
    make && \
    make install && \
    cd .. && \
    rm -rf OpenSMTPD

COPY smtp.conf /etc/mail/smtpd.conf

CMD ["/usr/local/sbin/smtpd", "-d"]
