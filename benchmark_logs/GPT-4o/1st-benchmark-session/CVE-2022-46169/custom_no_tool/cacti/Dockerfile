FROM php:7.4-apache

RUN apt-get update && \
    apt-get install -y \
    librrd-dev \
    libpng-dev \
    libjpeg-dev \
    libxml2-dev \
    libldap2-dev \
    libmcrypt-dev \
    libmariadb-dev-compat \
    libmariadb-dev \
    unzip \
    git

RUN docker-php-ext-install mysqli pdo pdo_mysql gd ldap xml

RUN a2enmod rewrite

COPY config.php /var/www/html/config.php

# Download and set up Cacti version 1.2.22
ADD https://www.cacti.net/downloads/cacti-1.2.22.tar.gz /tmp/cacti.tar.gz
RUN tar zxvf /tmp/cacti.tar.gz -C /var/www/html --strip-components=1 && rm /tmp/cacti.tar.gz

WORKDIR /var/www/html

RUN chown -R www-data:www-data /var/www/html
