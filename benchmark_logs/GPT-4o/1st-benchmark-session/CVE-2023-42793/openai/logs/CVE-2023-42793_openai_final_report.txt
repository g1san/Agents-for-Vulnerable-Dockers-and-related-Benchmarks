========== Generated Code (First Version) ==========
Directory tree:
./../../dockers/CVE-2023-42793/openai
├── docker-compose.yml
├── init.sql
└── nginx.conf


---------- docker-compose.yml ----------
version: '3.8'

services:
  teamcity-server:
    image: jetbrains/teamcity-server:2023.05.3
    ports:
      - "8111:8111"
    volumes:
      - teamcity_data:/data/teamcity_server/datadir
      - teamcity_logs:/opt/teamcity/logs
    environment:
      TEAMCITY_SERVER_MEM_OPTS: "-Xmx2g -XX:ReservedCodeCacheSize=350m"
    depends_on:
      - db

  teamcity-agent:
    image: jetbrains/teamcity-agent:2023.05.3
    environment:
      - SERVER_URL=http://teamcity-server:8111
    depends_on:
      - teamcity-server

  db:
    image: postgres:13.3
    environment:
      POSTGRES_USER: teamcity
      POSTGRES_PASSWORD: teamcitypass
      POSTGRES_DB: teamcity
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD", "pg_isready", "-U", "teamcity"]
      interval: 30s
      timeout: 30s
      retries: 3
    volumes:
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql

  nginx:
    image: nginx:1.21.3
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - teamcity-server

volumes:
  teamcity_data:
  teamcity_logs:
  postgres_data:


---------- nginx.conf ----------
server {
    listen 80;

    location / {
        proxy_pass http://teamcity-server:8111;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

---------- init.sql ----------
CREATE DATABASE teamcity;

CREATE USER teamcity WITH ENCRYPTED PASSWORD 'teamcitypass';

GRANT ALL PRIVILEGES ON DATABASE teamcity TO teamcity;




Test iteration #0 failed!
	Error: The error in the logs indicates that the 'volumes' key is defined twice in the 'db' service section of the Docker Compose file. This is causing a conflict as YAML does not allow duplicate keys.
	Fix: To fix the issue, the duplicate 'volumes' key in the 'db' service section should be removed. All volume mappings should be consolidated under a single 'volumes' key.========== Test Passed! Generated Code (Final Version) ==========
Directory tree:
./../../dockers/CVE-2023-42793/openai
├── docker-compose.yml
├── init.sql
└── nginx.conf


---------- docker-compose.yml ----------
version: '3.8'

services:
  teamcity-server:
    image: jetbrains/teamcity-server:2023.05.3
    ports:
      - "8111:8111"
    volumes:
      - teamcity_data:/data/teamcity_server/datadir
      - teamcity_logs:/opt/teamcity/logs
    environment:
      TEAMCITY_SERVER_MEM_OPTS: "-Xmx2g -XX:ReservedCodeCacheSize=350m"
    depends_on:
      - db

  teamcity-agent:
    image: jetbrains/teamcity-agent:2023.05.3
    environment:
      - SERVER_URL=http://teamcity-server:8111
    depends_on:
      - teamcity-server

  db:
    image: postgres:13.3
    environment:
      POSTGRES_USER: teamcity
      POSTGRES_PASSWORD: teamcitypass
      POSTGRES_DB: teamcity
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD", "pg_isready", "-U", "teamcity"]
      interval: 30s
      timeout: 30s
      retries: 3

  nginx:
    image: nginx:1.21.3
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - teamcity-server

volumes:
  teamcity_data:
  teamcity_logs:
  postgres_data:


---------- nginx.conf ----------
server {
    listen 80;

    location / {
        proxy_pass http://teamcity-server:8111;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}


---------- init.sql ----------
CREATE DATABASE teamcity;

CREATE USER teamcity WITH ENCRYPTED PASSWORD 'teamcitypass';

GRANT ALL PRIVILEGES ON DATABASE teamcity TO teamcity;


