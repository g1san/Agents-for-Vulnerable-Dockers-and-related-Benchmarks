FROM debian:bullseye-slim

# Install dependencies
RUN apt-get update && apt-get install -y \
    wget \
    bzip2 \
    build-essential \
    libxml2-dev \
    libssl-dev \
    libcurl4-openssl-dev \
    libjpeg-dev \
    libpng-dev \
    libfreetype6-dev \
    libonig-dev \
    libzip-dev \
    && rm -rf /var/lib/apt/lists/*

# Download and extract PHP 5.3.11
RUN wget https://museum.php.net/php5/php-5.3.11.tar.bz2 && \
    tar -xjf php-5.3.11.tar.bz2 && \
    cd php-5.3.11 && \
    ./configure --prefix=/usr/local/php --with-config-file-path=/usr/local/php --enable-fpm --with-curl --with-openssl --with-zlib --enable-mbstring --with-jpeg-dir --with-png-dir --with-freetype-dir --with-libdir=/lib/x86_64-linux-gnu && \
    make && \
    make install && \
    cd .. && rm -rf php-5.3.11

# Copy the PHP script into the container
COPY index.php /var/www/html/

# Set up PHP-FPM
RUN cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf

# Expose the port php-fpm will run on
EXPOSE 9000

# Run php-fpm
CMD ["/usr/local/php/sbin/php-fpm", "--nodaemonize"]
