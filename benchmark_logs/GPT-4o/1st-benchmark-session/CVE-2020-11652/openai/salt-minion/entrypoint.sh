#!/bin/bash

# Wait for salt-master to be ready
while ! nc -z salt-master 4505; do
  echo "Waiting for salt-master to be ready..."
  sleep 3
done

# Start the salt-minion service
echo "Starting salt-minion..."
salt-minion -l debug &

# Keep the container running and allow for debugging
trap 'kill %1' SIGINT SIGTERM EXIT

# Continuously check the process to keep the container alive
while true; do
  sleep 60
  pgrep -f salt-minion > /dev/null || exit 1
done
