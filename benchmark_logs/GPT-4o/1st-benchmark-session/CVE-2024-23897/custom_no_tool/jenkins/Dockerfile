FROM jenkins/jenkins:2.441

USER root

# Install additional tools if necessary
RUN apt-get update && apt-get install -y \
    vim \
    git \
    && rm -rf /var/lib/apt/lists/*

# Copy the install-plugins.sh script into the image
COPY install-plugins.sh /usr/local/bin/install-plugins.sh
RUN chmod +x /usr/local/bin/install-plugins.sh

USER jenkins

# Expose Jenkins CLI WebSocket endpoint
EXPOSE 8080 50000

# Set the Jenkins home directory
ENV JENKINS_HOME /var/jenkins_home

# Initialize Jenkins
RUN /usr/local/bin/install-plugins.sh

# Start Jenkins using the jenkins.war file
CMD ["java", "-jar", "/usr/share/jenkins/jenkins.war"]
