FROM ubuntu:12.04

# Install necessary packages
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    wget \
    build-essential \
    apache2 \
    libapache2-mod-php5 && \
    rm -rf /var/lib/apt/lists/*

# Manually download and install PHP 5.3.11
RUN wget -qO- https://museum.php.net/php5/php-5.3.11.tar.bz2 | tar xvjf - && \
    cd php-5.3.11 && \
    ./configure --with-apxs2=/usr/bin/apxs2 --with-config-file-path=/usr/local/etc/php --enable-cgi && \
    make && \
    make install && \
    cp php.ini-development /usr/local/etc/php/php.ini && \
    cd .. && \
    rm -rf php-5.3.11

# Copy PHP configuration
COPY php.ini /usr/local/etc/php/

# Ensure Apache runs in the foreground
CMD ["apache2", "-D", "FOREGROUND"]
