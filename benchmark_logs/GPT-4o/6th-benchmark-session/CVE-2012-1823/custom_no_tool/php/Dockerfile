FROM debian:bullseye-slim

# Install dependencies
RUN apt-get update && \
    apt-get install -y \
    apache2 \
    apache2-dev \
    wget \
    build-essential \
    libxml2-dev \
    perl \
    default-libmysqlclient-dev \
    && rm -rf /var/lib/apt/lists/*

# Download and install PHP 5.3
RUN wget https://museum.php.net/php5/php-5.3.11.tar.bz2 && \
    tar -xjf php-5.3.11.tar.bz2 && \
    cd php-5.3.11 && \
    ./configure --with-apxs2=/usr/bin/apxs2 --with-mysqli && \
    make && \
    make install && \
    cd .. && \
    rm -rf php-5.3.11 php-5.3.11.tar.bz2

# Enable PHP module and restart Apache
RUN echo "LoadModule php5_module /usr/lib/apache2/modules/libphp5.so" >> /etc/apache2/apache2.conf && \
    echo "AddType application/x-httpd-php .php" >> /etc/apache2/apache2.conf && \
    a2enmod php5 && \
    service apache2 restart

COPY . /var/www/html

WORKDIR /var/www/html

CMD ["/usr/sbin/apache2ctl", "-D", "FOREGROUND"]
