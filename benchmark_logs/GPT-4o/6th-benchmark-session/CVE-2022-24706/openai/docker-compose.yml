version: '3.9'

services:
  couchdb:
    image: couchdb:3.1.1
    environment:
      - COUCHDB_USER=admin
      - COUCHDB_PASSWORD=password
    ports:
      - "5984:5984"
    volumes:
      - couchdb_data:/opt/couchdb/data
    command: >
      bash -c "while ! curl -s http://localhost:5984/_up; do sleep 1; done &&
      curl -X PUT http://admin:password@localhost:5984/_users &&
      curl -X PUT http://admin:password@localhost:5984/_nodes &&
      exec /opt/couchdb/bin/couchdb"

volumes:
  couchdb_data: