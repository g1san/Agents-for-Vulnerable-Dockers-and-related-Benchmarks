FROM php:7.4-apache

RUN apt-get update && \
    apt-get install -y librrd-dev libpng-dev libsnmp-dev snmp libmariadb-dev-compat libmariadb-dev libjpeg-dev libfreetype6-dev && \
    docker-php-ext-install mysqli && \
    docker-php-ext-configure gd --with-jpeg=/usr/include/ --with-freetype=/usr/include/ && \
    docker-php-ext-install gd && \
    docker-php-ext-install snmp

RUN curl -o /tmp/cacti-1.2.22.tar.gz -L https://www.cacti.net/downloads/cacti-1.2.22.tar.gz && \
    tar -zxvf /tmp/cacti-1.2.22.tar.gz -C /var/www/html --strip-components=1 && \
    rm /tmp/cacti-1.2.22.tar.gz

COPY ./config.php /var/www/html/include/config.php

RUN chown -R www-data:www-data /var/www/html/rra /var/www/html/log

EXPOSE 80

CMD ["apache2-foreground"]
