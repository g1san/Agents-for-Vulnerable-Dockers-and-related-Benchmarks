FROM openjdk:11-jre-slim

# Install Jetty
RUN apt-get update && \
    apt-get install -y wget && \
    wget -qO- https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-distribution/9.4.42.v20210604/jetty-distribution-9.4.42.v20210604.tar.gz | tar xz -C /opt && \
    mv /opt/jetty-distribution-9.4.42.v20210604 /opt/jetty && \
    apt-get remove -y wget && \
    apt-get autoremove -y && \
    rm -rf /var/lib/apt/lists/*

ENV JETTY_HOME /opt/jetty
ENV PATH $JETTY_HOME/bin:$PATH

WORKDIR $JETTY_HOME

# Verify start.jar exists
RUN if [ ! -f "$JETTY_HOME/start.jar" ]; then echo "start.jar not found"; exit 1; fi

# Copy webapps to the Jetty webapps directory
COPY ./webapps $JETTY_HOME/webapps

# Ensure correct permissions for the Jetty directory
RUN chmod -R 755 $JETTY_HOME

CMD ["java", "-jar", "$JETTY_HOME/start.jar"]
