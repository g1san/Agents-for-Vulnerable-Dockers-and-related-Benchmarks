# Use the official OpenJDK image for Java 11
FROM openjdk:11-jre-slim

# Install Jetty 9.4.42
RUN apt-get update && \
    apt-get install -y wget && \
    wget -q "https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-distribution/9.4.42.v20210604/jetty-distribution-9.4.42.v20210604.tar.gz" -O jetty.tar.gz && \
    tar -xzf jetty.tar.gz -C /opt && \
    mv /opt/jetty-distribution-9.4.42.v20210604 /opt/jetty && \
    rm jetty.tar.gz && \
    apt-get remove -y wget && \
    apt-get autoremove -y && \
    apt-get clean

# Set environment variables
ENV JETTY_HOME /opt/jetty
ENV PATH "$JETTY_HOME/bin:$PATH"

# Copy webapps and configuration to Jetty base
COPY ./webapps $JETTY_HOME/webapps
COPY ./start.ini $JETTY_HOME/start.ini

# Expose port 8080
EXPOSE 8080

# Set the entry point using exec form
ENTRYPOINT ["java", "-jar", "/opt/jetty/start.jar", "--module=http", "--module=deploy", "--module=webapp", "--module=server"]
