{
    "files": [
        {
            "location": "./../../dockers/CVE-2020-11652/custom/docker-compose.yml",
            "content": "version: '3.8'\nservices:\n  dind:\n    image: docker:23.0-dind\n    privileged: true\n    environment:\n      - DOCKER_TLS_CERTDIR=\n    ports:\n      - \"2375:2375\"\n    volumes:\n      - dind-data:/var/lib/docker\n      - /sys/fs/cgroup:/sys/fs/cgroup\n    healthcheck:\n      test: [\"CMD\", \"wget\", \"-qO-\", \"http://localhost:2375/_ping\"]\n      interval: 5s\n      timeout: 2s\n      retries: 10\n\n  salt:\n    image: saltstack/salt:3000.1\n    ports:\n      - \"4505:4505\"\n      - \"4506:4506\"\n\n  vulnerable_app:\n    build:\n      context: ./app\n    depends_on:\n      dind:\n        condition: service_healthy\n      salt:\n        condition: service_started\n    environment:\n      - DOCKER_HOST=tcp://dind:2375\n    ports:\n      - \"80:80\"\n\nvolumes:\n  dind-data:\n    driver: local\n"
        },
        {
            "location": "./../../dockers/CVE-2020-11652/custom/app/Dockerfile",
            "content": "FROM python:3.8-slim\nWORKDIR /app\nRUN pip install --no-cache-dir flask docker\nCOPY app.py /app/app.py\nEXPOSE 80\nCMD [\"python\", \"app.py\"]\n"
        },
        {
            "location": "./../../dockers/CVE-2020-11652/custom/app/app.py",
            "content": "from flask import Flask, request\nimport docker, os\napp = Flask(__name__)\nclient = docker.from_env()\n\n@app.route('/')\ndef index():\n    return 'Vulnerable app ready. Use /run?cmd=... to execute commands inside the host Docker daemon.'\n\n@app.route('/run')\ndef run_cmd():\n    cmd = request.args.get('cmd')\n    if not cmd:\n        return 'No command provided', 400\n    # This endpoint is intentionally vulnerable: it runs arbitrary commands on the host Docker daemon\n    try:\n        container_output = client.containers.run('alpine', f'sh -c \"{cmd}\"', remove=True)\n        return f'Command output: {container_output.decode()}'\n    except Exception as e:\n        return f'Error: {str(e)}', 500\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=80)\n"
        }
    ],
    "directory_tree": "custom/\n\u251c\u2500 docker-compose.yml\n\u2514\u2500 app/\n   \u251c\u2500 Dockerfile\n   \u2514\u2500 app.py\n"
}