{
    "files": [
        {
            "location": "./../../dockers/CVE-2022-46169/custom/docker-compose.yml",
            "content": "services:\n  cacti:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    container_name: cacti\n    ports:\n      - \"80:80\"\n    environment:\n      - CACTI_DB_HOST=db\n      - CACTI_DB_NAME=cacti\n      - CACTI_DB_USER=cactiuser\n      - CACTI_DB_PASSWORD=cacti\n    depends_on:\n      - db\n  db:\n    image: mysql:5.7\n    container_name: db\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpass\n      MYSQL_DATABASE: cacti\n      MYSQL_USER: cactiuser\n      MYSQL_PASSWORD: cacti\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - ./init.sql:/docker-entrypoint-initdb.d/init.sql"
        },
        {
            "location": "./../../dockers/CVE-2022-46169/custom/Dockerfile",
            "content": "FROM php:7.4-apache\n\nRUN apt-get update && \\\n    DEBIAN_FRONTEND=noninteractive apt-get install -y \\\n        libpng-dev \\\n        libjpeg-dev \\\n        libpq-dev \\\n        libzip-dev \\\n        zlib1g-dev \\\n        librrd-dev \\\n        rrdtool \\\n        libldap2-dev \\\n        libxml2-dev \\\n        git \\\n        wget \\\n        unzip \\\n        netcat-openbsd && \\\n    docker-php-ext-configure gd --with-jpeg && \\\n    docker-php-ext-install gd mysqli zip && \\\n    pecl install rrd && \\\n    docker-php-ext-enable rrd && \\\n    echo \"extension=rrd.so\" > /usr/local/etc/php/conf.d/rrd.ini && \\\n    a2enmod rewrite && \\\n    rm -rf /var/lib/apt/lists/*\n\nWORKDIR /var/www/html\n\n# Download the correct Cacti source archive (v1.2.22)\nRUN wget -O cacti.tar.gz https://github.com/Cacti/cacti/archive/v1.2.22.tar.gz && \\\n    tar -xzf cacti.tar.gz --strip-components=1 && \\\n    rm cacti.tar.gz && \\\n    chown -R www-data:www-data /var/www/html && \\\n    chmod -R 755 /var/www/html\n\nCOPY entrypoint.sh /usr/local/bin/entrypoint.sh\nRUN chmod +x /usr/local/bin/entrypoint.sh\n\nENTRYPOINT [\"sh\",\"/usr/local/bin/entrypoint.sh\"]\nCMD [\"apache2-foreground\"]"
        },
        {
            "location": "./../../dockers/CVE-2022-46169/custom/entrypoint.sh",
            "content": "#!/bin/bash\nset -e\n\n# Wait for MySQL to be ready\nwhile ! nc -z \"$CACTI_DB_HOST\" 3306; do\n  echo \"Waiting for MySQL...\"\n  sleep 2\ndone\n\n# Configure Cacti database settings if not already configured\nif [ -f /var/www/html/include/config.php ]; then\n  echo \"Cacti config already exists.\"\nelse\n  cp /var/www/html/include/config.php.dist /var/www/html/include/config.php\n  sed -i \"s/\\$database_default_user = .*/\\$database_default_user = \\\"${CACTI_DB_USER}\\\";/\" /var/www/html/include/config.php\n  sed -i \"s/\\$database_default_password = .*/\\$database_default_password = \\\"${CACTI_DB_PASSWORD}\\\";/\" /var/www/html/include/config.php\n  sed -i \"s/\\$database_default_host = .*/\\$database_default_host = \\\"${CACTI_DB_HOST}\\\";/\" /var/www/html/include/config.php\n  sed -i \"s/\\$database_default_name = .*/\\$database_default_name = \\\"${CACTI_DB_NAME}\\\";/\" /var/www/html/include/config.php\nfi\n\nexec \"$@\""
        },
        {
            "location": "./../../dockers/CVE-2022-46169/custom/init.sql",
            "content": "CREATE DATABASE IF NOT EXISTS cacti;\nUSE cacti;\n-- Simple test table for demonstration purposes\nCREATE TABLE IF NOT EXISTS test_table (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(255) NOT NULL\n);\nINSERT INTO test_table (name) VALUES ('test entry 1'), ('test entry 2');\n"
        }
    ],
    "directory_tree": "CVE-2022-46169"
}