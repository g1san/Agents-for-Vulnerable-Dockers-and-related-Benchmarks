version: '3.8'
services:
  gateway:
    build: ./gateway
    ports:
      - "8080:8080"
    environment:
      - 'SPRING_APPLICATION_JSON={"spring.cloud.gateway.routes[0].id":"malicious","spring.cloud.gateway.routes[0].uri":"http://downstream:8081","spring.cloud.gateway.routes[0].predicates[0]":"Path=/","spring.cloud.gateway.routes[0].filters[0].name":"RewritePath","spring.cloud.gateway.routes[0].filters[0].args.regex":"/.*","spring.cloud.gateway.routes[0].filters[0].args.replacement":"/actuator/env"}'
    depends_on:
      - downstream
  downstream:
    build: ./downstream
    ports:
      - "8081:8081"
    environment:
      - "JAVA_OPTS=-Dspring.config.location=classpath:/application.yml"