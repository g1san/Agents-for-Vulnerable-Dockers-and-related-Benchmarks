FROM ubuntu:22.04
ARG DEBIAN_FRONTEND=noninteractive
RUN apt-get update && apt-get install -y --no-install-recommends \
        ca-certificates \
        wget \
        build-essential \
        libevent-dev \
        libbsd-dev \
        libkrb5-dev \
        libssl-dev \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src
# Download OpenSMTPD 6.6.0 from the official OpenBSD mirrors
RUN wget -O opensmtpd.tar.gz https://ftp.openbsd.org/pub/OpenBSD/6.6/opensmtpd-6.6.0.tgz && \
    tar xzf opensmtpd.tar.gz && \
    cd opensmtpd-6.6.0 && \
    ./configure && \
    make && \
    make install && \
    cd / && rm -rf /usr/src/opensmtpd*

COPY opensmtpd.conf /etc/opensmtpd/opensmtpd.conf
EXPOSE 25
CMD ["opensmtpd", "-d"]