ServerRoot "/usr/local/apache2"
Listen 80

# Load only the modules required for the demo and the vulnerable proxy configuration
LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule dir_module modules/mod_dir.so
LoadModule alias_module modules/mod_alias.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule rewrite_module modules/mod_rewrite.so

ServerAdmin you@example.com
ServerName localhost
DocumentRoot "/usr/local/apache2/htdocs"

<Directory "/usr/local/apache2/htdocs">
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
</Directory>

# Vulnerable proxy configuration (CVE-2021-42013)
ProxyRequests Off
ProxyPreserveHost On
<IfModule mod_proxy.c>
    ProxyPass "/api/" "http://backend:5000/"
    ProxyPassReverse "/api/" "http://backend:5000/"
</IfModule>

ErrorLog "logs/error_log"
CustomLog "logs/access_log" combined