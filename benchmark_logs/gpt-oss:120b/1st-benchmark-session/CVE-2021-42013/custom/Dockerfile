FROM httpd:2.4.49

# Create cgi-bin directory
RUN mkdir -p /usr/local/apache2/cgi-bin

# Enable CGI module and set ServerName
RUN sed -i 's/#LoadModule cgi_module modules\/mod_cgi.so/LoadModule cgi_module modules\/mod_cgi.so/' /usr/local/apache2/conf/httpd.conf && \
    sed -i 's/Listen 80/Listen 80\n    ServerName localhost/' /usr/local/apache2/conf/httpd.conf

# Add CGI directory configuration
RUN echo -e '\n<Directory "/usr/local/apache2/cgi-bin">\n    Options +ExecCGI\n    AddHandler cgi-script .cgi .pl .py\n</Directory>' >> /usr/local/apache2/conf/httpd.conf

# Add ScriptAlias for CGI
RUN echo -e '\nScriptAlias /cgi-bin/ "/usr/local/apache2/cgi-bin/"' >> /usr/local/apache2/conf/httpd.conf

# Copy vulnerable CGI script
COPY cgi-bin/vuln.cgi /usr/local/apache2/cgi-bin/vuln.cgi
RUN chmod +x /usr/local/apache2/cgi-bin/vuln.cgi