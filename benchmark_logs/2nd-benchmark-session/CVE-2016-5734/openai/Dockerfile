FROM tomcat:8.0.36-jre8

# Ensure the system is up to date and install necessary packages
RUN apt-get update && \
    apt-get install -y wget unzip && \
    rm -rf /var/lib/apt/lists/*

# Clean existing webapps and copy the new one
RUN rm -rf /usr/local/tomcat/webapps/*
COPY webapp /usr/local/tomcat/webapps/ROOT

# Download and install Apache Struts 2.3.28.1
RUN wget https://archive.apache.org/dist/struts/2.3.28.1/struts-2.3.28.1-all.zip && \
    unzip struts-2.3.28.1-all.zip -d /usr/local/struts && \
    rm struts-2.3.28.1-all.zip

# Set environment variables for Struts
ENV STRUTS2_HOME /usr/local/struts/struts-2.3.28.1

# Copy Struts libs to Tomcat
RUN cp $STRUTS2_HOME/lib/*.jar /usr/local/tomcat/lib/

# Expose the default port and start Tomcat
EXPOSE 8080
CMD ["catalina.sh", "run"]
