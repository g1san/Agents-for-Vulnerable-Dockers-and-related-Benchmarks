FROM php:7.0-apache

# Use archived Debian repositories
RUN echo "deb http://archive.debian.org/debian stretch main" > /etc/apt/sources.list && \
    echo "deb http://archive.debian.org/debian-security stretch/updates main" >> /etc/apt/sources.list && \
    echo 'Acquire::Check-Valid-Until "false";' > /etc/apt/apt.conf.d/99no-check-valid-until

# Add necessary GPG keys for Debian Stretch
RUN apt-get update && apt-get install -y --no-install-recommends gnupg dirmngr \
    && apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 04EE7237B7D453EC EF0F382A1A7B6500

# Install necessary packages
RUN apt-get update && apt-get install -y --no-install-recommends \
    wget \
    unzip \
    && rm -rf /var/lib/apt/lists/*

# Download phpMyAdmin 4.6.2
RUN wget https://files.phpmyadmin.net/phpMyAdmin/4.6.2/phpMyAdmin-4.6.2-all-languages.zip \
    && unzip phpMyAdmin-4.6.2-all-languages.zip \
    && mv phpMyAdmin-4.6.2-all-languages /var/www/html/phpmyadmin \
    && rm phpMyAdmin-4.6.2-all-languages.zip

# Copy configuration
COPY config.inc.php /var/www/html/phpmyadmin/config.inc.php

# Set permissions
RUN chown -R www-data:www-data /var/www/html/phpmyadmin

# The following line ensures that the phpMyAdmin version is vulnerable
# to CVE-2016-5734 by using a specific older version.
RUN echo 'This phpMyAdmin version is vulnerable to CVE-2016-5734'
