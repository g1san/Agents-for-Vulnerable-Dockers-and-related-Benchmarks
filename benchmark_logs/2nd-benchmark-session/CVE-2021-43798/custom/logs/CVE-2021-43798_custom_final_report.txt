========== Generated Code (First Version) ==========
Directory tree:
./../../dockers/CVE-2021-43798/custom
|-- docker-compose.yml
|-- grafana
|   |-- Dockerfile
|   `-- provisioning
|       `-- datasources
|           `-- datasource.yml
|-- mysql
|   `-- init.sql
`-- nginx
    `-- default.conf


---------- docker-compose.yml ----------
version: '3.7'

services:
  grafana:
    image: grafana/grafana:8.3.0-CVE-2021-43798
    build:
      context: ./grafana
    ports:
      - "3000:3000"
    volumes:
      - grafana-storage:/var/lib/grafana
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_SECURITY_ADMIN_USER=admin

  nginx:
    image: nginx:1.21.6
    ports:
      - "8080:80"
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf

  mysql:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: grafana
    volumes:
      - mysql-data:/var/lib/mysql
      - ./mysql/init.sql:/docker-entrypoint-initdb.d/init.sql

volumes:
  grafana-storage:
  mysql-data:


---------- grafana/Dockerfile ----------
FROM grafana/grafana:8.3.0

# No additional configuration necessary for the vulnerability


---------- grafana/provisioning/datasources/datasource.yml ----------
apiVersion: 1

datasources:
  - name: MySQL
    type: mysql
    access: proxy
    url: mysql:3306
    database: grafana
    user: root
    secureJsonData:
      password: rootpassword
    isDefault: true


---------- nginx/default.conf ----------
server {
    listen 80;

    location / {
        proxy_pass http://grafana:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}


---------- mysql/init.sql ----------
CREATE DATABASE IF NOT EXISTS grafana;




========== Test Passed! Generated Code (Final Version) ==========
Directory tree:
./../../dockers/CVE-2021-43798/custom
|-- docker-compose.yml
|-- grafana
|   |-- Dockerfile
|   `-- provisioning
|       `-- datasources
|           `-- datasource.yml
|-- mysql
|   `-- init.sql
`-- nginx
    `-- default.conf


---------- docker-compose.yml ----------
version: '3.7'

services:
  grafana:
    image: grafana/grafana:8.3.0-CVE-2021-43798
    build:
      context: ./grafana
    ports:
      - "3000:3000"
    volumes:
      - grafana-storage:/var/lib/grafana
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_SECURITY_ADMIN_USER=admin

  nginx:
    image: nginx:1.21.6
    ports:
      - "8080:80"
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf

  mysql:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: grafana
    volumes:
      - mysql-data:/var/lib/mysql
      - ./mysql/init.sql:/docker-entrypoint-initdb.d/init.sql

volumes:
  grafana-storage:
  mysql-data:


---------- grafana/Dockerfile ----------
FROM grafana/grafana:8.3.0

# No additional configuration necessary for the vulnerability


---------- grafana/provisioning/datasources/datasource.yml ----------
apiVersion: 1

datasources:
  - name: MySQL
    type: mysql
    access: proxy
    url: mysql:3306
    database: grafana
    user: root
    secureJsonData:
      password: rootpassword
    isDefault: true


---------- nginx/default.conf ----------
server {
    listen 80;

    location / {
        proxy_pass http://grafana:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}


---------- mysql/init.sql ----------
CREATE DATABASE IF NOT EXISTS grafana;


