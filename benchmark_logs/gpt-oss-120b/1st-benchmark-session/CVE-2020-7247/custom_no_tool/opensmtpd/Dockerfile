FROM debian:bullseye-slim

ENV DEBIAN_FRONTEND=noninteractive

# Install a specific vulnerable version of OpenSMTPD (6.6.1)
# The version is fetched from the official OpenSMTPD source archive.
RUN apt-get update && \
    apt-get install -y --no-install-recommends wget ca-certificates build-essential && \
    wget -O /tmp/opensmtpd-6.6.1.tar.gz https://github.com/openbsd/src/archive/refs/tags/opensmtpd-6.6.1.tar.gz && \
    tar -xzf /tmp/opensmtpd-6.6.1.tar.gz -C /tmp && \
    cd /tmp/src-opensmtpd-6.6.1 && \
    ./configure && make && make install && \
    rm -rf /tmp/* && \
    apt-get purge -y --auto-remove wget build-essential && \
    rm -rf /var/lib/apt/lists/*

RUN mkdir -p /etc/opensmtpd
RUN echo "listen on 0.0.0.0" > /etc/opensmtpd/opensmtpd.conf

EXPOSE 25

CMD ["smtpd", "-d", "-f", "/etc/opensmtpd/opensmtpd.conf"]