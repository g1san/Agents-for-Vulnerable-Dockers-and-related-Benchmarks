#!/usr/bin/env perl
use strict;
use warnings;

print "Content-type: text/plain\n\n";
print "--- Vulnerable CGI Output ---\n";
print "You requested: $ENV{REQUEST_URI}\n";

# Echo back any query parameters (demonstrates lack of sanitisation)
if (defined $ENV{QUERY_STRING}) {
    print "Query string: $ENV{QUERY_STRING}\n";
}

# Attempt to read a file path supplied via a "file" parameter (illustrates path traversal)
if ($ENV{QUERY_STRING} && $ENV{QUERY_STRING} =~ /file=([^&]+)/) {
    my $file = $1;
    $file =~ s/%([0-9A-Fa-f]{2})/chr(hex($1))/ge;  # URL decode
    if (open my $fh, '<', $file) {
        print "\n--- Contents of $file ---\n";
        while (my $line = <$fh>) {
            print $line;
        }
        close $fh;
    } else {
        print "\nFailed to open $file: $!\n";
    }
}
