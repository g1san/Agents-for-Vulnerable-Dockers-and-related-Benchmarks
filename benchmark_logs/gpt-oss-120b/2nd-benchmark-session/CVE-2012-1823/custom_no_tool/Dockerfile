FROM debian:stretch-slim
ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get update && \
    apt-get install -y --no-install-recommends apache2 php7.0-cgi && \
    rm -rf /var/lib/apt/lists/*
# Enable CGI module and configure site
RUN a2enmod cgi && \
    rm /etc/apache2/sites-enabled/000-default.conf
# Copy Apache virtual-host configuration before enabling it
COPY 000-default.conf /etc/apache2/sites-available/000-default.conf
RUN a2dissite 000-default.conf && a2ensite 000-default.conf
# Place phpâ€‘cgi binary into CGI bin directory (legacy name php5 for compatibility)
RUN mkdir -p /usr/lib/cgi-bin && ln -s /usr/bin/php-cgi /usr/lib/cgi-bin/php5
# Add a simple vulnerable script
COPY phpinfo.php /var/www/html/phpinfo.php
EXPOSE 80
CMD ["apache2ctl", "-D", "FOREGROUND"]