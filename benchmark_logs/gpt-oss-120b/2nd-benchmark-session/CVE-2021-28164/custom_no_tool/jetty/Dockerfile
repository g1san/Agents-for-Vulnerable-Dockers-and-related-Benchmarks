FROM openjdk:11-jre-slim

ENV JETTY_VERSION=9.4.42.v20210604
ENV JETTY_HOME=/opt/jetty
ENV JETTY_BASE=/opt/jetty-base

RUN apt-get update && \
    apt-get install -y --no-install-recommends wget ca-certificates && \
    rm -rf /var/lib/apt/lists/* && \
    mkdir -p $JETTY_HOME $JETTY_BASE && \
    wget -q https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-distribution/${JETTY_VERSION}/jetty-distribution-${JETTY_VERSION}.tar.gz && \
    tar -xzf jetty-distribution-${JETTY_VERSION}.tar.gz -C $JETTY_HOME --strip-components=1 && \
    rm jetty-distribution-${JETTY_VERSION}.tar.gz && \
    cp -r $JETTY_HOME/demo-base/* $JETTY_BASE/ && \
    echo "jetty.startup.logging.level=INFO" > $JETTY_BASE/start.ini

WORKDIR $JETTY_BASE
EXPOSE 8080

# Use a shell form so environment variables are expanded
CMD ["sh", "-c", "java -jar $JETTY_HOME/start.jar"]