#!/bin/sh
# Wait for MySQL to be ready before starting the Flask application
set -e
HOST=db
PORT=3306
MAX_ATTEMPTS=30
attempt=1
until mysqladmin ping -h"$HOST" -P"$PORT" --silent; do
  if [ $attempt -ge $MAX_ATTEMPTS ]; then
    echo "MySQL not reachable after $attempt attempts, exiting."
    exit 1
  fi
  echo "Waiting for MySQL... ($attempt/$MAX_ATTEMPTS)"
  attempt=$((attempt + 1))
  sleep 2
done
echo "MySQL is up â€“ launching Flask app"
exec python app.py