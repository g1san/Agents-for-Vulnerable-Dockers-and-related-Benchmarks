{
    "files": [
        {
            "location": "./../../dockers/CVE-2022-22963/custom/docker-compose.yml",
            "content": "version: \"3.8\"\nservices:\n  vulnerable-app:\n    build: .\n    container_name: vulnerable-app\n    ports:\n      - \"8080:8080\"\n    environment:\n      - SPRING_PROFILES_ACTIVE=dev"
        },
        {
            "location": "./../../dockers/CVE-2022-22963/custom/Dockerfile",
            "content": "FROM maven:3.9-eclipse-temurin-17 AS build\nWORKDIR /app\nCOPY pom.xml .\nCOPY src ./src\nRUN mvn -B package -DskipTests\n\nFROM eclipse-temurin:17-jre-alpine\nWORKDIR /app\nCOPY --from=build /app/target/demo-0.0.1-SNAPSHOT.jar app.jar\nEXPOSE 8080\nENTRYPOINT [\"java\",\"-jar\",\"/app/app.jar\"]"
        },
        {
            "location": "./../../dockers/CVE-2022-22963/custom/pom.xml",
            "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>com.example</groupId>\n    <artifactId>demo</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <packaging>jar</packaging>\n\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.6.6</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n\n    <properties>\n        <java.version>17</java.version>\n        <!-- Vulnerable version of spring-cloud-function-web -->\n        <spring-cloud-function.version>3.1.6</spring-cloud-function.version>\n    </properties>\n\n    <dependencyManagement>\n        <dependencies>\n            <dependency>\n                <groupId>org.springframework.cloud</groupId>\n                <artifactId>spring-cloud-dependencies</artifactId>\n                <version>2021.0.3</version>\n                <type>pom</type>\n                <scope>import</scope>\n            </dependency>\n        </dependencies>\n    </dependencyManagement>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-function-web</artifactId>\n            <version>${spring-cloud-function.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-actuator</artifactId>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <version>3.10.1</version>\n                <configuration>\n                    <source>${java.version}</source>\n                    <target>${java.version}</target>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>"
        },
        {
            "location": "./../../dockers/CVE-2022-22963/custom/src/main/java/com/example/demo/DemoApplication.java",
            "content": "package com.example.demo;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class DemoApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(DemoApplication.class, args);\n    }\n}"
        },
        {
            "location": "./../../dockers/CVE-2022-22963/custom/src/main/java/com/example/demo/ExploitController.java",
            "content": "package com.example.demo;\n\nimport org.springframework.expression.ExpressionParser;\nimport org.springframework.expression.spel.standard.SpelExpressionParser;\nimport org.springframework.expression.spel.support.StandardEvaluationContext;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RestController;\nimport java.util.Map;\n\n@RestController\npublic class ExploitController {\n\n    @PostMapping(\"/function\")\n    public String vulnerableEndpoint(@RequestBody Map<String, String> payload) {\n        // The vulnerable logic: directly evaluate the 'function' field via SpEL\n        String expression = payload.get(\"function\");\n        if (expression == null) {\n            return \"No function provided\";\n        }\n        ExpressionParser parser = new SpelExpressionParser();\n        StandardEvaluationContext context = new StandardEvaluationContext();\n        // No restrictions \u2013 this is the insecure configuration that allows CVE-2022-22963 exploitation\n        Object result = parser.parseExpression(expression).getValue(context);\n        return result == null ? \"null\" : result.toString();\n    }\n}"
        }
    ],
    "directory_tree": "CVE-2022-22963/custom"
}