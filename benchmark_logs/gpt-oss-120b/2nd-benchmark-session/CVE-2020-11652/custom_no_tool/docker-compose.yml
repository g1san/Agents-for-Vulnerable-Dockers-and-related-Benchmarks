services:
  vulnerable-docker:
    image: docker:19.03.5
    privileged: true
    command: ["dockerd", "-H", "tcp://0.0.0.0:2375", "-H", "unix:///var/run/docker.sock"]
    ports:
      - "2375:2375"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:2375/_ping"]
      interval: 2s
      timeout: 5s
      retries: 20
  attacker:
    build:
      context: ./attacker
      dockerfile: Dockerfile
    environment:
      DOCKER_HOST: tcp://vulnerable-docker:2375
    depends_on:
      vulnerable-docker:
        condition: service_healthy