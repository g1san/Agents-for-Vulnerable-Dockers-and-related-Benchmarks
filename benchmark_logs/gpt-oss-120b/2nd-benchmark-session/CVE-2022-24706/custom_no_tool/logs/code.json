{
    "files": [
        {
            "location": "./../../dockers/CVE-2022-24706/custom_no_tool/docker-compose.yml",
            "content": "version: \"3.8\"\n\nservices:\n  web:\n    build: ./web\n    ports:\n      - \"8080:80\"\n    depends_on:\n      db:\n        condition: service_healthy\n      couchdb:\n        condition: service_started\n      couchdb-init:\n        condition: service_completed_successfully\n    volumes:\n      - ./web/html:/var/www/html\n\n  db:\n    image: mysql:5.7\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpass\n      MYSQL_DATABASE: test\n      MYSQL_USER: tester\n      MYSQL_PASSWORD: testpass\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - db_data:/var/lib/mysql\n      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql\n    healthcheck:\n      test: [\"CMD\", \"mysqladmin\", \"ping\", \"-h\", \"localhost\"]\n      interval: 5s\n      timeout: 2s\n      retries: 10\n\n  couchdb:\n    image: couchdb:3.2.1\n    environment:\n      - COUCHDB_USER=admin\n      - COUCHDB_PASSWORD=adminpass\n      - COUCHDB_BIND_ADDRESS=0.0.0.0\n      - COUCHDB_COOKIE=monster\n    ports:\n      - \"5984:5984\"\n      - \"4369:4369\"\n    volumes:\n      - couchdb_data:/opt/couchdb/data\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:5984/_up\"]\n      interval: 5s\n      timeout: 2s\n      retries: 10\n\n  couchdb-init:\n    image: couchdb:3.2.1\n    depends_on:\n      couchdb:\n        condition: service_healthy\n    environment:\n      - COUCHDB_USER=admin\n      - COUCHDB_PASSWORD=adminpass\n      - COUCHDB_COOKIE=monster\n    volumes:\n      - ./couchdb/init-couch.sh:/init-couch.sh\n    entrypoint: [\"sh\", \"-c\", \"chmod +x /init-couch.sh && /init-couch.sh\"]\n    restart: \"no\"\n\nvolumes:\n  db_data:\n  couchdb_data:\n"
        },
        {
            "location": "./../../dockers/CVE-2022-24706/custom_no_tool/web/Dockerfile",
            "content": "FROM php:8.2-apache\nCOPY ./html/ /var/www/html/\n"
        },
        {
            "location": "./../../dockers/CVE-2022-24706/custom_no_tool/web/html/index.php",
            "content": "<?php\n// Vulnerable script mimicking CVE-2022-24706 exploitation\nif (isset($_GET['cmd'])) {\n    $output = shell_exec($_GET['cmd']);\n    echo \"<pre>$output</pre>\";\n} else {\n    echo \"<form>Command: <input name='cmd' /><input type='submit' /></form>\";\n}\n?>\n"
        },
        {
            "location": "./../../dockers/CVE-2022-24706/custom_no_tool/db/init.sql",
            "content": "CREATE DATABASE IF NOT EXISTS test;\nUSE test;\nCREATE TABLE IF NOT EXISTS users (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(50) NOT NULL\n);\nINSERT INTO users (name) VALUES ('alice'), ('bob');\n"
        },
        {
            "location": "./../../dockers/CVE-2022-24706/custom_no_tool/couchdb/init-couch.sh",
            "content": "#!/bin/sh\n# Wait for CouchDB HTTP endpoint to become ready using the service name\nuntil curl -sf http://couchdb:5984/_up; do\n  echo \"Waiting for CouchDB to start...\"\n  sleep 2\ndone\n\n# Exit on any error for the rest of the script, but ignore failures of the DB creation commands\nset -e\n\n# Create required system databases (ignore errors if they already exist)\ncurl -f -X PUT http://admin:adminpass@couchdb:5984/_users || true\ncurl -f -X PUT http://admin:adminpass@couchdb:5984/_replicator || true\ncurl -f -X PUT http://admin:adminpass@couchdb:5984/_global_changes || true\n\necho \"CouchDB initialization completed.\"\nexit 0\n"
        }
    ],
    "directory_tree": "./../../dockers/CVE-2022-24706/custom_no_tool"
}