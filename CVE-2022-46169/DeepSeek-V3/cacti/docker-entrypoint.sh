#!/bin/bash
set -e

# Wait for MySQL to be ready
until mysql -h "$DB_HOST" -u root -pinsecure_root_pass -e "SELECT 1"; do
  >&2 echo "MySQL is unavailable - sleeping"
  sleep 2
done

# Initialize database if not already done
if ! mysql -h "$DB_HOST" -u root -pinsecure_root_pass -e "USE cacti; SELECT 1 FROM user_auth LIMIT 1" &> /dev/null; then
  mysql -h "$DB_HOST" -u root -pinsecure_root_pass cacti < /tmp/cacti.sql
fi

exec "$@"