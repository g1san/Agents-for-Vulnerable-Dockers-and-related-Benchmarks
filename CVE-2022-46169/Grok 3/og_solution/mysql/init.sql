CREATE DATABASE IF NOT EXISTS cacti;
USE cacti;

-- Create a minimal Cacti database structure (subset for exploitability)
CREATE TABLE settings (
    name VARCHAR(50) NOT NULL,
    value VARCHAR(255) NOT NULL,
    PRIMARY KEY (name)
);

CREATE TABLE host (
    id INT AUTO_INCREMENT PRIMARY KEY,
    hostname VARCHAR(255),
    description VARCHAR(255),
    status INT DEFAULT 3
);

CREATE TABLE poller (
    id INT AUTO_INCREMENT PRIMARY KEY,
    hostname VARCHAR(255) NOT NULL
);

CREATE TABLE poller_item (
    local_data_id INT NOT NULL,
    poller_id INT NOT NULL,
    host_id INT NOT NULL,
    action INT NOT NULL,
    arg1 VARCHAR(255),
    PRIMARY KEY (local_data_id, poller_id)
);

-- Insert default data to enable exploit
INSERT INTO settings (name, value) VALUES ('path_webroot', '/var/www/html');
INSERT INTO host (id, hostname, description) VALUES (1, 'localhost', 'Test Device');
INSERT INTO poller (id, hostname) VALUES (1, 'localhost');
INSERT INTO poller_item (local_data_id, poller_id, host_id, action, arg1)
VALUES (1, 1, 1, 2, 'script.php');

-- Create default admin user for Cacti login
CREATE TABLE user_auth (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    password VARCHAR(255) NOT NULL,
    enabled CHAR(1) DEFAULT '1'
);
INSERT INTO user_auth (username, password) VALUES ('admin', MD5('admin'));

-- Grant privileges to cactiuser
GRANT ALL PRIVILEGES ON cacti.* TO 'cactiuser'@'%' IDENTIFIED BY 'cactipass';
FLUSH PRIVILEGES;